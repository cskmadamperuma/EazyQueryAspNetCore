window.JSON||(window.JSON={stringify:function(n){var i=typeof n,u,t,f,r;if(i!="object"||n===null)return i=="string"&&(n='"'+n+'"'),String(n);f=[];r=n&&n.constructor==Array;for(u in n)t=n[u],i=typeof t,i=="string"?t='"'+t+'"':i=="object"&&t!==null&&(t=JSON.stringify(t)),f.push((r?"":'"'+u+'":')+String(t));return(r?"[":"{")+String(f)+(r?"]":"}")},parse:function(n){return n===""&&(n='""'),eval("var p="+n+";"),p}}),function(){var t=typeof jQuery!="undefined",n,i;return(t&&(n=jQuery.fn.jquery.split("."),i=1e4*parseInt(n[0])+100*parseInt(n[1])+parseInt(n[2]||0),t=i>=10700),!t)?(alert("jQuery is not loaded or has a wrong version."),!1):(t=jQuery.ui&&jQuery.ui.version?!0:!1,t&&(n=jQuery.ui.version.split("."),i=1e4*parseInt(n[0])+100*parseInt(n[1])+parseInt(n[2]||0),t=i>=10900),!t)?(alert("jQuery.UI is not loaded or has a wrong version."),!1):!0}(),function(n,t){var i=t.EQ=t.EQ||{},r={Locale:"en",AltMenuAttribute:"Attribute",AltMenuConstantExpression:"Constant expression",ButtonApply:"Apply",ButtonCancel:"Cancel",ButtonOK:"OK",ButtonClear:"Clear",ButtonEnable:"Toggle enable",MenuEnable:"Enabled",MenuParameterization:"Parameterized",MenuJoinCond:"Use in JOIN",ButtonDelete:"Delete",ButtonAddCondition:"Add condition",ButtonAddPredicate:"Add group of conditions",ButtonSelectAll:"Select all",ButtonDeselectAll:"Clear selection",ButtonAddColumns:"Add column(s)",ButtonAddConditions:"Add condition(s)",CmdAddConditionAfter:"Add a new condition after the current row",CmdAddConditionInto:"Add a new condition",CmdAddPredicateAfter:"Open a bracket after the current row",CmdAddPredicateInto:"Open a bracket",CmdClickToAddCondition:"[Add new condition]",CmdDeleteRow:"Delete this row",ErrIncorrectPredicateTitleFormat:"Incorrect predicate title format",ErrNotNumber:" is not a number",ErrIncorrectInteger:"Incorrect integer value",ErrIncorrectNumberList:"Incorrect list format",False:"False",LinkTypeAll:"all",LinkTypeAny:"any",LinkTypeNone:"none",LinkTypeNotAll:"not all",ConjAll:"and",ConjAny:"or",ConjNotAll:"and",ConjNone:"or",MsgApplySelection:"[Apply selection]",MsgAs:"as",MsgEmptyList:"(empty list)",MsgEmptyListValue:"[select value]",MsgEmptyScalarValue:"[enter value]",MsgSubQueryValue:"[edit sub-query]",MsgEmptyAttrValue:"[select attribute]",MsgEmptyCustomSql:"[enter SQL expression]",MsgCustomSql:"[Custom SQL]",MsgOf:"of",PredicateTitle:"{lt} of the following apply",RootPredicateTitle:"Select records where {lt} of the following apply",StrAddConditions:"Add conditions",SubQueryDialogTitle:"Edit sub-query",SubQueryColumnTitle:"Column:",SubQueryEmptyColumn:"[select column]",SubQueryQueryPanelCaption:"Conditions",True:"True",ButtonSorting:"Sorting",ButtonToAggr:"Change to aggregate column",ButtonToSimple:"Change to simple column",CmdAscending:"Ascending",CmdClickToAddColumn:"[Add new column]",CmdDeleteColumn:"Delete column",CmdDeleteSorting:"Delete sorting",CmdDescending:"Descending",CmdGroupSort:"Sorting",CmdNotSorted:"Not sorted",ColTypeAggrFunc:"Aggregate function",ColTypeCompound:"Calculated",ColTypeGroup:"Column type",ColTypeSimple:"Simple column",HeaderExpression:"Expression",HeaderSorting:"Sorting",HeaderTitle:"Title",SortHeaderColumn:"Column",SortHeaderSorting:"Sorting",StrAddColumns:"Add columns",CustomExpression:"Custom Expression",CmdMoveToStart:"Move to start",CmdMoveRight:"Move right",CmdMoveLeft:"Move left",CmdMoveToEnd:"Move to the end",ButtonMenu:"Show menu",CmdToSimple:"Not aggregated",CmdMoveToFirst:"Move to the first",CmdMoveToPrev:"Move to the previous",CmdMoveToNext:"Move to the next",CmdMoveToLast:"Move to the last",StrNoFilterDefined:"No filter defined",StrNoFilterClickToAdd:"No filter defined. Click to add a new condition",Today:"Today",Yesterday:"Yesterday",Tomorrow:"Tomorrow",FirstDayOfMonth:"First day of the month",LastDayOfMonth:"Last day of the month",FirstDayOfWeek:"First day of the week",FirstDayOfYear:"First day of the year",FirstDayOfNextWeek:"First day of the next week",FirstDayOfNextMonth:"First day of the next month",FirstDayOfNextYear:"First day of the next week",Now:"Now",HourStart:"This hour start",Midnight:"Midnight",Noon:"Noon"};i.core={texts:{Entities:{},Attributes:{},Operators:{},AggregateFunctions:{}},constLists:{SpecDateValues:[{id:"${Today}",key:"Today",isDefault:!0},{id:"${Yesterday}",key:"Yesterday"},{id:"${Tomorrow}",key:"Tomorrow"},{id:"${FirstDayOfMonth}",key:"FirstDayOfMonth"},{id:"${FirstDayOfYear}",key:"FirstDayOfYear"}],SpecTimeValues:[{id:"${Now}",key:"Now",isDefault:!0},{id:"${HourStart}",key:"HourStart"},{id:"${Midnight}",key:"Midnight"},{id:"${Noon}",key:"Noon"}],BooleanValues:[{id:"${false}",key:"False"},{id:"${true}",key:"True",isDefault:!0}]},predicateLinkTypeList:[{id:"All",key:"LinkTypeAll"},{id:"Any",key:"LinkTypeAny"},{id:"None",key:"LinkTypeNone"},{id:"NotAll",key:"LinkTypeNotAll"}],_numericTypes:["Byte","Word","Int","Int32","Int64","Float","Currency"],_intTypes:["Byte","Word","Int","Int32","Int64"],getText:function(){var u=i.core.texts,t="",f,e,n;if(arguments){for(f=!1,e=arguments.length,n=0;n<e;n++)if(t=u[arguments[n]],t)u=t;else{f=!0;break}if(f)for(u=r,n=0;n<e;n++)if(t=u[arguments[n]],t)u=t;else break}return t},getShiftToFitWindow:function(i,r){var f=n(t).width(),e=i+r,u=0;return e>f&&(u=f-e-10,i+u<0&&(u=10-i)),u},onError:null,throwError:function(n){if(this.onError)this.onError(n);else{var t=n&&n.type?n.type+" error":"Error",i=n&&n.message?n.message:"";alert(t+": "+i)}},isObject:function(n){return n===null?!1:typeof n=="function"||typeof n=="object"},isNumericType:function(t){var i=n.inArray(t,this._numericTypes);return i>=0},isIntType:function(t){var i=n.inArray(t,this._intTypes);return i>=0},isNumeric:function(t){return n.isNumeric(t)},areCompatibleDataTypes:function(n,t){return!n||!t||n==t||n=="Date"&&t=="DateTime"||n=="DateTime"&&t=="Date"},combinePath:function(n,t){var i=n;return i!=null&&i.length>0?(i.charAt(i.length-1)!="/"&&(i+="/"),i+=t):i=t,i},indexOfArrayItem:function(n,t){if(n.indexOf)return n.indexOf(t);for(var r=n.length,i=0;i<r;i++)if(n==n[i])return i;return-1},moveArrayItem:function(n,t,i){if(i>=n.length)for(var r=i-n.length;r--+1;)n.push(undefined);n.splice(i,0,n.splice(t,1)[0])},queryChanged:function(n,t){i.client.queryChanged(n,t)},getEmptyQueryObject:function(){return{root:{linkType:"All",enabled:!0,conditions:[]},columns:[],justsorted:[]}},parseOperatorFormat:function(n){var u=i.core.getText("Operators",n.id,"displayFormat"),r,t;for(u||(u=n.displayFormat),r=[],t=new i.core.FormatParser(u);t.next();)t.token==="operator"?r.push({type:"operator",text:t.tokenText}):t.token==="expression"?r.push({type:"expression",index:t.exprNum-1}):t.token==="text"&&r.push({type:"text",text:t.tokenText});return r},isPropSet:function(n,t){return n[t]||n[t.toLowerCase()]||n[t.toUpperCase()]},generateId:function(){var n=new Date,t=Math.floor(Math.random()*1e4);return"Y"+n.getYear()+"-M"+n.getMonth()+"-D"+n.getDay()+"-H"+n.getHours()+"-M"+n.getMinutes()+"-S"+n.getSeconds()+"-MS"+n.getMilliseconds()+"-"+t}};i.core.FormatParser=function(n){this.start(n)};i.core.FormatParser.prototype={start:function(n){this.formatStr=n;this.pos=0;this.exprNum=0;this.tokenText=""},skipSpaces:function(){while(this.pos<this.formatStr.length&&this.formatStr.charAt(this.pos)===" ")this.pos++},next:function(){var t,i,r;if(this.skipSpaces(),this.pos>=this.formatStr.length)return!1;if(t=0,this.formatStr.charAt(this.pos)==="{"){if(t=this.formatStr.indexOf("}",this.pos),t<0)return!1;this.tokenText=this.formatStr.substring(this.pos,t+1);this.tokenText.indexOf("{expr")===0&&(this.token="expression",this.exprNum=parseInt(this.tokenText.substring(5,this.tokenText.length)));this.pos=t+1}else this.formatStr.charAt(this.pos)==="["&&this.pos<this.formatStr.length-1&&this.formatStr.charAt(this.pos+1)==="["?(this.pos+=2,t=this.formatStr.indexOf("]]",this.pos),this.token="operator",this.tokenText=this.formatStr.substring(this.pos,t),this.pos=t+2):(this.token="text",i=this.formatStr.indexOf("{",this.pos),i<0&&(i=this.formatStr.length),r=this.formatStr.indexOf("[[",this.pos),r<0&&(r=this.formatStr.length),t=Math.min(i,r),this.tokenText=n.trim(this.formatStr.substring(this.pos,t)),this.pos=t);return!0}};i.core.DataModel=function(n){n?this.setObject(n):this.setObject({id:"",aggrFunctions:[],operators:[],rootEntity:{}})};i.core.DataModel.prototype={nullAttribute:{id:"",caption:"{Unrecognized attribute}",dataType:"String",description:"",size:0,operators:[],uic:!1,uir:!1,uis:!1},nullOperator:{id:"",caption:"{Unrecognized operator}",displayFormat:"{expr1} [[{unrecognized operator}]] {expr2}",exprType:"Unknown",paramCount:2,valueKind:"Scalar"},dateMacroList:["${Today}","${Yesterday}","${Tomorrow}","${FirstDayOfMonth}","${LastDayOfMonth}","${FirstDayOfWeek}","${FirstDayOfYear}","${FirstDayOfNextWeek}","${FirstDayOfNextMonth}","${FirstDayOfNextYear}"],timeMacroList:["${Now}","${HourStart}","${Midnight}","${Noon}"],getObject:function(){return this.model},setObject:function(n){n&&(this.model=typeof n=="string"?JSON.parse(n):n,this._rgdlce=this.chkrgd(),this.runThroughEntities(function(n){n.UIC!=undefined&&n.uic==undefined&&(n.uic=n.UIC);n.UIR!=undefined&&n.uir==undefined&&(n.uir=n.UIR);n.UIS!=undefined&&n.uis==undefined&&(n.uis=n.UIS)},function(n){n.UIC!=undefined&&n.uic==undefined&&(n.uic=n.UIC);n.UIR!=undefined&&n.uir==undefined&&(n.uir=n.UIR);n.UIS!=undefined&&n.uis==undefined&&(n.uis=n.UIS)}))},isEmpty:function(){return this.model==null},getId:function(){return this.model.id},getName:function(){return this.model.name},getEqVersion:function(){var n=this.model.easyQuery;return n?n.version:"3.8.3"},getEqToken:function(){var n=this.model.easyQuery;return n?n.token:"                "},chkrgd:function(){var i=this.getEqToken(),r=this.getEqVersion(),n=r.split("."),u=n.length>0?parseInt(n[0]):0,t=n.length>1?parseInt(n[1]):0,f=i.charCodeAt(t%14+2),e=u%10+t%10+65;return e==f},_rgdlce:!1,rgdlce:function(){return this._rgdlce},getRootEntity:function(){return this.model?this.model.rootEntity:{}},getAttributeById:function(n){var t=this.getEntityAttrById(this.getRootEntity(),n);return t||(t=this.nullAttribute),t},checkAttrProperty:function(n,t){var i=typeof n=="object"?n:this.getAttributeById(n);return i?i[t]?!0:i.lookupAttr?(n=i.lookupAttr,i=this.getAttributeById(n),i&&i[t]):!1:!1},getEntityAttrById:function(n,t){var i,u,r,f;if(n.attributes)for(u=n.attributes.length,i=0;i<u;i++)if(n.attributes[i].id==t)return n.attributes[i];if(n.subEntities)for(f=n.subEntities.length,i=0;i<f;i++)if(r=this.getEntityAttrById(n.subEntities[i],t),r)return r;return null},getFullEntityPathByAttr:function(n,t){return t=t||" ",this.getEntityPathByAttr(this.getRootEntity(),n,t,!0)},getEntityPathByAttr:function(n,t,r,u){var e,s,f,h,c,l,o;if(!n)return"";if(r=r||" ",e="",n.caption&&!u&&(s=i.core.getText("Entities",n.caption),e=s?s:n.caption),n.attributes)for(h=n.attributes.length,f=0;f<h;f++)if(n.attributes[f].id==t)return e;if(n.subEntities)for(c=n.subEntities.length,f=0;f<c;f++)if(l=n.subEntities[f],o=this.getEntityPathByAttr(l,t,r,!1),o!=="")return e!==""&&(o=e+r+o),o;return""},getAttributeText:function(n,t){var u=i.core.getText("Attributes",n.id),r,f;return(u||(u=n.caption),!t)?u:(r="",f=this.getFullEntityPathByAttr(n.id," "),f?(r=t.replace(new RegExp("{attr}","g"),u),r=r.replace(new RegExp("{entity}","g"),f)):r=u,r.trim())},_listByEntityWithFilter:function(n,t){var h=[],r,f=null,c,e,o,u,l,s;if(n.subEntities)for(c=n.subEntities.length,e=0;e<c;e++)f=n.subEntities[e],(!t||t(f))&&(r=i.core.getText("Entities",f.name),r||(r=f.caption),o={id:f.name,text:r,items:[],isEntity:!0},o.items=this._listByEntityWithFilter(f,t),o.items.length>0&&h.push(o));if(u=null,n.attributes)for(l=n.attributes.length,s=0;s<l;s++)u=n.attributes[s],(!t||t(u))&&(r=i.core.getText("Attributes",u.id),r||(r=u.caption),h.push({id:u.id,text:r,dataType:u.dataType}));return h},_listByEntity:function(t,r){function y(n,t){return n.text.toLowerCase()==t.text.toLowerCase()?0:n.text.toLowerCase()>t.text.toLowerCase()?1:-1}var r=r||{},o=[],s=[],u,e=null,p,h,a,v,f,w,c,l;if(t.subEntities)for(p=t.subEntities.length,h=0;h<p;h++)e=t.subEntities[h],(r.addUIC!==!1&&e.uic!==!1||r.addUIR!==!1&&e.uir!==!1||r.addUIS!==!1&&e.uis!==!1)&&(u=i.core.getText("Entities",e.name),u||(u=e.caption),a={id:e.name,text:u,items:[],isEntity:!0,description:e.description},v=n.extend({},r),v.includeRootData=!1,a.items=this._listByEntity(e,v),o.push(a));if(f=null,t.attributes)for(w=t.attributes.length,c=0;c<w;c++)f=t.attributes[c],(r.addUIC!==!1&&f.uic!==!1||r.addUIR!==!1&&f.uir!==!1||r.addUIS!==!1&&f.uis!==!1)&&(u=i.core.getText("Attributes",f.id),u||(u=f.caption),s.push({id:f.id,text:u,dataType:f.dataType,lookupAttr:f.lookupAttr,description:f.description}));return r.sortEntities&&(o.sort(y),s.sort(y)),l=r.attrPlacement&&r.attrPlacement!=0?s.concat(o):o.concat(s),r.attrPlacement==2&&l.sort(y),r.includeRootData?(u=i.core.getText("Entities",t.name),u||(u=t.caption),{id:t.name,text:u,items:l}):l},getEntitiesTree:function(n){return this._listByEntity(this.getRootEntity(),n)},getEntitiesTreeWithFilter:function(n){return this._listByEntityWithFilter(this.getRootEntity(),n)},_findItemById:function(n,t){for(var r=n.length,i=0;i<r;i++)if(n[i].id===t)return n[i];return null},getFirstUICAttr:function(){return this.getFirstUICAttrInEntity(this.getRootEntity())},getFirstUICAttrInEntity:function(n){var t,r,u,i;if(n.uic!==!1){if(t=0,n.attributes)for(r=n.attributes.length,t=0;t<r;t++)if(n.attributes[t].uic)return n.attributes[t];if(n.subEntities)for(u=n.subEntities.length,t=0;t<u;t++)if(i=this.getFirstUICAttrInEntity(n.subEntities[t]),i)return i}return null},runThroughEntities:function(n,t){var i={stop:!1},r=function(u){var f,e,o,s;if(t&&t(u,i),f=0,u.attributes)for(e=u.attributes.length,f=0;f<e&&!i.stop;f++)if(o=u.attributes[f],n&&n(o,i),i.stop)return;if(u.subEntities)for(s=u.subEntities.length,f=0;f<s&&!i.stop;f++)r(u.subEntities[f])};r(this.getRootEntity())},getFirstAttributeByFilter:function(n){var t=null;return this.runThroughEntities(function(i,r){n(i)&&(r.stop=!0,t=i)}),t},findOperatorById:function(n){var i,t;if(this.model.operators)for(i=this.model.operators.length,t=0;t<i;t++)if(this.model.operators[t].id==n)return this.model.operators[t];return null},getOperatorById:function(n){var t=this.findOperatorById(n);return t||(t=this.nullOperator),t},getDefaultOperatorIdForAttr:function(n){return n.defaultOperator?n.defaultOperator:n.operators.length>0?n.operators[0]:this.nullOperator.id},getDefaultOperatorForAttr:function(n){var t=this.getDefaultOperatorIdForAttr(n);return this.getOperatorById(t)},getOperand:function(t,i,r){var f,u;return i&&i.defaultOperand?(f=i.defaultOperand,f.defValue||(f.defValue=""),f.defText||(f.defText="")):f={kind:"Scalar",dataType:"Unknown",defValue:"",defText:"",editor:null},u=n.extend({},f),(!u.dataType||u.dataType==="Unknown")&&t&&(u.dataType=t.dataType),i&&r!==undefined&&i.operands&&i.operands[r-1]&&n.extend(u,i.operands[r-1]),u.editor||(u.editor=f.editor?n.extend({},f.editor):f.kind==="Query"?{type:"SUBQUERY"}:t&&t.defaultEditor?n.extend({},t.defaultEditor):u.dataType&&(u.dataType=="Date"||u.dataType=="DateTime"||u.dataType=="Time")?{type:"DATETIME"}:{type:"EDIT"}),u},getAggrFunctions:function(){return this.model?this.model.aggrFunctions:[]},getAggrFunctionCaption:function(n){var r=i.core.getText("AggregateFunctions",n),u=r?r.caption:i.core.getText("Aggr"+n.replace(" ","")+"_Caption"),t;return u?u:(t=this._findItemById(this.model.aggrFunctions,n),!t||!t.caption)?n:t.caption},getAggrFunctionFormat:function(n){var r=i.core.getText("AggregateFunctions",n),u=r?r.displayFormat:i.core.getText("Aggr"+n.replace(" ","")+"_Format"),t;return u?u:(t=this._findItemById(this.model.aggrFunctions,n),!t||!t.displayFormat)?"":t.displayFormat},getMacroDateValue:function(t){var i=new Date,r;if(n.inArray(t,this.dateMacroList)>=0){switch(t){case"${Yesterday}":i.setDate(i.getDate()-1);break;case"${Tomorrow}":i.setDate(i.getDate()+1);break;case"${FirstDayOfMonth}":i.setDate(1);break;case"${LastDayOfMonth}":i.setMonth(i.getMonth()+1,0);break;case"${FirstDayOfWeek}":r=i.getDay();r=r==0?6:r-1;i.setDate(i.getDate()-r);break;case"${FirstDayOfYear}":i.setMonth(0,1);break;case"${FirstDayOfNextWeek}":r=i.getDay();r=r==0?1:8-r;i.setDate(i.getDate()+r);break;case"${FirstDayOfNextMonth}":i.setMonth(i.getMonth()+1,1);break;case"${FirstDayOfNextYear}":i.setFullYear(i.getFullYear()+1,0,1)}return i}return null},getDateOrMacroDateValue:function(n){var t=this.getMacroDateValue(n);return t?t:n},getMacroTimeValue:function(t){var i=new Date;if(n.inArray(t,this.timeMacroList)>=0){switch(t){case"${HourStart}":i.setMinutes(0,0,0);break;case"${Midnight}":i.setHours(0,0,0,0);break;case"${Noon}":i.setHours(12,0,0,0)}return i}return null},getTimeOrMacroTimeValue:function(n){var t=this.getMacroTimeValue(n);return t?t:n}};i.core.Query=function(t,r,u){this.model=t?t:new i.core.DataModel;r=r||i.core.getEmptyQueryObject();this._internalListCache={};this._externalListCache=null;this._updating=0;u=u||{};this.attrClassName=u.attrClassName||"ENTATTR";this.clientListRequestHandler=u.clientListRequestHandler;this.serverListRequestHandler=u.serverListRequestHandler;this._queryChangedCallbacks=n.Callbacks("unique");this._queryProcessCallbacks=n.Callbacks("unique");this.setObject(r);this.query.id||(this.query.id=i.core.generateId())};i.core.Query.prototype={getObject:function(){return this.query},setObject:function(n,t){n&&(this.query=typeof n=="string"?JSON.parse(n):n,t||this.fireChangedEvent({changeType:"query.all"},!0))},getModel:function(){return this.model},setModel:function(n){this.model=n;this.clear()},loadModelObject:function(n){this.model.setObject(n)},toJSON:function(){var n=this.getQueryObject();return JSON.stringify(n)},getQueryObject:function(){var n=this.getModel();return this.query.modelId=n?n.getId():null,this.query.modelName=n?n.getName():null,this.query},isEmptyConditions:function(){return!this.query.root||!this.query.root.conditions||this.query.root.conditions.length===0},isEmptyColumns:function(){return!this.query.columns||this.query.columns.length===0},beginUpdate:function(){this._updating++},endUpdate:function(n){this._updating--;this._updating==0&&n&&this.fireChangedEvent({changeType:"query.all"},!0)},isUpdating:function(){return this._updating>0},clear:function(n){this.beginUpdate();try{this.clearColumns();this.clearConditions()}finally{this.endUpdate();n||this.fireChangedEvent({changeType:"query.clear"},!0)}},clearColumns:function(){this.query.columns=[];this.query.justsorted=[];this.fireChangedEvent({changeType:"query.columns.clear"},!0)},clearConditions:function(){this.query.root={linkType:"All",enabled:!0,conditions:[]};this.fireChangedEvent({changeType:"query.conditions.clear"},!0)},getId:function(){return this.query?this.query.id:""},setId:function(n){this.query&&(this.query.id=n)},getName:function(){return this.query?this.query.name:""},setName:function(n){this.query&&(this.query.name=n)},getDescription:function(){return this.query?this.query.description:""},setDescription:function(n){this.query&&(this.query.description=n)},getColumns:function(){return this.query?this.query.columns:[]},getSortedColumns:function(){for(var t=[],r=this.getColumns(),i,n=0;n<r.length;n++)i=r[n],i.sortIndex>=0&&t.push(i);return t.sort(function(n,t){return n.sortIndex-t.sortIndex}),t},getColumnSortIndex:function(n){if(n.sorting!="None"){if(n.sortIndex<0){var t=this.getColumns();return i.core.indexOfArrayItem(t,n)}return n.sortIndex}return-1},addColumn:function(n,t,i){if(this.query){var r=this.query.columns;typeof t=="number"?r.splice.apply(r,[t,0].concat(n)):r.push.apply(r,[].concat(n));this.fireChangedEvent({source:i,changeType:"column.add",column:n},!0)}},moveColumn:function(n,t,r){var u=this.getColumns(),f=u[n];i.core.moveArrayItem(u,n,t);this.fireChangedEvent({source:r,changeType:"column.move",column:f},!0)},removeColumn:function(t,i){var r=this.getColumns(),u=n.inArray(t,r);u>=0&&(r.splice(u,1),this.fireChangedEvent({source:i,changeType:"column.remove",column:t},!0))},removeColumns:function(t,i){for(var u,f=this.getColumns(),e=t.length,r=0;r<e;r++)u=n.inArray(t[r],f),u>=0&&f.splice(u,1);this.fireChangedEvent({source:i,changeType:"column.remove",column:t},!0)},getRootPredicate:function(){return this.query.root},addSimpleCondition:function(n){var o=n.predicate||this.getRootPredicate(),t=this.getModel(),e,i,u,f,r;return t?(e=n.attr,i=t.getAttributeById(e),!i)?null:(u=n.operator,f=u?t.getOperatorById(u):t.getDefaultOperatorForAttr(i),!f)?null:(r=this._createSimpleConditionObject(i,f,n.value),o.conditions.push(r),this.fireChangedEvent({changeType:"condition.add",condition:r},!0),r):null},addPredicate:function(n){var u=n.predicate||this.getRootPredicate(),t=this.getModel(),i=t.getFirstUICAttr(),f=t.getDefaultOperatorForAttr(i),e=this._createSimpleConditionObject(i,f,""),o=u.linkType==="All"?"Any":"All",r={typeName:"PDCT",linkType:o,conditions:[]};return r.conditions.push(e),r},_createValueExpr:function(n,t,i,r){var f=this.getModel(),u=f.getOperand(n,t);return{typeName:"CONST",dataType:u.dataType,kind:u.kind,value:r,text:r}},_createSimpleConditionObject:function(t,i,r){var o=this,u,e,f;if(!t||!t.uic)return null;if(u={typeName:"SMPL",enabled:!0,operatorID:i.id,expressions:[{typeName:o.attrClassName,id:t.id}]},r!==null&&typeof r!="undefined")if(n.isArray(r))for(e=r.length,f=0;f<e;f++)u.expressions.push(this._createValueExpr(t,i,f+1,r));else u.expressions.push(this._createValueExpr(t,i,1,r));return u},setExternalListCache:function(n){this._externalListCache=n},_getListFromCache:function(n){var t=n.listName=="SQL"?"SQL_"+n.editorId:n.listName;return this._externalListCache?this._externalListCache.get(t):this._internalListCache[t]},_addListToCache:function(n,t){var i=n.listName=="SQL"?"SQL_"+n.editorId:n.listName;this._externalListCache?this._externalListCache.set(i,t):this._internalListCache[i]=t},resetListCache:function(){this._externalListCache?this._externalListCache.clear():this._internalListCache={}},getListRequestHandler:function(){var n=this;return function(t,i){var e,r,u,f;if(t!=null&&t.listName){if(e=t.listName.match(/{{(.+?)}}/),e&&(r=n.getOneValueForAttr(e[1]),r||(r=""),t.listName=t.listName.replace(/{{.+?}}/,r)),u=n._getListFromCache(t),u&&u.length>0){i(u);return}f=!1;n.clientListRequestHandler&&(f=n.clientListRequestHandler(t,i));!f&&n.serverListRequestHandler&&(f=n.serverListRequestHandler(t,function(r){r&&n._addListToCache(t,r);i(r)}))}}},addChangedCallback:function(n){n&&this._queryChangedCallbacks.add(n)},removeChangedCallback:function(n){n&&this._queryChangedCallbacks.remove(n)},fireChangedEvent:function(n,t){if(!this.isUpdating()){n=n||{};n.query=this;var i=this;t?this._queryChangedCallbacks.fire(n):setTimeout(function(){i._queryChangedCallbacks.fire(n)},50)}},addProcessCallback:function(n){n&&this._queryProcessCallbacks.add(n)},removeProcessCallback:function(n){n&&this._queryProcessCallbacks.remove(n)},fireProcessEvent:function(n){this._queryProcessCallbacks.fire(n)},runThroughConditions:function(n){var t=function(i){for(var u,r=0;r<i.conditions.length;r++)u=i.conditions[r],u.conditions?t(u):n&&n(u)};t(this.getRootPredicate())},getOneValueForAttr:function(n){var t=null;return this.runThroughConditions(function(i){if(i.enabled){var r=i.expressions[0];r.id==n&&i.expressions[1]&&(i.operatorID=="Equal"||i.operatorID=="InList"||i.operatorID=="StartsWith")&&(t=i.expressions[1].value)}}),t},getConditionsText:function(){var r=this,n=r.getModel(),t;return n?(t=function(r){for(var e="",y="Conj"+r.linkType,p=i.core.getText(y),u,f,s,c,l,h,v,o=0;o<r.conditions.length;o++){if(u="",f=r.conditions[o],f.enabled||typeof f.enabled=="undefined")if(f.conditions)u=t(f),u&&(u="("+u+")");else{var w=f.operatorID,b=n.getOperatorById(w),a=i.core.parseOperatorFormat(b),k=a.length;for(s=0;s<k;s++)c=a[s],l=c.text,c.type=="expression"&&(h=f.expressions[c.index],h.kind=="Attribute"||h.typeName=="ENTATTR"?(v=n.getAttributeById(h.id),l=n.getAttributeText(v,"{entity} {attr}")):l=h.text),s>0&&(u+=" "),u+=l}u&&(o>0&&e&&(e+=" "+p+" "),e+=u)}return(r.linkType=="None"||r.linkType=="NotAll")&&(e="not ( "+e+" )"),e},t(r.getRootPredicate())):""}}}(jQuery,window),function(n){function t(){return{top:n(window).scrollTop(),left:n(window).scrollLeft()}}function u(t,i){var f={x:0,y:0},r,u;return t!==null&&(r=n(t).offset(),i=i||document.documentElement||document.body,u=n(i).offset(),f={x:r.left-u.left,y:r.top-u.top}),f}function i(){var t=n(window);return{width:t.innerWidth(),height:t.innerHeight()}}function r(n){this.parentMenu=n.menu||null;this.parentLevel=n.parent||null;this.parentElement=n.container||document.body;this.levelIndex=n.levelIndex||0;this.levelDiv=null;this.domWriteItemsId=n.domWriteItemsId||!1;this.menuId=n.menuId||"";this.itemRenderedCallback=n.itemRenderedCallback||null;this.applyItem={};this.applyItem.itemDiv=null;this.items=n.items||[];this.activeItem=null;this.selectedItem=null;this.initialized=!1;this.updated=0;this.renderContent()}var f;r.prototype={_turnCheckboxes:function(n){for(var r=n.length,t,i=0;i<r;i++)t=n[i],t.itemCheckbox&&(t.itemCheckbox.checked=this._isItemSelected(t)),t.items&&this._turnCheckboxes(t.items)},_isItemSelected:function(n){if(n.items){for(var t=0;t<n.items.length;t++)if(this._isItemSelected(n.items[t]))return!0;return!1}return n.selected},_setItemSelected:function(n,t){if(n.items)for(var i=0;i<n.items.length;i++)this._setItemSelected(n.items[i],t);else n.selected=t},showAt:function(r,u,f,e){var y,h,c,l,o,v,s,a;if(this.items){if(y=this,this.initLevelDiv(),this._turnCheckboxes(this.items),this._renderItems(),h=this.levelDiv.style,e&&n(this.levelDiv).css("visibility","hidden"),h.display="block",h.left=r+"px",h.top=u+"px",this.scrollDiv.style.width="auto",this.scrollDiv.style.height="auto",f&&(u=this.adjustTopPos(u),h.top=u+"px"),c=this.parentMenu.minItemWidth,c>0&&this.scrollDiv.offsetWidth<c)for(o=0;o<itemsLength;o++)this.items[o].itemDiv.style.width=c+"px";if(l=this.parentMenu.maxItemWidth,l>0&&this.scrollDiv.offsetWidth>l)for(o=0;o<itemsLength;o++)this.items[o].itemDiv.style.width=l+"px",this.items[o].itemDiv.style.overflowX="hidden";v=i();s=v.height-(u-t().top)-15;this.parentMenu.maxHeight>0&&s>this.parentMenu.maxHeight&&(s=this.parentMenu.maxHeight);this.applyItem!=null&&this.applyItem.itemDiv!=null&&(s-=this.applyItem.itemDiv.offsetHeight+5);this.searchDiv!=null&&(s-=this.searchDiv.offsetHeight);this.levelDiv.offsetHeight>s?(a=s,a<50&&(a=50),this.scrollDiv.style.height=a+"px"):this.scrollDiv.style.height="auto";this.activeItem=null}},focus:function(){var t=this;window.setTimeout(function(){n(t.scrollDiv).focus();t.searchBox!=null&&(t.parentMenu.options.searchBoxAutoFocus&&t.searchBox.focus(),t.searchBox.value="")},100)},hide:function(){if(this.activeItem!==null&&this.activeItem.subLevel&&this.activeItem.subLevel.hide(),this.levelDiv){var n=this.levelDiv.style;n.display="none";this.initialized&&(this.parentElement.removeChild(this.levelDiv),this.initialized=!1)}},adjustTopPos:function(n){var u=i(),r=n,f=n-t().top+this.levelDiv.offsetHeight;return f>u.height-5&&(r-=f-u.height+5,r<t().top&&(r=t().top+10)),r},initLevelDiv:function(){this.initialized||(this.parentElement.appendChild(this.levelDiv),n(this.levelDiv).addClass("eqjs-menu-levelDiv"),this.initialized=!0)},activateItem:function(t){var i;if(this.activeItem!=null&&this.deactivateItem(this.activeItem),this.activeItem=t,i=t.itemDiv,n(i).addClass("active"),this.parentMenu.options.useDefaultStyles){var e=this.parentMenu.style.colors.bgON,o=this.parentMenu.style.colors.fgON,r=this.parentMenu.style.colors.bgOVER,u=this.parentMenu.style.colors.fgOVER||"",s=this.parentMenu.style.itemClass||"",f=this.parentMenu.style.itemClassOver||"";f!=""?(i.style.backgroundColor="",i.style.color=""):(i.style.backgroundColor=r,i.style.color=u)}t.items&&this.showSubLevel(t)},deactivateItem:function(t){var i=t.itemDiv;if(n(i).removeClass("active"),this.parentMenu.options.useDefaultStyles){var r=this.parentMenu.style.colors.bgON,u=this.parentMenu.style.colors.fgON,f=this.parentMenu.style.itemClass||"";f!=""?(i.style.backgroundColor="",i.style.color=""):(i.style.backgroundColor=r,i.style.color=u)}t.subLevel&&t.subLevel.hide();this.activeItem=null},_submitItems:function(n,t){for(var r=n.length,i=0;i<r;i++)n[i].items?this._submitItems(n[i].items,t):n[i].selected&&t.push(n[i])},submit:function(n){if(n!=null&&!n.items){this.parentMenu.hideMenu();var t=[];n==this.applyItem&&this._submitItems(this.items,t);this.parentMenu.submitMenu(n,t)}},showSubLevel:function(f){var o;f.subLevel||(o="",this.menuId&&(o=this.menuId+"-"+f.id),f.subLevel=new r({menu:this.parentMenu,parent:this,container:this.parentElement,items:f.items,levelIndex:this.levelIndex+1,domWriteItemsId:this.domWriteItemsId,menuId:o,itemRenderedCallback:this.itemRenderedCallback}));var e=u(f.itemDiv,this.parentElement),s=t(),l=i(),h=e.x-s.left,c=l.width-h-f.itemDiv.offsetWidth,a=e.x;e.x+=f.itemDiv.offsetParent.offsetWidth;e.y+=1;f.subLevel.showAt(e.x,e.y,!0,!0);f.subLevel.levelDiv.style.width="";f.subLevel.levelDiv.style.right="";c>=f.subLevel.levelDiv.offsetWidth||c>=h?c<f.subLevel.levelDiv.offsetWidth&&(f.subLevel.levelDiv.style.right=-s.left+"px"):(f.subLevel.levelDiv.style.left=h<f.subLevel.levelDiv.offsetWidth?s.left+4+"px":"",f.subLevel.levelDiv.style.right=n(window).width()-e.x+f.itemDiv.offsetWidth-6+"px");n(f.subLevel.levelDiv).css("visibility","visible");f.subLevel.focus()},refreshItems:function(){for(var n,i=this.items.length,t=0;t<i;t++)n=this.items[t],n.itemDiv&&(n.itemDiv.style.display=n.hidden?"none":"block"),n.subLevel&&n.subLevel.refreshItems()},refreshCheckboxes:function(){for(var n,i=this.items.length,t=0;t<i;t++)n=this.items[t],n.itemCheckbox&&(n.itemCheckbox.checked=this._isItemSelected(n)),n.subLevel&&n.subLevel.refreshCheckboxes()},renderContent:function(){var l,s,f,a,o,v,r,u,e;if(this.items){var t=this,h=this.parentMenu.style.colors.bgON||"white",y=this.parentMenu.style.colors.fgON||"black",k=this.parentMenu.style.colors.bgOVER||"LightSteelBlue",c=this.parentMenu.style.itemStyle.fontFamily||"",p=this.parentMenu.style.itemStyle.fontSize||"14px",w=this.parentMenu.options.multiselect,b=this.parentMenu.options.isSubQuery,i=document.createElement("div");if(this.parentMenu.options.useDefaultStyles&&(i.style.backgroundColor=h,i.style.border="1px solid",i.style.borderColor=this.parentMenu.style.colors.border,i.style.margin="-2px 2px 2px -2px",i.style.width="auto",i.style.height="auto"),i.style.zIndex=this.parentMenu.zIndex,i.style.position="absolute",i.style.display="none",i.menuLevel=this,l=this.parentMenu,s=this.applyItem,w&&this.levelIndex===0&&(f=document.createElement("div"),this.applyBtn=document.createElement("button"),n(f).addClass("eqjs-menu-applyDiv"),f.menuItem=s,this.parentMenu.options.useDefaultStyles&&(f.style.borderBottom="1px solid",f.style.padding="5px",f.style.marginBottom="5px",this.applyBtn.style.padding="0 5px",this.applyBtn.style.cursor="pointer"),a=document.createTextNode(this.parentMenu.options.buttons.submit),this.applyBtn.appendChild(a),f.appendChild(this.applyBtn),o=document.createElement("button"),n(o).addClass("eqjs-menu-cancel"),this.parentMenu.options.useDefaultStyles&&(o.style.padding="0 5px",o.style.cursor="pointer",o.style.marginLeft="15px"),v=document.createTextNode(this.parentMenu.options.buttons.cancel),o.appendChild(v),f.appendChild(o),i.appendChild(f),s.itemDiv=f,n(this.applyBtn).click(function(){t.submit(t.applyItem)}),n(o).click(function(){t.parentMenu.hideMenu()})),t.items.length>=l.options.showSearchBoxAfter){r=document.createElement("div");n(r).addClass("eqjs-menu-searchDiv");this.parentMenu.options.useDefaultStyles&&(r.style.borderBottom="1px solid #666",r.style.backgroundColor=h,r.style.borderColor=this.parentMenu.style.colors.border,c!=""&&(r.style.fontFamily=c),r.style.fontSize=p,r.style.color=y,r.style.cursor="pointer",r.style.textAlign="left",r.style.padding="5px");u=document.createElement("input");u.name="searchBox";u.id="searchBox";n(u).addClass("eqjs-menu-searchBox");b&&n(u).addClass("ui-dialog");t.searchBox=u;t.searchDiv=r;u.type="text";u.size="16";this.parentMenu.options.useDefaultStyles&&(u.style.fontFamily="monospace",u.style.fontSize="8pt",u.style.width="100%");r.appendChild(u);i.appendChild(r);n(u).on("input",function(){t._renderItems(n(this).val())})}e=document.createElement("div");n(e).prop("tabindex",1);n(e).addClass("eqjs-menu-scrollDiv");e.style.overflowX="hidden";e.style.overflowY="auto";e.style.position="relative";i.appendChild(e);this.levelDiv=i;this.scrollDiv=e;this.menuId&&n(this.levelDiv).attr("id",this.menuId);this._renderItems();n(e).on("keydown",function(i){var r;switch(i.which){case 13:t.parentMenu.options.multiselect?t.parentMenu._rootLevel.applyBtn.click():t.activeItem&&n(t.activeItem.itemDiv).click();break;case 32:t.activeItem&&n(t.activeItem.itemDiv).trigger("click",[!0]);break;case 37:t.parentLevel&&(t.deactivateItem(t.activeItem),t.parentLevel._focusScrollDiv());break;case 38:t.activeItem?(r=n.inArray(t.activeItem,t.items),r>0&&t.activateItem(t.items[r-1])):t.activateItem(t.items[t.items.length-1]);break;case 39:t.activeItem&&t.activeItem.subLevel&&(t.activeItem.subLevel._focusScrollDiv(),t.activeItem.subLevel.activateItem(t.activeItem.subLevel.items[0]));break;case 40:t.activeItem?(r=n.inArray(t.activeItem,t.items),r<t.items.length-1&&t.activateItem(t.items[r+1])):t.activateItem(t.items[0]);break;default:return}i.preventDefault()})}},_allSubitemsAreFiltered:function(n,t){for(var r=n.length,i=0;i<r;i++)if(t(n[i]))return!1;return!0},_renderItems:function(t){var u=this,v=this.scrollDiv,h=this.parentMenu.options.multiselect,y=this.parentMenu.options.activateOnMouseOver,d=this.parentMenu.style.colors.fgON||"black",nt=this.parentMenu.style.colors.bgOVER||"LightSteelBlue",g=this.parentMenu.style.itemStyle.fontSize||"14px",c=this.parentMenu._itemFilterCallback,l,e,p,i,w,r,f,b,o,s,k,a;for(n(v).empty(),l=t?new RegExp(t,"i"):null,p=this.items.length,e=0;e<p;e++)if(i=this.items[e],i&&i.text){if(c){if(!c(i))continue;if(i.items&&u._allSubitemsAreFiltered(i.items,c))continue}if(w=l?i.text.search(l):0,!(w<0)){if(i.data=function(n){return this[n]},typeof i.selected=="undefined"&&(i.selected=!1),i.selected&&this.selectedItem==null&&(this.selectedItem=i),r=document.createElement("div"),n(r).addClass("eqjs-menu-itemDiv"),i.selected&&!h&&n(r).addClass("eqjs-menu-selected"),this.domWriteItemsId&&this.menuId&&n(r).attr("id","item-"+this.menuId+"-"+i.id),v.appendChild(r),r.menuItem=i,i.itemDiv=r,this.parentMenu.options.useDefaultStyles&&(r.style.fontSize=g,r.style.color=d,r.style.paddingLeft="15px",r.style.paddingRight="6px",r.style.cursor="pointer"),i.text=="---")r.appendChild(document.createElement("hr"));else{h?(f=document.createElement("input"),f.type="checkbox",f.id="cb"+i.id,f.checked=this._isItemSelected(i),f.defaultChecked=this._isItemSelected(i),r.appendChild(f),i.itemCheckbox=f,this.parentMenu.options.useDefaultStyles&&(f.style.margin="4px 10px 0 0",f.style.verticalAlign="top")):i.selected;b=document.createTextNode(i.text);r.appendChild(b);o=n(r);i.items&&i.items.length>0&&(o.addClass("eqjs-menu-itemDiv-hasChildren"),s=document.createElement("span"),n(s).addClass("eqjs-menu-itemDiv-arrow"),r.appendChild(s),k=document.createTextNode(">"),s.appendChild(k));a=function(n,t){var i=this.menuItem,r;h?!i.items||n.target==i.itemCheckbox||t?(r=u._isItemSelected(i),u._setItemSelected(i,!r),i.itemCheckbox.checked=!r,u.parentMenu.refreshCheckboxes()):u.activateItem(i):(u.activateItem(i),u.submit(i))};o.off("click",a);o.on("click",a);n(r).mouseenter(function(){var n=this.menuItem;u.parentMenu.isCursorInside=!0;y&&u.activateItem(n)});n(r).mouseleave(function(){var n=this.menuItem;u.parentMenu.isCursorInside=!1;setTimeout(function(){u.parentMenu.isCursorInside||n==u.activeItem&&y&&!n.subLevel&&u.deactivateItem(n)},200)})}this.itemRenderedCallback&&this.itemRenderedCallback(this.menuId,n(r))}}},remove:function(){for(var t,i,r=this.items.length,n=0;n<r;n++)t=this.items[n],t.subLevel&&t.subLevel.remove();this.levelDiv&&(this.levelDiv.innerHtml="",i=this.levelDiv.parentNode,i!=null&&i.removeChild(this.levelDiv));this.levelDiv=null},update:function(n){this.remove();this.items=n;this.activeItem=null;this.selectedItem=null;this.applyItem.itemDiv=null;this.initialized=!1;this.updated++;this.renderContent()},findItem:function(n){for(var i,r=n.toLowerCase(),u=this.items.length,t=0;t<u;t++)if(i=this.items[t],i.text.toLowerCase().indexOf(r)==0)return i;return null}};f=1;n.widget("eqjs.PopupMenu",{_mouseIsOverBlock:!1,_mouseIsOverLink:!1,_toId:null,_itemSelectedCallback:null,_menuClosedCallback:null,_itemFilterCallback:null,_rootLevel:null,options:{items:[],buttons:{submit:EQ.core.getText("ButtonApply"),cancel:EQ.core.getText("ButtonCancel")},itemFilterCallback:null,useDefaultStyles:!1,multiselect:!1,adjustHeight:!0,showSearchBoxAfter:30,activateOnMouseOver:!0,container:document.body,zIndex:1e5,domWriteItemsId:!1,itemRenderedCallback:null},_create:function(){this.menuId=f++;this._updateProps();this._rootLevel=new r({menu:this,items:this.options.items,levelIndex:0,container:this.options.container,domWriteItemsId:this.options.domWriteItemsId,menuId:this.options.id,itemRenderedCallback:this.options.itemRenderedCallback});n(this._rootLevel.levelDiv).addClass("eqjs-menu-rootLevel");n(this._rootLevel.levelDiv).css("z-index",this.options.zIndex);var t=this;this._menuKeyUpHandler=function(n){n.which==27&&(t.hideMenu(),n.stopImmediatePropagation())};this._globalMouseDownHandler=function(){if(!t.active)return!0;for(var i=window.event||arguments[0],n=i.srcElement||i.target,r=!0;n;){if(n.tagName&&n.tagName.toLowerCase()=="div"&&n.menuLevel&&n.menuLevel.parentMenu==t){r=!1;break}n=n.parentNode||n.parentElement}return r&&t.hideMenu(),!0};this._render()},_clearItemMenuProps:function(n){n.subLevel&&n.subLevel.parentMenu==this||(n.subLevel&&(n.subLevel.remove(),n.subLevel=null),n.itemDiv&&(n.itemDiv=null),n.items&&this._clearItemsMenuProps(n.items))},_clearItemsMenuProps:function(n){if(n)for(var t=0;t<n.length;t++)this._clearItemMenuProps(n[t])},_render:function(){var n=this},_updateProps:function(){this.style={};this.style.colors={border:"#666666",shadow:"#888888",bgON:"white",fgON:"black",bgOVER:"#B6BDD2",fgOVER:"black"};this.style.itemStyle={fontSize:"14px"};this.minItemWidth=0;this.maxItemWidth=0;this.maxHeight=0;this.zIndex=this.options.zIndex;this.commandTemplate="";this.parentElement=null;this.args=[];this.active=!1},_setOption:function(n,t){return arguments.length==2?(this.options[n]=t,this):this.options[n]},_setSelectedItems:function(t,i){for(var f=t?t.length:0,r,u=0;u<f;u++)r=t[u],r.items?this._setSelectedItems(r.items,i):r.selected=n.inArray(r.id,i)>=0},showMenu:function(r){var f=this,e;this._clearItemsMenuProps(this.options.items);f._itemSelectedCallback=r.itemSelectedCallback||null;f._menuClosedCallback=r.menuClosedCallback||null;f._itemFilterCallback=r.itemFilterCallback||null;e=r.selectedIds||null;e?typeof e=="string"&&(e=e.split(",")):e=[];this.active=!0;this._setSelectedItems(f.options.items,e);var s=n(r.anchor||document.documentElement),v=u(s.get(0),this.options.container),y=s.outerHeight(!0),h=s.outerWidth(!0),o={x:v.x,y:v.y+y+2},c=t(),p=i(),l=o.x+h-c.left,a=p.width-l+h,w=o.x;o.x+=2;f._rootLevel.showAt(o.x,o.y,!1,!0);f._rootLevel.levelDiv.style.width="";f._rootLevel.levelDiv.style.right="";a>=f._rootLevel.levelDiv.offsetWidth||a>=l?a<f._rootLevel.levelDiv.offsetWidth&&(f._rootLevel.levelDiv.style.right=-c.left+"px"):(f._rootLevel.levelDiv.style.left=l<f._rootLevel.levelDiv.offsetWidth?c.left+4+"px":"",f._rootLevel.levelDiv.style.right=n(window).width()-o.x-h+"px");n(f._rootLevel.levelDiv).css("visibility","visible");f._rootLevel.focus();n(document).on("keyup",this._menuKeyUpHandler);n(document).on("mousedown",this._globalMouseDownHandler)},hideMenu:function(){n(document).off("mousedown",this._globalMouseDownHandler);n(document).off("keyup",this._menuKeyUpHandler);this._rootLevel.hide();this._menuClosedCallback&&this._menuClosedCallback.call()},submitMenu:function(n,t){var i={widget:this,menuItem:n,selectedItems:t};this._itemSelectedCallback?this._itemSelectedCallback.apply(this,[null,i]):this._trigger("onMenuItemSelected",null,i)},knockMenuStyle:function(n){n.removeAttr("style");var t=n.find("ul").first().prop("style");t!=="undefined"&&t!==!1&&n.find("ul").first().prop("style","")},refreshItems:function(){this._rootLevel.refreshItems()},refreshCheckboxes:function(){this._rootLevel.refreshCheckboxes()}})}(jQuery);
/*! jQuery Timepicker Addon - v1.5.5 - 2015-05-24
* http://trentrichardson.com/examples/timepicker
* Copyright (c) 2015 Trent Richardson; Licensed MIT */
(function(n){typeof define=="function"&&define.amd?define(["jquery","jquery.ui"],n):n(jQuery)})(function(n){var t;if(n.ui.timepicker=n.ui.timepicker||{},!n.ui.timepicker.version){n.extend(n.ui,{timepicker:{version:"1.5.5"}});t=function(){this.regional=[];this.regional[""]={currentText:"Now",closeText:"Done",amNames:["AM","A"],pmNames:["PM","P"],timeFormat:"HH:mm",timeSuffix:"",timeOnlyTitle:"Choose Time",timeText:"Time",hourText:"Hour",minuteText:"Minute",secondText:"Second",millisecText:"Millisecond",microsecText:"Microsecond",timezoneText:"Time Zone",isRTL:!1};this._defaults={showButtonPanel:!0,timeOnly:!1,timeOnlyShowDate:!1,showHour:null,showMinute:null,showSecond:null,showMillisec:null,showMicrosec:null,showTimezone:null,showTime:!0,stepHour:1,stepMinute:1,stepSecond:1,stepMillisec:1,stepMicrosec:1,hour:0,minute:0,second:0,millisec:0,microsec:0,timezone:null,hourMin:0,minuteMin:0,secondMin:0,millisecMin:0,microsecMin:0,hourMax:23,minuteMax:59,secondMax:59,millisecMax:999,microsecMax:999,minDateTime:null,maxDateTime:null,maxTime:null,minTime:null,onSelect:null,hourGrid:0,minuteGrid:0,secondGrid:0,millisecGrid:0,microsecGrid:0,alwaysSetTime:!0,separator:" ",altFieldTimeOnly:!0,altTimeFormat:null,altSeparator:null,altTimeSuffix:null,altRedirectFocus:!0,pickerTimeFormat:null,pickerTimeSuffix:null,showTimepicker:!0,timezoneList:null,addSliderAccess:!1,sliderAccessArgs:null,controlType:"slider",oneLine:!1,defaultValue:null,parse:"strict",afterInject:null};n.extend(this._defaults,this.regional[""])};n.extend(t.prototype,{$input:null,$altInput:null,$timeObj:null,inst:null,hour_slider:null,minute_slider:null,second_slider:null,millisec_slider:null,microsec_slider:null,timezone_select:null,maxTime:null,minTime:null,hour:0,minute:0,second:0,millisec:0,microsec:0,timezone:null,hourMinOriginal:null,minuteMinOriginal:null,secondMinOriginal:null,millisecMinOriginal:null,microsecMinOriginal:null,hourMaxOriginal:null,minuteMaxOriginal:null,secondMaxOriginal:null,millisecMaxOriginal:null,microsecMaxOriginal:null,ampm:"",formattedDate:"",formattedTime:"",formattedDateTime:"",timezoneList:null,units:["hour","minute","second","millisec","microsec"],support:{},control:null,setDefaults:function(n){return i(this._defaults,n||{}),this},_newInst:function(i,r){var u=new t,a={},y={},h,e,o,c,f;for(o in this._defaults)if(this._defaults.hasOwnProperty(o)&&(c=i.attr("time:"+o),c))try{a[o]=eval(c)}catch(w){a[o]=c}h={beforeShow:function(t,r){if(n.isFunction(u._defaults.evnts.beforeShow))return u._defaults.evnts.beforeShow.call(i[0],t,r,u)},onChangeMonthYear:function(t,r,f){n.isFunction(u._defaults.evnts.onChangeMonthYear)&&u._defaults.evnts.onChangeMonthYear.call(i[0],t,r,f,u)},onClose:function(t,r){u.timeDefined===!0&&i.val()!==""&&u._updateDateTime(r);n.isFunction(u._defaults.evnts.onClose)&&u._defaults.evnts.onClose.call(i[0],t,r,u)}};for(e in h)h.hasOwnProperty(e)&&(y[e]=r[e]||this._defaults[e]||null);u._defaults=n.extend({},this._defaults,a,r,h,{evnts:y,timepicker:u});u.amNames=n.map(u._defaults.amNames,function(n){return n.toUpperCase()});u.pmNames=n.map(u._defaults.pmNames,function(n){return n.toUpperCase()});u.support=s(u._defaults.timeFormat+(u._defaults.pickerTimeFormat?u._defaults.pickerTimeFormat:"")+(u._defaults.altTimeFormat?u._defaults.altTimeFormat:""));typeof u._defaults.controlType=="string"?(u._defaults.controlType==="slider"&&typeof n.ui.slider=="undefined"&&(u._defaults.controlType="select"),u.control=u._controls[u._defaults.controlType]):u.control=u._defaults.controlType;f=[-720,-660,-600,-570,-540,-480,-420,-360,-300,-270,-240,-210,-180,-120,-60,0,60,120,180,210,240,270,300,330,345,360,390,420,480,525,540,570,600,630,660,690,720,765,780,840];u._defaults.timezoneList!==null&&(f=u._defaults.timezoneList);var p=f.length,l=0,v=null;if(p>0&&typeof f[0]!="object")for(;l<p;l++)v=f[l],f[l]={value:v,label:n.timepicker.timezoneOffsetString(v,u.support.iso8601)};return u._defaults.timezoneList=f,u.timezone=u._defaults.timezone!==null?n.timepicker.timezoneOffsetNumber(u._defaults.timezone):(new Date).getTimezoneOffset()*-1,u.hour=u._defaults.hour<u._defaults.hourMin?u._defaults.hourMin:u._defaults.hour>u._defaults.hourMax?u._defaults.hourMax:u._defaults.hour,u.minute=u._defaults.minute<u._defaults.minuteMin?u._defaults.minuteMin:u._defaults.minute>u._defaults.minuteMax?u._defaults.minuteMax:u._defaults.minute,u.second=u._defaults.second<u._defaults.secondMin?u._defaults.secondMin:u._defaults.second>u._defaults.secondMax?u._defaults.secondMax:u._defaults.second,u.millisec=u._defaults.millisec<u._defaults.millisecMin?u._defaults.millisecMin:u._defaults.millisec>u._defaults.millisecMax?u._defaults.millisecMax:u._defaults.millisec,u.microsec=u._defaults.microsec<u._defaults.microsecMin?u._defaults.microsecMin:u._defaults.microsec>u._defaults.microsecMax?u._defaults.microsecMax:u._defaults.microsec,u.ampm="",u.$input=i,u._defaults.altField&&(u.$altInput=n(u._defaults.altField),u._defaults.altRedirectFocus===!0&&u.$altInput.css({cursor:"pointer"}).focus(function(){i.trigger("focus")})),(u._defaults.minDate===0||u._defaults.minDateTime===0)&&(u._defaults.minDate=new Date),(u._defaults.maxDate===0||u._defaults.maxDateTime===0)&&(u._defaults.maxDate=new Date),u._defaults.minDate!==undefined&&u._defaults.minDate instanceof Date&&(u._defaults.minDateTime=new Date(u._defaults.minDate.getTime())),u._defaults.minDateTime!==undefined&&u._defaults.minDateTime instanceof Date&&(u._defaults.minDate=new Date(u._defaults.minDateTime.getTime())),u._defaults.maxDate!==undefined&&u._defaults.maxDate instanceof Date&&(u._defaults.maxDateTime=new Date(u._defaults.maxDate.getTime())),u._defaults.maxDateTime!==undefined&&u._defaults.maxDateTime instanceof Date&&(u._defaults.maxDate=new Date(u._defaults.maxDateTime.getTime())),u.$input.bind("focus",function(){u._onFocus()}),u},_addTimePicker:function(t){var i=n.trim(this.$altInput&&this._defaults.altFieldTimeOnly?this.$input.val()+" "+this.$altInput.val():this.$input.val());this.timeDefined=this._parseTime(i);this._limitMinMaxDateTime(t,!1);this._injectTimePicker();this._afterInject()},_parseTime:function(t,i){var r,u,f;if(this.inst||(this.inst=n.datepicker._getInst(this.$input[0])),i||!this._defaults.timeOnly){r=n.datepicker._get(this.inst,"dateFormat");try{if(u=e(r,this._defaults.timeFormat,t,n.datepicker._getFormatConfig(this.inst),this._defaults),!u.timeObj)return!1;n.extend(this,u.timeObj)}catch(o){return n.timepicker.log("Error parsing the date/time string: "+o+"\ndate/time string = "+t+"\ntimeFormat = "+this._defaults.timeFormat+"\ndateFormat = "+r),!1}return!0}return(f=n.datepicker.parseTime(this._defaults.timeFormat,t,this._defaults),!f)?!1:(n.extend(this,f),!0)},_afterInject:function(){var t=this.inst.settings;n.isFunction(t.afterInject)&&t.afterInject.call(this)},_injectTimePicker:function(){var y=this.inst.dpDiv,i=this.inst.settings,u=this,t="",o="",c=null,a={},l={},p=null,s=0,w=0,h,e,b,tt,v,d,f,it,g,rt,nt,k;if(y.find("div.ui-timepicker-div").length===0&&i.showTimepicker){for(h=" ui_tpicker_unit_hide",e='<div class="ui-timepicker-div'+(i.isRTL?" ui-timepicker-rtl":"")+(i.oneLine&&i.controlType==="select"?" ui-timepicker-oneLine":"")+'"><dl><dt class="ui_tpicker_time_label'+(i.showTime?"":h)+'">'+i.timeText+'<\/dt><dd class="ui_tpicker_time '+(i.showTime?"":h)+'"><\/dd>',s=0,w=this.units.length;s<w;s++){if(t=this.units[s],o=t.substr(0,1).toUpperCase()+t.substr(1),c=i["show"+o]!==null?i["show"+o]:this.support[t],a[t]=parseInt(i[t+"Max"]-(i[t+"Max"]-i[t+"Min"])%i["step"+o],10),l[t]=0,e+='<dt class="ui_tpicker_'+t+"_label"+(c?"":h)+'">'+i[t+"Text"]+'<\/dt><dd class="ui_tpicker_'+t+(c?"":h)+'"><div class="ui_tpicker_'+t+"_slider"+(c?"":h)+'"><\/div>',c&&i[t+"Grid"]>0){if(e+='<div style="padding-left: 1px"><table class="ui-tpicker-grid-label"><tr>',t==="hour")for(b=i[t+"Min"];b<=a[t];b+=parseInt(i[t+"Grid"],10))l[t]++,tt=n.datepicker.formatTime(this.support.ampm?"hht":"HH",{hour:b},i),e+='<td data-for="'+t+'">'+tt+"<\/td>";else for(v=i[t+"Min"];v<=a[t];v+=parseInt(i[t+"Grid"],10))l[t]++,e+='<td data-for="'+t+'">'+(v<10?"0":"")+v+"<\/td>";e+="<\/tr><\/table><\/div>"}e+="<\/dd>"}for(d=i.showTimezone!==null?i.showTimezone:this.support.timezone,e+='<dt class="ui_tpicker_timezone_label'+(d?"":h)+'">'+i.timezoneText+"<\/dt>",e+='<dd class="ui_tpicker_timezone'+(d?"":h)+'"><\/dd>',e+="<\/dl><\/div>",f=n(e),i.timeOnly===!0&&(f.prepend('<div class="ui-widget-header ui-helper-clearfix ui-corner-all"><div class="ui-datepicker-title">'+i.timeOnlyTitle+"<\/div><\/div>"),y.find(".ui-datepicker-header, .ui-datepicker-calendar").hide()),s=0,w=u.units.length;s<w;s++)t=u.units[s],o=t.substr(0,1).toUpperCase()+t.substr(1),c=i["show"+o]!==null?i["show"+o]:this.support[t],u[t+"_slider"]=u.control.create(u,f.find(".ui_tpicker_"+t+"_slider"),t,u[t],i[t+"Min"],a[t],i["step"+o]),c&&i[t+"Grid"]>0&&(p=100*l[t]*i[t+"Grid"]/(a[t]-i[t+"Min"]),f.find(".ui_tpicker_"+t+" table").css({width:p+"%",marginLeft:i.isRTL?"0":p/(-2*l[t])+"%",marginRight:i.isRTL?p/(-2*l[t])+"%":"0",borderCollapse:"collapse"}).find("td").click(function(){var r=n(this),f=r.html(),i=parseInt(f.replace(/[^0-9]/g),10),e=f.replace(/[^apm]/ig),o=r.data("for");o==="hour"&&(e.indexOf("p")!==-1&&i<12?i+=12:e.indexOf("a")!==-1&&i===12&&(i=0));u.control.value(u,u[o+"_slider"],t,i);u._onTimeChange();u._onSelectHandler()}).css({cursor:"pointer",width:100/l[t]+"%",textAlign:"center",overflow:"hidden"}));this.timezone_select=f.find(".ui_tpicker_timezone").append("<select><\/select>").find("select");n.fn.append.apply(this.timezone_select,n.map(i.timezoneList,function(t){return n("<option />").val(typeof t=="object"?t.value:t).text(typeof t=="object"?t.label:t)}));typeof this.timezone!="undefined"&&this.timezone!==null&&this.timezone!==""?(it=new Date(this.inst.selectedYear,this.inst.selectedMonth,this.inst.selectedDay,12).getTimezoneOffset()*-1,it===this.timezone?r(u):this.timezone_select.val(this.timezone)):typeof this.hour!="undefined"&&this.hour!==null&&this.hour!==""?this.timezone_select.val(i.timezone):r(u);this.timezone_select.change(function(){u._onTimeChange();u._onSelectHandler();u._afterInject()});g=y.find(".ui-datepicker-buttonpane");g.length?g.before(f):y.append(f);this.$timeObj=f.find(".ui_tpicker_time");this.inst!==null&&(rt=this.timeDefined,this._onTimeChange(),this.timeDefined=rt);this._defaults.addSliderAccess&&(nt=this._defaults.sliderAccessArgs,k=this._defaults.isRTL,nt.isRTL=k,setTimeout(function(){if(f.find(".ui-slider-access").length===0){f.find(".ui-slider:visible").sliderAccess(nt);var t=f.find(".ui-slider-access:eq(0)").outerWidth(!0);t&&f.find("table:visible").each(function(){var i=n(this),r=i.outerWidth(),e=i.css(k?"marginRight":"marginLeft").toString().replace("%",""),u=r-t,o=e*u/r+"%",f={width:u,marginRight:0,marginLeft:0};f[k?"marginRight":"marginLeft"]=o;i.css(f)})}},10));u._limitMinMaxDateTime(this.inst,!0)}},_limitMinMaxDateTime:function(t,i){var f=this._defaults,s=new Date(t.selectedYear,t.selectedMonth,t.selectedDay),e,h,o,c,r,u;if(this._defaults.showTimepicker&&(n.datepicker._get(t,"minDateTime")!==null&&n.datepicker._get(t,"minDateTime")!==undefined&&s&&(e=n.datepicker._get(t,"minDateTime"),h=new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0,0),(this.hourMinOriginal===null||this.minuteMinOriginal===null||this.secondMinOriginal===null||this.millisecMinOriginal===null||this.microsecMinOriginal===null)&&(this.hourMinOriginal=f.hourMin,this.minuteMinOriginal=f.minuteMin,this.secondMinOriginal=f.secondMin,this.millisecMinOriginal=f.millisecMin,this.microsecMinOriginal=f.microsecMin),t.settings.timeOnly||h.getTime()===s.getTime()?(this._defaults.hourMin=e.getHours(),this.hour<=this._defaults.hourMin?(this.hour=this._defaults.hourMin,this._defaults.minuteMin=e.getMinutes(),this.minute<=this._defaults.minuteMin?(this.minute=this._defaults.minuteMin,this._defaults.secondMin=e.getSeconds(),this.second<=this._defaults.secondMin?(this.second=this._defaults.secondMin,this._defaults.millisecMin=e.getMilliseconds(),this.millisec<=this._defaults.millisecMin?(this.millisec=this._defaults.millisecMin,this._defaults.microsecMin=e.getMicroseconds()):(this.microsec<this._defaults.microsecMin&&(this.microsec=this._defaults.microsecMin),this._defaults.microsecMin=this.microsecMinOriginal)):(this._defaults.millisecMin=this.millisecMinOriginal,this._defaults.microsecMin=this.microsecMinOriginal)):(this._defaults.secondMin=this.secondMinOriginal,this._defaults.millisecMin=this.millisecMinOriginal,this._defaults.microsecMin=this.microsecMinOriginal)):(this._defaults.minuteMin=this.minuteMinOriginal,this._defaults.secondMin=this.secondMinOriginal,this._defaults.millisecMin=this.millisecMinOriginal,this._defaults.microsecMin=this.microsecMinOriginal)):(this._defaults.hourMin=this.hourMinOriginal,this._defaults.minuteMin=this.minuteMinOriginal,this._defaults.secondMin=this.secondMinOriginal,this._defaults.millisecMin=this.millisecMinOriginal,this._defaults.microsecMin=this.microsecMinOriginal)),n.datepicker._get(t,"maxDateTime")!==null&&n.datepicker._get(t,"maxDateTime")!==undefined&&s&&(o=n.datepicker._get(t,"maxDateTime"),c=new Date(o.getFullYear(),o.getMonth(),o.getDate(),0,0,0,0),(this.hourMaxOriginal===null||this.minuteMaxOriginal===null||this.secondMaxOriginal===null||this.millisecMaxOriginal===null)&&(this.hourMaxOriginal=f.hourMax,this.minuteMaxOriginal=f.minuteMax,this.secondMaxOriginal=f.secondMax,this.millisecMaxOriginal=f.millisecMax,this.microsecMaxOriginal=f.microsecMax),t.settings.timeOnly||c.getTime()===s.getTime()?(this._defaults.hourMax=o.getHours(),this.hour>=this._defaults.hourMax?(this.hour=this._defaults.hourMax,this._defaults.minuteMax=o.getMinutes(),this.minute>=this._defaults.minuteMax?(this.minute=this._defaults.minuteMax,this._defaults.secondMax=o.getSeconds(),this.second>=this._defaults.secondMax?(this.second=this._defaults.secondMax,this._defaults.millisecMax=o.getMilliseconds(),this.millisec>=this._defaults.millisecMax?(this.millisec=this._defaults.millisecMax,this._defaults.microsecMax=o.getMicroseconds()):(this.microsec>this._defaults.microsecMax&&(this.microsec=this._defaults.microsecMax),this._defaults.microsecMax=this.microsecMaxOriginal)):(this._defaults.millisecMax=this.millisecMaxOriginal,this._defaults.microsecMax=this.microsecMaxOriginal)):(this._defaults.secondMax=this.secondMaxOriginal,this._defaults.millisecMax=this.millisecMaxOriginal,this._defaults.microsecMax=this.microsecMaxOriginal)):(this._defaults.minuteMax=this.minuteMaxOriginal,this._defaults.secondMax=this.secondMaxOriginal,this._defaults.millisecMax=this.millisecMaxOriginal,this._defaults.microsecMax=this.microsecMaxOriginal)):(this._defaults.hourMax=this.hourMaxOriginal,this._defaults.minuteMax=this.minuteMaxOriginal,this._defaults.secondMax=this.secondMaxOriginal,this._defaults.millisecMax=this.millisecMaxOriginal,this._defaults.microsecMax=this.microsecMaxOriginal)),t.settings.minTime!==null&&(r=new Date("01/01/1970 "+t.settings.minTime),this.hour<r.getHours()?(this.hour=this._defaults.hourMin=r.getHours(),this.minute=this._defaults.minuteMin=r.getMinutes()):this.hour===r.getHours()&&this.minute<r.getMinutes()?this.minute=this._defaults.minuteMin=r.getMinutes():this._defaults.hourMin<r.getHours()?(this._defaults.hourMin=r.getHours(),this._defaults.minuteMin=r.getMinutes()):this._defaults.minuteMin=this._defaults.hourMin===r.getHours()===this.hour&&this._defaults.minuteMin<r.getMinutes()?r.getMinutes():0),t.settings.maxTime!==null&&(u=new Date("01/01/1970 "+t.settings.maxTime),this.hour>u.getHours()?(this.hour=this._defaults.hourMax=u.getHours(),this.minute=this._defaults.minuteMax=u.getMinutes()):this.hour===u.getHours()&&this.minute>u.getMinutes()?this.minute=this._defaults.minuteMax=u.getMinutes():this._defaults.hourMax>u.getHours()?(this._defaults.hourMax=u.getHours(),this._defaults.minuteMax=u.getMinutes()):this._defaults.minuteMax=this._defaults.hourMax===u.getHours()===this.hour&&this._defaults.minuteMax>u.getMinutes()?u.getMinutes():59),i!==undefined&&i===!0)){var l=parseInt(this._defaults.hourMax-(this._defaults.hourMax-this._defaults.hourMin)%this._defaults.stepHour,10),a=parseInt(this._defaults.minuteMax-(this._defaults.minuteMax-this._defaults.minuteMin)%this._defaults.stepMinute,10),v=parseInt(this._defaults.secondMax-(this._defaults.secondMax-this._defaults.secondMin)%this._defaults.stepSecond,10),y=parseInt(this._defaults.millisecMax-(this._defaults.millisecMax-this._defaults.millisecMin)%this._defaults.stepMillisec,10),p=parseInt(this._defaults.microsecMax-(this._defaults.microsecMax-this._defaults.microsecMin)%this._defaults.stepMicrosec,10);this.hour_slider&&(this.control.options(this,this.hour_slider,"hour",{min:this._defaults.hourMin,max:l,step:this._defaults.stepHour}),this.control.value(this,this.hour_slider,"hour",this.hour-this.hour%this._defaults.stepHour));this.minute_slider&&(this.control.options(this,this.minute_slider,"minute",{min:this._defaults.minuteMin,max:a,step:this._defaults.stepMinute}),this.control.value(this,this.minute_slider,"minute",this.minute-this.minute%this._defaults.stepMinute));this.second_slider&&(this.control.options(this,this.second_slider,"second",{min:this._defaults.secondMin,max:v,step:this._defaults.stepSecond}),this.control.value(this,this.second_slider,"second",this.second-this.second%this._defaults.stepSecond));this.millisec_slider&&(this.control.options(this,this.millisec_slider,"millisec",{min:this._defaults.millisecMin,max:y,step:this._defaults.stepMillisec}),this.control.value(this,this.millisec_slider,"millisec",this.millisec-this.millisec%this._defaults.stepMillisec));this.microsec_slider&&(this.control.options(this,this.microsec_slider,"microsec",{min:this._defaults.microsecMin,max:p,step:this._defaults.stepMicrosec}),this.control.value(this,this.microsec_slider,"microsec",this.microsec-this.microsec%this._defaults.stepMicrosec))}},_onTimeChange:function(){var l,s;if(this._defaults.showTimepicker){var t=this.hour_slider?this.control.value(this,this.hour_slider,"hour"):!1,r=this.minute_slider?this.control.value(this,this.minute_slider,"minute"):!1,u=this.second_slider?this.control.value(this,this.second_slider,"second"):!1,f=this.millisec_slider?this.control.value(this,this.millisec_slider,"millisec"):!1,e=this.microsec_slider?this.control.value(this,this.microsec_slider,"microsec"):!1,o=this.timezone_select?this.timezone_select.val():!1,i=this._defaults,h=i.pickerTimeFormat||i.timeFormat,c=i.pickerTimeSuffix||i.timeSuffix;typeof t=="object"&&(t=!1);typeof r=="object"&&(r=!1);typeof u=="object"&&(u=!1);typeof f=="object"&&(f=!1);typeof e=="object"&&(e=!1);typeof o=="object"&&(o=!1);t!==!1&&(t=parseInt(t,10));r!==!1&&(r=parseInt(r,10));u!==!1&&(u=parseInt(u,10));f!==!1&&(f=parseInt(f,10));e!==!1&&(e=parseInt(e,10));o!==!1&&(o=o.toString());l=i[t<12?"amNames":"pmNames"][0];s=t!==parseInt(this.hour,10)||r!==parseInt(this.minute,10)||u!==parseInt(this.second,10)||f!==parseInt(this.millisec,10)||e!==parseInt(this.microsec,10)||this.ampm.length>0&&t<12!=(n.inArray(this.ampm.toUpperCase(),this.amNames)!==-1)||this.timezone!==null&&o!==this.timezone.toString();s&&(t!==!1&&(this.hour=t),r!==!1&&(this.minute=r),u!==!1&&(this.second=u),f!==!1&&(this.millisec=f),e!==!1&&(this.microsec=e),o!==!1&&(this.timezone=o),this.inst||(this.inst=n.datepicker._getInst(this.$input[0])),this._limitMinMaxDateTime(this.inst,!0));this.support.ampm&&(this.ampm=l);this.formattedTime=n.datepicker.formatTime(i.timeFormat,this,i);this.$timeObj&&(h===i.timeFormat?this.$timeObj.text(this.formattedTime+c):this.$timeObj.text(n.datepicker.formatTime(h,this,i)+c));this.timeDefined=!0;s&&this._updateDateTime()}},_onSelectHandler:function(){var n=this._defaults.onSelect||this.inst.settings.onSelect,t=this.$input?this.$input[0]:null;n&&t&&n.apply(t,[this.formattedDateTime,this])},_updateDateTime:function(t){var i;t=this.inst||t;var o=t.currentYear>0?new Date(t.currentYear,t.currentMonth,t.currentDay):new Date(t.selectedYear,t.selectedMonth,t.selectedDay),r=n.datepicker._daylightSavingAdjust(o),s=n.datepicker._get(t,"dateFormat"),f=n.datepicker._getFormatConfig(t),h=r!==null&&this.timeDefined;if(this.formattedDate=n.datepicker.formatDate(s,r===null?new Date:r,f),i=this.formattedDate,t.lastVal===""&&(t.currentYear=t.selectedYear,t.currentMonth=t.selectedMonth,t.currentDay=t.selectedDay),this._defaults.timeOnly===!0&&this._defaults.timeOnlyShowDate===!1?i=this.formattedTime:(this._defaults.timeOnly!==!0&&(this._defaults.alwaysSetTime||h)||this._defaults.timeOnly===!0&&this._defaults.timeOnlyShowDate===!0)&&(i+=this._defaults.separator+this.formattedTime+this._defaults.timeSuffix),this.formattedDateTime=i,this._defaults.showTimepicker)if(this.$altInput&&this._defaults.timeOnly===!1&&this._defaults.altFieldTimeOnly===!0)this.$altInput.val(this.formattedTime),this.$input.val(this.formattedDate);else if(this.$altInput){this.$input.val(i);var u="",c=this._defaults.altSeparator!==null?this._defaults.altSeparator:this._defaults.separator,e=this._defaults.altTimeSuffix!==null?this._defaults.altTimeSuffix:this._defaults.timeSuffix;this._defaults.timeOnly||(u=this._defaults.altFormat?n.datepicker.formatDate(this._defaults.altFormat,r===null?new Date:r,f):this.formattedDate,u&&(u+=c));u+=this._defaults.altTimeFormat!==null?n.datepicker.formatTime(this._defaults.altTimeFormat,this,this._defaults)+e:this.formattedTime+e;this.$altInput.val(u)}else this.$input.val(i);else this.$input.val(this.formattedDate);this.$input.trigger("change")},_onFocus:function(){if(!this.$input.val()&&this._defaults.defaultValue){this.$input.val(this._defaults.defaultValue);var t=n.datepicker._getInst(this.$input.get(0)),i=n.datepicker._get(t,"timepicker");if(i&&i._defaults.timeOnly&&t.input.val()!==t.lastVal)try{n.datepicker._updateDatepicker(t)}catch(r){n.timepicker.log(r)}}},_controls:{slider:{create:function(t,i,r,u,f,e,o){var s=t._defaults.isRTL;return i.prop("slide",null).slider({orientation:"horizontal",value:s?u*-1:u,min:s?e*-1:f,max:s?f*-1:e,step:o,slide:function(i,u){t.control.value(t,n(this),r,s?u.value*-1:u.value);t._onTimeChange()},stop:function(){t._onSelectHandler()}})},options:function(n,t,i,r,u){if(n._defaults.isRTL){if(typeof r=="string")return r==="min"||r==="max"?u!==undefined?t.slider(r,u*-1):Math.abs(t.slider(r)):t.slider(r);var f=r.min,e=r.max;return r.min=r.max=null,f!==undefined&&(r.max=f*-1),e!==undefined&&(r.min=e*-1),t.slider(r)}return typeof r=="string"&&u!==undefined?t.slider(r,u):t.slider(r)},value:function(n,t,i,r){return n._defaults.isRTL?r!==undefined?t.slider("value",r*-1):Math.abs(t.slider("value")):r!==undefined?t.slider("value",r):t.slider("value")}},select:{create:function(t,i,r,u,f,e,o){for(var h='<select class="ui-timepicker-select ui-state-default ui-corner-all" data-unit="'+r+'" data-min="'+f+'" data-max="'+e+'" data-step="'+o+'">',c=t._defaults.pickerTimeFormat||t._defaults.timeFormat,s=f;s<=e;s+=o)h+='<option value="'+s+'"'+(s===u?" selected":"")+">",h+=r==="hour"?n.datepicker.formatTime(n.trim(c.replace(/[^ht ]/ig,"")),{hour:s},t._defaults):r==="millisec"||r==="microsec"||s>=10?s:"0"+s.toString(),h+="<\/option>";return h+="<\/select>",i.children("select").remove(),n(h).appendTo(i).change(function(){t._onTimeChange();t._onSelectHandler();t._afterInject()}),i},options:function(n,t,i,r,u){var f={},e=t.children("select");if(typeof r=="string"){if(u===undefined)return e.data(r);f[r]=u}else f=r;return n.control.create(n,t,e.data("unit"),e.val(),f.min>=0?f.min:e.data("min"),f.max||e.data("max"),f.step||e.data("step"))},value:function(n,t,i,r){var u=t.children("select");return r!==undefined?u.val(r):u.val()}}}});n.fn.extend({timepicker:function(t){t=t||{};var i=Array.prototype.slice.call(arguments);return typeof t=="object"&&(i[0]=n.extend(t,{timeOnly:!0})),n(this).each(function(){n.fn.datetimepicker.apply(n(this),i)})},datetimepicker:function(t){t=t||{};var i=arguments;return typeof t=="string"?t==="getDate"||t==="option"&&i.length===2&&typeof i[1]=="string"?n.fn.datepicker.apply(n(this[0]),i):this.each(function(){var t=n(this);t.datepicker.apply(t,i)}):this.each(function(){var i=n(this);i.datepicker(n.timepicker._newInst(i,t)._defaults)})}});n.datepicker.parseDateTime=function(n,t,i,r,u){var o=e(n,t,i,r,u),f;return o.timeObj&&(f=o.timeObj,o.date.setHours(f.hour,f.minute,f.second,f.millisec),o.date.setMicroseconds(f.microsec)),o.date};n.datepicker.parseTime=function(t,r,u){var f=i(i({},n.timepicker._defaults),u||{}),s=t.replace(/\'.*?\'/g,"").indexOf("Z")!==-1,e=function(t,i,r){var s=function(t,i){var r=[];return t&&n.merge(r,t),i&&n.merge(r,i),r=n.map(r,function(n){return n.replace(/[.*+?|()\[\]{}\\]/g,"\\$&")}),"("+r.join("|")+")?"},h=function(n){var i=n.toLowerCase().match(/(h{1,2}|m{1,2}|s{1,2}|l{1}|c{1}|t{1,2}|z|'.*?')/g),r={h:-1,m:-1,s:-1,l:-1,c:-1,t:-1,z:-1},t;if(i)for(t=0;t<i.length;t++)r[i[t].toString().charAt(0)]===-1&&(r[i[t].toString().charAt(0)]=t+1);return r},c="^"+t.toString().replace(/([hH]{1,2}|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|'.*?')/g,function(n){var t=n.length;switch(n.charAt(0).toLowerCase()){case"h":return t===1?"(\\d?\\d)":"(\\d{"+t+"})";case"m":return t===1?"(\\d?\\d)":"(\\d{"+t+"})";case"s":return t===1?"(\\d?\\d)":"(\\d{"+t+"})";case"l":return"(\\d?\\d?\\d)";case"c":return"(\\d?\\d?\\d)";case"z":return"(z|[-+]\\d\\d:?\\d\\d|\\S+)?";case"t":return s(r.amNames,r.pmNames);default:return"("+n.replace(/\'/g,"").replace(/(\.|\$|\^|\\|\/|\(|\)|\[|\]|\?|\+|\*)/g,function(n){return"\\"+n})+")?"}}).replace(/\s/g,"\\s?")+r.timeSuffix+"$",u=h(t),o="",f,e;return(f=i.match(new RegExp(c,"i")),e={hour:0,minute:0,second:0,millisec:0,microsec:0},f)?(u.t!==-1&&(f[u.t]===undefined||f[u.t].length===0?(o="",e.ampm=""):(o=n.inArray(f[u.t].toUpperCase(),n.map(r.amNames,function(n){return n.toUpperCase()}))!==-1?"AM":"PM",e.ampm=r[o==="AM"?"amNames":"pmNames"][0])),u.h!==-1&&(e.hour=o==="AM"&&f[u.h]==="12"?0:o==="PM"&&f[u.h]!=="12"?parseInt(f[u.h],10)+12:Number(f[u.h])),u.m!==-1&&(e.minute=Number(f[u.m])),u.s!==-1&&(e.second=Number(f[u.s])),u.l!==-1&&(e.millisec=Number(f[u.l])),u.c!==-1&&(e.microsec=Number(f[u.c])),u.z!==-1&&f[u.z]!==undefined&&(e.timezone=n.timepicker.timezoneOffsetNumber(f[u.z])),e):!1},o=function(t,i,r){try{var u=new Date("2012-01-01 "+i);if(isNaN(u.getTime())&&(u=new Date("2012-01-01T"+i),isNaN(u.getTime())&&(u=new Date("01/01/2012 "+i),isNaN(u.getTime()))))throw"Unable to parse time with native Date: "+i;return{hour:u.getHours(),minute:u.getMinutes(),second:u.getSeconds(),millisec:u.getMilliseconds(),microsec:u.getMicroseconds(),timezone:u.getTimezoneOffset()*-1}}catch(f){try{return e(t,i,r)}catch(o){n.timepicker.log("Unable to parse \ntimeString: "+i+"\ntimeFormat: "+t)}}return!1};return typeof f.parse=="function"?f.parse(t,r,f):f.parse==="loose"?o(t,r,f):e(t,r,f)};n.datepicker.formatTime=function(t,i,r){r=r||{};r=n.extend({},n.timepicker._defaults,r);i=n.extend({hour:0,minute:0,second:0,millisec:0,microsec:0,timezone:null},i);var o=t,f=r.amNames[0],e=parseInt(i.hour,10);return e>11&&(f=r.pmNames[0]),o.replace(/(?:HH?|hh?|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|'.*?')/g,function(t){switch(t){case"HH":return("0"+e).slice(-2);case"H":return e;case"hh":return("0"+u(e)).slice(-2);case"h":return u(e);case"mm":return("0"+i.minute).slice(-2);case"m":return i.minute;case"ss":return("0"+i.second).slice(-2);case"s":return i.second;case"l":return("00"+i.millisec).slice(-3);case"c":return("00"+i.microsec).slice(-3);case"z":return n.timepicker.timezoneOffsetString(i.timezone===null?r.timezone:i.timezone,!1);case"Z":return n.timepicker.timezoneOffsetString(i.timezone===null?r.timezone:i.timezone,!0);case"T":return f.charAt(0).toUpperCase();case"TT":return f.toUpperCase();case"t":return f.charAt(0).toLowerCase();case"tt":return f.toLowerCase();default:return t.replace(/'/g,"")}})};n.datepicker._base_selectDate=n.datepicker._selectDate;n.datepicker._selectDate=function(t,i){var r=this._getInst(n(t)[0]),u=this._get(r,"timepicker"),f;u&&r.settings.showTimepicker?(u._limitMinMaxDateTime(r,!0),f=r.inline,r.inline=r.stay_open=!0,this._base_selectDate(t,i),r.inline=f,r.stay_open=!1,this._notifyChange(r),this._updateDatepicker(r)):this._base_selectDate(t,i)};n.datepicker._base_updateDatepicker=n.datepicker._updateDatepicker;n.datepicker._updateDatepicker=function(t){var r=t.input[0],i;n.datepicker._curInst&&n.datepicker._curInst!==t&&n.datepicker._datepickerShowing&&n.datepicker._lastInput!==r||(typeof t.stay_open!="boolean"||t.stay_open===!1)&&(this._base_updateDatepicker(t),i=this._get(t,"timepicker"),i&&i._addTimePicker(t))};n.datepicker._base_doKeyPress=n.datepicker._doKeyPress;n.datepicker._doKeyPress=function(t){var u=n.datepicker._getInst(t.target),i=n.datepicker._get(u,"timepicker");if(i&&n.datepicker._get(u,"constrainInput")){var r=i.support.ampm,o=i._defaults.showTimezone!==null?i._defaults.showTimezone:i.support.timezone,f=n.datepicker._possibleChars(n.datepicker._get(u,"dateFormat")),s=i._defaults.timeFormat.toString().replace(/[hms]/g,"").replace(/TT/g,r?"APM":"").replace(/Tt/g,r?"AaPpMm":"").replace(/tT/g,r?"AaPpMm":"").replace(/T/g,r?"AP":"").replace(/tt/g,r?"apm":"").replace(/t/g,r?"ap":"")+" "+i._defaults.separator+i._defaults.timeSuffix+(o?i._defaults.timezoneList.join(""):"")+i._defaults.amNames.join("")+i._defaults.pmNames.join("")+f,e=String.fromCharCode(t.charCode===undefined?t.keyCode:t.charCode);return t.ctrlKey||e<" "||!f||s.indexOf(e)>-1}return n.datepicker._base_doKeyPress(t)};n.datepicker._base_updateAlternate=n.datepicker._updateAlternate;n.datepicker._updateAlternate=function(t){var i=this._get(t,"timepicker"),u;if(i){if(u=i._defaults.altField,u){var c=i._defaults.altFormat||i._defaults.dateFormat,f=this._getDate(t),o=n.datepicker._getFormatConfig(t),r="",e=i._defaults.altSeparator?i._defaults.altSeparator:i._defaults.separator,s=i._defaults.altTimeSuffix?i._defaults.altTimeSuffix:i._defaults.timeSuffix,h=i._defaults.altTimeFormat!==null?i._defaults.altTimeFormat:i._defaults.timeFormat;r+=n.datepicker.formatTime(h,i,i._defaults)+s;i._defaults.timeOnly||i._defaults.altFieldTimeOnly||f===null||(r=i._defaults.altFormat?n.datepicker.formatDate(i._defaults.altFormat,f,o)+e+r:i.formattedDate+e+r);n(u).val(t.input.val()?r:"")}}else n.datepicker._base_updateAlternate(t)};n.datepicker._base_doKeyUp=n.datepicker._doKeyUp;n.datepicker._doKeyUp=function(t){var i=n.datepicker._getInst(t.target),r=n.datepicker._get(i,"timepicker");if(r&&r._defaults.timeOnly&&i.input.val()!==i.lastVal)try{n.datepicker._updateDatepicker(i)}catch(u){n.timepicker.log(u)}return n.datepicker._base_doKeyUp(t)};n.datepicker._base_gotoToday=n.datepicker._gotoToday;n.datepicker._gotoToday=function(t){var i=this._getInst(n(t)[0]),e=i.dpDiv,f=this._get(i,"timepicker"),u;r(f);u=new Date;this._setTime(i,u);this._setDate(i,u);this._base_gotoToday(t)};n.datepicker._disableTimepickerDatepicker=function(t){var i=this._getInst(t),r;i&&(r=this._get(i,"timepicker"),n(t).datepicker("getDate"),r&&(i.settings.showTimepicker=!1,r._defaults.showTimepicker=!1,r._updateDateTime(i)))};n.datepicker._enableTimepickerDatepicker=function(t){var i=this._getInst(t),r;i&&(r=this._get(i,"timepicker"),n(t).datepicker("getDate"),r&&(i.settings.showTimepicker=!0,r._defaults.showTimepicker=!0,r._addTimePicker(i),r._updateDateTime(i)))};n.datepicker._setTime=function(n,t){var i=this._get(n,"timepicker"),r;i&&(r=i._defaults,i.hour=t?t.getHours():r.hour,i.minute=t?t.getMinutes():r.minute,i.second=t?t.getSeconds():r.second,i.millisec=t?t.getMilliseconds():r.millisec,i.microsec=t?t.getMicroseconds():r.microsec,i._limitMinMaxDateTime(n,!0),i._onTimeChange(),i._updateDateTime(n))};n.datepicker._setTimeDatepicker=function(n,t,i){var f=this._getInst(n),r,u;f&&(r=this._get(f,"timepicker"),r&&(this._setDateFromField(f),t&&(typeof t=="string"?(r._parseTime(t,i),u=new Date,u.setHours(r.hour,r.minute,r.second,r.millisec),u.setMicroseconds(r.microsec)):(u=new Date(t.getTime()),u.setMicroseconds(t.getMicroseconds())),u.toString()==="Invalid Date"&&(u=undefined),this._setTime(f,u))))};n.datepicker._base_setDateDatepicker=n.datepicker._setDateDatepicker;n.datepicker._setDateDatepicker=function(t,i){var e=this._getInst(t),r=i,f,u;e&&(typeof i=="string"&&(r=new Date(i),r.getTime()||(this._base_setDateDatepicker.apply(this,arguments),r=n(t).datepicker("getDate"))),f=this._get(e,"timepicker"),r instanceof Date?(u=new Date(r.getTime()),u.setMicroseconds(r.getMicroseconds())):u=r,f&&u&&(f.support.timezone||f._defaults.timezone!==null||(f.timezone=u.getTimezoneOffset()*-1),r=n.timepicker.timezoneAdjust(r,f.timezone),u=n.timepicker.timezoneAdjust(u,f.timezone)),this._updateDatepicker(e),this._base_setDateDatepicker.apply(this,arguments),this._setTimeDatepicker(t,u,!0))};n.datepicker._base_getDateDatepicker=n.datepicker._getDateDatepicker;n.datepicker._getDateDatepicker=function(t,i){var f=this._getInst(t),r,u,e;if(f)return(r=this._get(f,"timepicker"),r)?(f.lastVal===undefined&&this._setDateFromField(f,i),u=this._getDate(f),e=n.trim(r.$altInput&&r._defaults.altFieldTimeOnly?r.$input.val()+" "+r.$altInput.val():r.$input.val()),u&&r._parseTime(e,!f.settings.timeOnly)&&(u.setHours(r.hour,r.minute,r.second,r.millisec),u.setMicroseconds(r.microsec),r.timezone!=null&&(r.support.timezone||r._defaults.timezone!==null||(r.timezone=u.getTimezoneOffset()*-1),u=n.timepicker.timezoneAdjust(u,r.timezone))),u):this._base_getDateDatepicker(t,i)};n.datepicker._base_parseDate=n.datepicker.parseDate;n.datepicker.parseDate=function(t,i,r){var f;try{f=this._base_parseDate(t,i,r)}catch(u){if(u.indexOf(":")>=0)f=this._base_parseDate(t,i.substring(0,i.length-(u.length-u.indexOf(":")-2)),r),n.timepicker.log("Error parsing the date string: "+u+"\ndate string = "+i+"\ndate format = "+t);else throw u;}return f};n.datepicker._base_formatDate=n.datepicker._formatDate;n.datepicker._formatDate=function(n){var t=this._get(n,"timepicker");return t?(t._updateDateTime(n),t.$input.val()):this._base_formatDate(n)};n.datepicker._base_optionDatepicker=n.datepicker._optionDatepicker;n.datepicker._optionDatepicker=function(t,i,r){var y=this._getInst(t),s,h;if(!y)return null;if(h=this._get(y,"timepicker"),h){var u=null,f=null,a=null,c=h._defaults.evnts,l={},e,p,w,v;if(typeof i=="string"){if(i==="minDate"||i==="minDateTime")u=r;else if(i==="maxDate"||i==="maxDateTime")f=r;else if(i==="onSelect")a=r;else if(c.hasOwnProperty(i)){if(typeof r=="undefined")return c[i];l[i]=r;s={}}}else if(typeof i=="object"){i.minDate?u=i.minDate:i.minDateTime?u=i.minDateTime:i.maxDate?f=i.maxDate:i.maxDateTime&&(f=i.maxDateTime);for(e in c)c.hasOwnProperty(e)&&i[e]&&(l[e]=i[e])}for(e in l)l.hasOwnProperty(e)&&(c[e]=l[e],s||(s=n.extend({},i)),delete s[e]);if(s&&o(s))return;if(u?(u=u===0?new Date:new Date(u),h._defaults.minDate=u,h._defaults.minDateTime=u):f?(f=f===0?new Date:new Date(f),h._defaults.maxDate=f,h._defaults.maxDateTime=f):a&&(h._defaults.onSelect=a),u||f)return v=n(t),w=v.datetimepicker("getDate"),p=this._base_optionDatepicker.call(n.datepicker,t,s||i,r),v.datetimepicker("setDate",w),p}return r===undefined?this._base_optionDatepicker.call(n.datepicker,t,i):this._base_optionDatepicker.call(n.datepicker,t,s||i,r)};var o=function(n){for(var t in n)if(n.hasOwnProperty(t))return!1;return!0},i=function(t,i){n.extend(t,i);for(var r in i)(i[r]===null||i[r]===undefined)&&(t[r]=i[r]);return t},s=function(n){var i=n.replace(/'.*?'/g,"").toLowerCase(),t=function(n,t){return n.indexOf(t)!==-1?!0:!1};return{hour:t(i,"h"),minute:t(i,"m"),second:t(i,"s"),millisec:t(i,"l"),microsec:t(i,"c"),timezone:t(i,"z"),ampm:t(i,"t")&&t(n,"h"),iso8601:t(n,"Z")}},u=function(n){return n%=12,n===0&&(n=12),String(n)},f=function(t,i){return t&&t[i]?t[i]:n.timepicker._defaults[i]},h=function(n,t){var i=f(t,"separator"),o=f(t,"timeFormat"),s=o.split(i),u=s.length,r=n.split(i),e=r.length;return e>1?{dateString:r.splice(0,e-u).join(i),timeString:r.splice(0,u).join(i)}:{dateString:n,timeString:""}},e=function(t,i,r,u,f){var o,e,s;if(e=h(r,f),o=n.datepicker._base_parseDate(t,e.dateString,u),e.timeString==="")return{date:o};if(s=n.datepicker.parseTime(i,e.timeString,f),!s)throw"Wrong time format";return{date:o,timeObj:s}},r=function(n,t){if(n&&n.timezone_select){var i=t||new Date;n.timezone_select.val(-i.getTimezoneOffset())}};n.timepicker=new t;n.timepicker.timezoneOffsetString=function(n,t){if(isNaN(n)||n>840||n<-720)return n;var i=n,r=i%60,f=(i-r)/60,e=t?":":"",u=(i>=0?"+":"-")+("0"+Math.abs(f)).slice(-2)+e+("0"+Math.abs(r)).slice(-2);return u==="+00:00"?"Z":u};n.timepicker.timezoneOffsetNumber=function(n){var t=n.toString().replace(":","");return t.toUpperCase()==="Z"?0:/^(\-|\+)\d{4}$/.test(t)?(t.substr(0,1)==="-"?-1:1)*(parseInt(t.substr(1,2),10)*60+parseInt(t.substr(3,2),10)):n};n.timepicker.timezoneAdjust=function(t,i){var r=n.timepicker.timezoneOffsetNumber(i);return isNaN(r)||t.setMinutes(t.getMinutes()+-t.getTimezoneOffset()-r),t};n.timepicker.timeRange=function(t,i,r){return n.timepicker.handleRange("timepicker",t,i,r)};n.timepicker.datetimeRange=function(t,i,r){n.timepicker.handleRange("datetimepicker",t,i,r)};n.timepicker.dateRange=function(t,i,r){n.timepicker.handleRange("datepicker",t,i,r)};n.timepicker.handleRange=function(t,i,r,u){function o(n,f){var s=i[t]("getDate"),h=r[t]("getDate"),c=n[t]("getDate"),e,o;s!==null&&(e=new Date(s.getTime()),o=new Date(s.getTime()),e.setMilliseconds(e.getMilliseconds()+u.minInterval),o.setMilliseconds(o.getMilliseconds()+u.maxInterval),u.minInterval>0&&e>h?r[t]("setDate",e):u.maxInterval>0&&o<h?r[t]("setDate",o):s>h&&f[t]("setDate",c))}function f(n,i,r){if(n.val()){var f=n[t].call(n,"getDate");f!==null&&u.minInterval>0&&(r==="minDate"&&f.setMilliseconds(f.getMilliseconds()+u.minInterval),r==="maxDate"&&f.setMilliseconds(f.getMilliseconds()-u.minInterval));f.getTime&&i[t].call(i,"option",r,f)}}u=n.extend({},{minInterval:0,maxInterval:0,start:{},end:{}},u);var e=!1;return t==="timepicker"&&(e=!0,t="datetimepicker"),n.fn[t].call(i,n.extend({timeOnly:e,onClose:function(){o(n(this),r)},onSelect:function(){f(n(this),r,"minDate")}},u,u.start)),n.fn[t].call(r,n.extend({timeOnly:e,onClose:function(){o(n(this),i)},onSelect:function(){f(n(this),i,"maxDate")}},u,u.end)),o(i,r),f(i,r,"minDate"),f(r,i,"maxDate"),n([i.get(0),r.get(0)])};n.timepicker.log=function(){window.console&&window.console.log.apply(window.console,Array.prototype.slice.call(arguments))};n.timepicker._util={_extendRemove:i,_isEmptyObject:o,_convert24to12:u,_detectSupport:s,_selectLocalTimezone:r,_computeEffectiveSetting:f,_splitDateTime:h,_parseDateTimeInternal:e};Date.prototype.getMicroseconds||(Date.prototype.microseconds=0,Date.prototype.getMicroseconds=function(){return this.microseconds},Date.prototype.setMicroseconds=function(n){return this.setMilliseconds(this.getMilliseconds()+Math.floor(n/1e3)),this.microseconds=n%1e3,this});n.timepicker.version="1.5.5"}}),function(n,t){var i=t.EQ=t.EQ||{};i.client={defaultQuery:new i.core.Query,serviceUrl:"EasyQuery",locale:"",_currentOptions:{},_modelPromise:null,_updateActionUrls:function(){var n=i.core;this.loadModelUrl=n.combinePath(this.serviceUrl,"GetModel");this.newQueryUrl=n.combinePath(this.serviceUrl,"NewQuery");this.loadQueryUrl=n.combinePath(this.serviceUrl,"GetQuery");this.saveQueryUrl=n.combinePath(this.serviceUrl,"SaveQuery");this.buildQueryUrl=n.combinePath(this.serviceUrl,"BuildQuery");this.syncQueryUrl=n.combinePath(this.serviceUrl,"SyncQuery");this.executeQueryUrl=n.combinePath(this.serviceUrl,"ExecuteQuery");this.executeSqlUrl=n.combinePath(this.serviceUrl,"ExecuteSql");this.listRequestUrl=n.combinePath(this.serviceUrl,"GetList");this.loadQueryListUrl=n.combinePath(this.serviceUrl,"GetQueryList");this.removeQueryUrl=n.combinePath(this.serviceUrl,"RemoveQuery")},_addAntiForgeryToken:function(n){return this.antiForgeryToken?(n.__RequestVerificationToken=this.antiForgeryToken,n):n},defaultListRequestHandler:function(){},queryChanged:function(n,t){t?this.defaultQuery.removeChangedCallback(n):this.defaultQuery.addChangedCallback(n)},controls:{},initControlsDefault:function(t){var i=t||{},c=t.queryContentInputId||"QueryContentJson",l=t.queryPanelId||"QueryPanel",a=t.columnsPanelId||"ColumnsPanel",v=t.entitiesPanelId||"EntitiesPanel",y=t.filterBarId||"FilterBar",p=t.columnsBarId||"ColumnsBar",w=t.sortingBarId||"SortingBar",h=n("#"+c),r,u,f,e,o,s;h.length>0&&(this.controls.queryContentInput=h);r=n("#"+l);r.length>0&&(i.queryPanel=i.queryPanel||{},r.QueryPanel(i.queryPanel),r.QueryPanel("setQuery",this.defaultQuery),this.controls.QPWidget=r);u=n("#"+a);u.length>0&&(i.columnsPanel=i.columnsPanel||{},i.columnsPanel.query=this.defaultQuery,u.ColumnsPanel(i.columnsPanel),u.ColumnsPanel("setQuery",this.defaultQuery),this.controls.CPWidget=u);f=n("#"+v);f.length>0&&(i.entitiesPanel=i.entitiesPanel||{},f.EntitiesPanel(i.entitiesPanel),f.EntitiesPanel("setQuery",this.defaultQuery),this.controls.EPWidget=f);e=n("#"+y);e.length>0&&(i.filterBar=i.filterBar||{},e.FilterBar(i.filterBar),e.FilterBar("setQuery",this.defaultQuery),this.controls.FBWidget=e);o=n("#"+p);o.length>0&&(i.columnsBar=i.columnsBar||{},i.columnsBar.query=this.defaultQuery,o.ColumnsBar(i.columnsBar),o.ColumnsBar("setQuery",this.defaultQuery),this.controls.CBWidget=o);s=n("#"+w);s.length>0&&(i.sortingBar=i.sortingBar||{},i.sortingBar.query=this.defaultQuery,s.SortingBar(i.sortingBar),s.SortingBar("setQuery",this.defaultQuery),this.controls.SRTBWidget=s)},init:function(r){var e,o,f,h,c,u,l,s;if(r=r||t.easyQuerySettings||this._currentOptions,this._currentOptions=r,this.defaultQuery.attrClassName=r.attrClassName||"ENTATTR",r.serviceUrl&&(this.serviceUrl=r.serviceUrl),r.menuOptions){e=this.menuOptions;o=r.menuOptions;for(f in e)e.hasOwnProperty(f)&&o.hasOwnProperty(f)&&(e[f]=o[f])}r.defaultQueryId&&this.defaultQuery.setId(r.defaultQueryId);r.listCache&&this.defaultQuery.setExternalListCache(r.listCache);this._updateActionUrls();r.loadModelUrl&&(this.loadModelUrl=r.loadModelUrl);r.newQueryUrl&&(this.newQueryUrl=r.newQueryUrl);r.loadQueryUrl&&(this.loadQueryUrl=r.loadQueryUrl);r.saveQueryUrl&&(this.saveQueryUrl=r.saveQueryUrl);r.buildQueryUrl&&(this.buildQueryUrl=r.buildQueryUrl);r.syncQueryUrl&&(this.syncQueryUrl=r.syncQueryUrl);r.executeQueryUrl&&(this.executeQueryUrl=r.executeQueryUrl);r.executeSqlUrl&&(this.executeSqlUrl=r.executeSqlUrl);r.listRequestUrl&&(this.listRequestUrl=r.listRequestUrl);r.useBootstrap&&(this.useBootstrap=r.useBootstrap);this.modelName=r.modelName||"";this.modelId=r.modelId||r.modelName;this.initialQuery=r.initialQuery;this.loadDefaultQuery=!1;r.loadQueryOnStart&&(this.loadDefaultQuery=r.loadQueryOnStart);r.loadDefaultQuery&&(this.loadDefaultQuery=r.loadDefaultQuery);h=r.defaultQueryName||"";c=r.defaultQueryId||"";this.antiForgeryToken=r.antiForgeryToken;r.locale&&(this.locale=r.locale);r.queryPanel=r.queryPanel||{};u=this;l=function(t,i){var r=u.getQuery(),f=n.extend({modelId:r.getModel().getId()},t),e=u._addAntiForgeryToken(f);u._ajaxRequest({url:u.listRequestUrl,data:JSON.stringify(e),success:function(n){i(n)},error:function(){i(null)}})};this.defaultQuery.clientListRequestHandler=r.listRequestHandler||r.queryPanel.listRequestHandler;this.defaultQuery.serverListRequestHandler=l;r.onError&&(i.core.onError=r.onError);r.onInit&&(this.onInit=r.onInit);r.onLoadModel&&(this.onLoadModel=r.onLoadModel);r.onLoadQuery&&(this.onLoadQuery=r.onLoadQuery);this.initControlsDefault(r);(this.modelId||r.loadDefaultModel)&&(s=r.loadDefaultModel?"":this.modelId,this.loadModel({modelId:s,success:function(n){var t=u.getQuery();if(u.initialQuery&&t.setObject(u.initialQuery),u.controls.queryContentInput&&t.setObject(u.controls.queryContentInput.val()),u.loadDefaultQuery?u.loadQuery({id:c||h,modelId:s,success:function(){u.onInit&&u.onInit()}}):u.onInit&&u.onInit(),u.onInitialModelLoad)u.onInitialModelLoad(n)}}))},getQuery:function(){return this.defaultQuery},refreshWidgets:function(n){n&&this.controls.EPWidget&&this.controls.EPWidget.EntitiesPanel("refresh");this.controls.QPWidget&&this.controls.QPWidget.QueryPanel("refresh");this.controls.CPWidget&&this.controls.CPWidget.ColumnsPanel("refresh");this.controls.FBWidget&&this.controls.FBWidget.FilterBar("refresh");this.controls.CBWidget&&this.controls.CBWidget.ColumnsBar("refresh");this.controls.SRTBWidget&&this.controls.SRTBWidget.SortingBar("refresh")},_ajaxRequest:function(t){var i=n.extend({type:"POST",contentType:"application/json",dataType:"json"},t);return typeof t.data!="string"&&(i.data=JSON.stringify(t.data)),n.ajax(i)},loadModel:function(n){var t=this;n=n||{};var r=n.modelId||"",u=n.data||{},f=this._addAntiForgeryToken({modelId:r,data:u});t.controls.EPWidget&&t.controls.EPWidget.EntitiesPanel("startLoading");this._modelPromise=this._ajaxRequest({url:i.client.loadModelUrl,data:JSON.stringify(f),beforeSend:n.beforeSend,crossDomain:!1,success:function(i){t.defaultQuery.loadModelObject(i);t.refreshWidgets(!0);var r=t.getQuery().getModel();if(t.controls.EPWidget&&t.controls.EPWidget.EntitiesPanel("finishLoading"),n.success&&n.success(i),t.onLoadModel)t.onLoadModel(i)},error:function(i){t.controls.EPWidget&&t.controls.EPWidget.EntitiesPanel("finishLoading");n.error?n.error(i.status,i.responseText,"LoadModel"):alert("LoadModel error: \n"+i.responseText)}})},_doWhenModelLoaded:function(n){var t=this,i=this.getQuery().getModel();i&&!i.isEmpty()&&t._modelPromise&&t._modelPromise.done(n)},newQuery:function(n){var t=this,f=this.getQuery(),r=f.getModel(),e=n.modelId||(r?r.getId():""),o=n.queryName||"",u=this._addAntiForgeryToken({modelId:e,queryName:o});n.data&&(u.data=n.data);t._doWhenModelLoaded(function(){t._ajaxRequest({url:i.client.newQueryUrl,data:JSON.stringify(u),beforeSend:n.beforeSend,success:function(i){i.query?t.defaultQuery.setObject(i.query):t.defaultQuery.setObject(i);t.refreshWidgets();n.success&&n.success(i)},error:function(t){n.error?n.error(t.status,t.responseText,"NewQuery"):alert("NewQuery error: \n"+t.responseText)}})})},loadQuery:function(n){var t=this,f=this.getQuery(),r,u;n||(n={});r=n.silent||!1;typeof n.id=="undefined"&&(n.id=n.queryId?n.queryId:f.getId());n.modelId||(n.modelId=f.getModel().getId());u=this._addAntiForgeryToken({id:n.id,modelId:n.modelId});n.data&&(u.data=n.data);t._doWhenModelLoaded(function(){t._ajaxRequest({url:i.client.loadQueryUrl,data:JSON.stringify(u),beforeSend:n.beforeSend,success:function(i){if(i.query?t.defaultQuery.setObject(i.query,r):t.defaultQuery.setObject(i,r),n.success&&n.success(i),t.onLoadQuery)t.onLoadQuery(data)},error:function(t){n.error?n.error(t.status,t.responseText,"LoadQuery"):alert("LoadQuery error: \n"+t.responseText)}})})},loadQueryList:function(n){var u=this,i=this.getQuery(),n=n||{},r=n.modelId||i.getModel().getId(),t=this._addAntiForgeryToken({modelId:r});n.data&&(t.data=n.data);this._ajaxRequest({url:this.loadQueryListUrl,data:JSON.stringify(t),beforeSend:n.beforeSend,success:function(t){n.success&&n.success(t)},error:function(t){n.error?n.error(t.status,t.responseText,"LoadQueryList"):alert("LoadQueryList error: \n"+t.responseText)}})},removeQuery:function(n){var t=this.getQuery(),u,r;n=n||{};u=n.modelId||t.getModel().getId();queryId=n.id||n.queryId||t.getId();r=this._addAntiForgeryToken({modelId:u,id:queryId,queryId:queryId});n.data&&(r.data=n.data);self=this;this._ajaxRequest({url:i.client.removeQueryUrl,data:r,beforeSend:n.beforeSend,success:function(i){t.setId(null);t.clear(!0);n.success&&n.success(i)},error:function(t){n.error?n.error(t.status,t.responseText,"SaveQuery"):alert("RemoveQuery error: \n"+t.responseText)}})},clearQuery:function(){var t=this,n=this.getQuery();n.clear()},saveQuery:function(n){var t,r,u;n=n||{};t=n.query||this.getQuery();r="";t&&(modelId=n.modelId||t.getModel().getId(),r=n.queryName||t.getName(),n.queryId&&t.setId(n.queryId),u=this._addAntiForgeryToken({query:t.getQueryObject(),queryName:r}),n.data&&(u.data=n.data),self=this,this._ajaxRequest({url:i.client.saveQueryUrl,data:JSON.stringify(u),beforeSend:n.beforeSend,success:function(t){t.query&&self.defaultQuery.setObject(t.query);self.refreshWidgets();n.success&&n.success(t)},error:function(t){n.error?n.error(t.status,t.responseText,"SaveQuery"):alert("SaveQuery error: \n"+t.responseText)}}))},buildQuery:function(n){var t,u,r;n=n||{};t=n.query||this.getQuery();t&&(u=n.options||{},r=this._addAntiForgeryToken({query:t.getQueryObject(),options:u}),n.data&&(r.data=n.data),this._ajaxRequest({url:i.client.buildQueryUrl,data:JSON.stringify(r),beforeSend:n.beforeSend,success:function(t){n.success&&n.success(t)},error:function(t){n.error?n.error(t.status,t.responseText,"BuildQuery"):alert("BuildQuery error: \n"+t.responseText)}}))},syncQuery:function(n){var t;if(n=n||{},t=n.query||this.getQuery(),t){var u=this._currentOptions.syncQueryOptions||null,f=n.options||u||{},r=this._addAntiForgeryToken({query:t.getQueryObject(),options:f});n.data&&(r.data=n.data);this._ajaxRequest({url:i.client.syncQueryUrl,data:JSON.stringify(r),beforeSend:n.beforeSend,success:function(t){n.success&&n.success(t)},error:function(t){n.error?n.error(t.status,t.responseText,"SyncQuery"):alert("SyncQuery error: \n"+t.responseText)}})}},buildAndExecute:function(t){var r=this;t=t||{};var u=t.query||this.getQuery(),f=this._currentOptions.syncQueryOptions||{},e=t.options||{},o=n.extend(f,e),i=this._addAntiForgeryToken({query:u.getQueryObject(),options:o});t.data&&(i.data=t.data);this._ajaxRequest({url:r.executeQueryUrl,data:JSON.stringify(i),beforeSend:t.beforeSend,success:function(n){t.success&&t.success(n)},error:function(n){t.error?t.error(n.status,n.responseText,"ExecuteQuery"):alert("ExecuteQuery error: \n"+n.responseText)}})}}}(jQuery,window),function(n){n.widget("eqjs.ConditionRow",{_condition:null,_parentPredicate:null,_parentPredicateWidget:null,_buttonsBlock:null,_enableButton:null,_deleteButton:null,_addConditionButton:null,_addPredicateButton:null,_checkBox:null,_keepShowingButtons:!1,_isMouseOverBlock:!1,_active:!1,options:{queryPanel:null},getQuery:function(){return this.options.queryPanel.getQuery()},getModel:function(){var n=this.getQuery();return n?n.getModel():null},getCondition:function(){return this._condition},getQueryPanel:function(){return this.options.queryPanel},makeActive:function(){var n=this.getQueryPanel();n&&n.setActiveConditionWidget(this)},init:function(t,i,r){this.element.get(0).condition=t;this._condition=t;this._parentPredicate=i;this._parentPredicateWidget=r;this._buttonsToShow=this.isPredicate()?this.options.queryPanel&&this.options.queryPanel.options.buttons&&this.options.queryPanel.options.buttons.predicate&&n.isArray(this.options.queryPanel.options.buttons.predicate)?this.options.queryPanel.options.buttons.predicate:["addCondition","addPredicate","enable","delete"]:this.options.queryPanel&&this.options.queryPanel.options.buttons&&this.options.queryPanel.options.buttons.condition&&n.isArray(this.options.queryPanel.options.buttons.condition)?this.options.queryPanel.options.buttons.condition:["enable","delete"];this.refresh();this._condition.initAsActive&&(this.makeActive(),delete this._condition.initAsActive)},_render:function(){this._clear();this.getModel()&&this._condition&&(this._refreshByCondition(),this._condition.readOnly||(this._initButtons(),this._initCheckbox(),this.getQueryPanel().options.activeCondition==this._condition&&this.makeActive()),this._postRender())},_postRender:function(){},refresh:function(){this._render()},_isDisabled:function(){return this._condition.enabled===!1},_isParameterized:function(){return this._condition.parameterized},_isInJoin:function(){return this._condition.inJoin},_setOption:function(n,t){return arguments.length==2?(n==="disabled"?this._setConditionEnable(!t):n==="parameterized"?(this._setConditionParameterized(t),this._render()):n==="inJoin"?(this._setConditionAsInJoin(t),this._render()):(this.options[n]=t,this._render()),this):n==="disabled"?this._isDisabled():n==="parameterized"?this._isParameterized():n==="joinOnly"?this._isInJoin():this.options[n]},_setConditionEnable:function(n,t){this._parentPredicate&&(n&&"enabled"in this._parentPredicate&&!this._parentPredicate.enabled||(this._setConditionEnableCore(this._condition,n,t),this._enableButton&&(n?this._enableButton.addClass("enabled"):this._enableButton.removeClass("enabled")),this._render(),this._fireConditionChange({type:"change"})))},_setConditionEnableCore:function(n,t,i){var u,r;if(n.enabled=t,n.conditions&&!i)for(u=n.conditions.length,r=0;r<u;r++)this._setConditionEnableCore(n.conditions[r],t);this._parentPredicateWidget&&this._parentPredicateWidget._checkAllDisabled()},_setConditionParameterized:function(n){this._condition.parameterized=n;this._fireConditionChange({type:"change"})},_setConditionAsInJoin:function(n){this._condition.inJoin=n;this._fireConditionChange({type:"change"})},_clear:function(){this.element.html("");this.element.removeClass()},_refreshByCondition:function(){},_fireConditionChange:function(n){var t=this;n=n||{};this.getQuery().fireChangedEvent({source:t.getQueryPanel(),changeType:"condition."+n.type||"change",what:n.what||"",condition:n.condition||t._condition,element:n.element||t.element},!0)},remove:function(){var n=this;n._parentPredicateWidget&&n._parentPredicateWidget.removeCondition(n._condition)},isPredicate:function(){return!1},_getButtonsContainer:function(){return this.element},_conditionMenuEventHandler:function(n,t){var i=this,u;switch(n){case"addCondition":if(t.fromMenu){if(!("addNewCondition"in i))return;var r=i.getModel().getFirstUICAttr(),f=r?r.id:-1,e=r?r.operators[0]:-1,o=this.getQuery(),s={blockId:i.getQueryPanel().getNewCondId(),justAdded:!0,typeName:"SMPL",enabled:!0,operatorID:e,expressions:[{typeName:o.attrClassName,id:f,kind:"Attribute"}]};i.addCondition(s)}else i._keepShowingButtons=!0,i.options.queryPanel.showEntitiesMenu({anchor:t.target,selectedIds:null,itemSelectedCallback:function(n,t){var r=t.menuItem.data("id"),u=i.getModel().getAttributeById(r);"addNewCondition"in i&&i.addNewCondition(r)},menuClosedCallback:function(){i._keepShowingButtons=!1;i._isMouseOverBlock||i._leaveButtonBlock()}});break;case"addPredicate":"addNewPredicate"in i&&i.addNewPredicate();break;case"param":i.option("parameterized",!i._isParameterized());break;case"inJoin":i.option("inJoin",!i._isInJoin());break;case"enable":i.option("disabled",!i._isDisabled());i._enableButton&&i._isMouseOverBlock&&i._enableButton.trigger("mouseover");break;case"delete":i.remove();break;case"menu":if(u=i._getConditionMenuOptions(),!u.menu)return;i._keepShowingButtons=!0;u.menu.PopupMenu("showMenu",{anchor:i._menuButton,selectedIds:u.selectedItems,itemSelectedCallback:function(n,t){var r=t.menuItem.data("id");n=n||{};n.fromMenu=!0;i._conditionMenuEventHandler(r,n)},menuClosedCallback:function(){i._keepShowingButtons=!1;i._isMouseOverBlock||i._leaveButtonBlock()}})}},_getConditionMenuOptions:function(){var n=this;return{menu:n.options.queryPanel.options.conditionMenu,selectedItems:[]}},_initButtons:function(){var t=this,r=t._getButtonsContainer(),i;r&&(t._buttonsBlock=n("<div><\/div>").addClass("eqjs-qp-condition-buttonsBlock").appendTo(r),t._buttonsToShow.indexOf("addCondition")>=0&&(i=n("<div><\/div>").addClass("eqjs-qp-button-placeholder").appendTo(t._buttonsBlock),t._addConditionButton=n("<div><\/div>").addClass("eqjs-qp-condition-button eqjs-qp-condition-button-addCondition").attr("title",EQ.core.getText("ButtonAddCondition")).appendTo(i).click(function(n){t._conditionMenuEventHandler("addCondition",n)})),t._buttonsToShow.indexOf("addPredicate")>=0&&(i=n("<div><\/div>").addClass("eqjs-qp-button-placeholder").appendTo(t._buttonsBlock),t._addPredicateButton=n("<div><\/div>").addClass("eqjs-qp-condition-button eqjs-qp-condition-button-addPredicate").attr("title",EQ.core.getText("ButtonAddPredicate")).appendTo(i).click(function(){t._conditionMenuEventHandler("addPredicate")})),t._buttonsToShow.indexOf("enable")>=0&&(i=n("<div><\/div>").addClass("eqjs-qp-button-placeholder").appendTo(t._buttonsBlock),t._enableButton=n("<div><\/div>").addClass("eqjs-qp-condition-button eqjs-qp-condition-button-enable").attr("title",EQ.core.getText("ButtonEnable")).appendTo(i).click(function(){t._conditionMenuEventHandler("enable")})),t._buttonsToShow.indexOf("delete")>=0&&(i=n("<div><\/div>").addClass("eqjs-qp-button-placeholder").appendTo(t._buttonsBlock),t._deleteButton=n("<div><\/div>").addClass("eqjs-qp-condition-button eqjs-qp-condition-button-delete").attr("title",EQ.core.getText("ButtonDelete")).appendTo(i).click(function(){t._conditionMenuEventHandler("delete")})),t._buttonsToShow.indexOf("menu")>=0&&(i=n("<div><\/div>").addClass("eqjs-qp-button-placeholder").appendTo(t._buttonsBlock),t._menuButton=n("<div><\/div>").addClass("eqjs-qp-condition-button eqjs-qp-condition-button-menu").attr("title",EQ.core.getText("ButtonMenu")).appendTo(i).click(function(){t._conditionMenuEventHandler("menu")})),t._enableButton&&(t._isDisabled()?t._enableButton.removeClass("enabled"):t._enableButton.addClass("enabled")),r.find("[class*=eqjs-qp-condition-button]").hover(function(){n(this).addClass("eqjs-qp-condition-button-active")},function(){n(this).removeClass("eqjs-qp-condition-button-active")}),r.bind("mouseenter",function(n){return t._isMouseOverBlock=!0,t._enterButtonBlock(),n.stopPropagation(),!1}).bind("mouseleave",function(n){return t._isMouseOverBlock=!1,!t._keepShowingButtons&&t._buttonsBlock.is(":visible")&&t._leaveButtonBlock(),n.stopPropagation(),!1}),t._hideButtons(),t._adjustButtonsVisibility())},_initCheckbox:function(){var t=this,i=t._getButtonsContainer();i&&t.options.queryPanel.options.showCheckboxes&&(t._checkBox=n("<div><\/div>").addClass("eqjs-qp-condelement eqjs-qp-condition-checkbox").attr("title",EQ.core.getText("ButtonEnable")).prependTo(i).click(function(){t.option("disabled",!t._isDisabled());t._adjustCheckbox();t._checkBox.trigger("mouseover")}),t._adjustCheckbox())},_isFirstConditionInGroup:function(){var t=this._parentPredicate?n.inArray(this._condition,this._parentPredicate.conditions):0;return t==0},_renderConjunction:function(){var t=this,r=t._getButtonsContainer(),u,i;r&&t.options.queryPanel.options.showConjunctions&&!t._isFirstConditionInGroup()&&(u=t._parentPredicate.linkType,i=EQ.core.getText("Conj"+u),i&&(t._conjuction=n("<span>"+i+"<\/span>").addClass("eqjs-qp-condelement eqjs-qp-condition-conjuction").prependTo(r)))},_adjustCheckbox:function(){var n=this;n._checkBox&&(n._condition.enabled===!1?n._checkBox.removeClass("enabled"):n._checkBox.addClass("enabled"))},_adjustButtonsVisibility:function(){},_enterButtonBlock:function(){this._showButtons()},_leaveButtonBlock:function(){},_showButtons:function(){},_hideButtons:function(){this._addConditionButton&&this._addConditionButton.parent().hide();this._addPredicateButton&&this._addPredicateButton.parent().hide();this._enableButton&&this._enableButton.parent().hide();this._deleteButton&&this._deleteButton.parent().hide();this._menuButton&&this._menuButton.parent().hide()},internalActivate:function(){this._active=!0;this.adjustActiveClass();this._hideButtons();this._adjustButtonsVisibility()},internalDeactivate:function(){this._active=!1;this.adjustActiveClass();this._hideButtons();this._adjustButtonsVisibility()},adjustActiveClass:function(){this._active&&this.options.queryPanel.options.accentActiveCondition?this.element.addClass("active"):this.element.removeClass("active")},isActive:function(){return this._active},getLevel:function(){return this._parentPredicateWidget?this._parentPredicateWidget.getLevel()+1:0},_renderLevelOffset:function(){for(var i=this.getLevel(),r,t=0;t<i-1;t++)r=n("<div><\/div>").addClass("eqjs-qp-level-offset").prependTo(this._getButtonsContainer())}})}(jQuery),function(n){n.widget("eqjs.ConditionRow_SMPL",n.eqjs.ConditionRow,{_postRender:function(){var i,u,r,f,e,t;if(this.options.queryPanel.options.spreadValueElement){if(i=this.element.find(".eqjs-qp-valueelement"),i.length==0)return;for(u=this.element.find(".eqjs-qp-condelement"),r=0,t=0;t<u.length;t++)n(u[t]).hasClass("eqjs-qp-valueelement")||(r=r+n(u[t]).outerWidth(!0));for(f=n(i[0]).outerWidth(!0)-n(i[0]).width(),r=r+this._buttonsBlock.width()+i.length*f,e=this.element.width()-r,t=0;t<i.length;t++)n(i[t]).css("max-width",(e/i.length>>0)+"px")}},_refreshByCondition:function(){var h=this.getModel(),t,e,u,o,l,a,f,r,p,s;if(this._condition&&h){t=this;t.options.disabled=!t._condition.enabled||t._condition.readOnly;this.element.addClass("eqjs-qp-row eqjs-qp-row-condition");this._condition.enabled===!1&&this.element.addClass("eqjs-qp-disabled");this._condition.readOnly&&this.element.addClass("eqjs-qp-readonly");this._condition.justAdded&&(this._updateValueExpressions(),this._condition.justAdded=!1);t._isInJoin()&&this.element.addClass("eqjs-qp-condition-injoin");t._isParameterized()&&this.element.addClass("eqjs-qp-condition-parameterized");var v=h.getOperatorById(t._condition.operatorID),c=EQ.core.parseOperatorFormat(v),i=null,y=c.length;for(e=0;e<y;e++)i=c[e],i.type==="operator"?(u=this._condition.enabled===!1||this._condition.readOnly?n("<span><\/span>",{text:i.text}):n("<a><\/a>",{href:"javascript:void(0)",text:i.text}),o=n("<div><\/div>"),o.addClass("eqjs-qp-condelement eqjs-qp-operelement"),u.appendTo(o),o.appendTo(this.element),this._condition.enabled===!1||this._condition.readOnly||(l=t._createOperatorsMenu(u),u.click(function(n){n.preventDefault();l.PopupMenu("showMenu",{anchor:u})}))):i.type==="expression"?i.index===0?(a=this._createAttrElement(this._condition.expressions[0],function(n,i){var r=n.operators[0],u=t._condition.operatorID;t._condition.operatorID=r;t._updateValueExpressions(u,i)}),a.appendTo(this.element)):(r=this._condition.expressions[i.index],r.dataType&&r.dataType!="Unknown"||t._updateExprDataType(r,i.index),r.kind==="Attribute"?(f=this._createAttrElement(r),f.appendTo(this.element)):(f=n("<div><\/div>"),f.appendTo(this.element),this._createValueEditor(f,r,i.index))):i.type==="text"&&(p=n("<span><\/span>").addClass("eqjs-qp-condelement").text(i.text).attr("title",i.text).appendTo(this.element));t.options.queryPanel.options.accentActiveCondition&&t.element.click(function(){t._active||t.makeActive()});t.adjustActiveClass();t._adjustCheckbox();this._renderConjunction();this._renderLevelOffset();s=this.getQueryPanel();s&&s.options.conditionRenderedCallback&&s.options.conditionRenderedCallback(this.element)}},_updateExprDataType:function(n,t){var i=this.getModel(),u=this._condition.expressions[0].id,r=i.getAttributeById(u);if(r){var f=this._condition.operatorID,e=i.getOperatorById(f),o=i.getOperand(r,e,t);n.dataType=o.dataType}},_createAttrElement:function(t,i){var u=this,h=this.getModel(),f=n("<div><\/div>"),e=t.id,o=e?this.getModel().getAttributeById(e):null,r,c=u.options.queryPanel.options.attrElementFormat,s;return this._condition.enabled===!1||this._condition.readOnly?r=n("<span>"+h.getAttributeText(o,c)+"<\/span>"):(s=o?h.getAttributeText(o,c):EQ.core.getText("MsgEmptyAttrValue"),r=n('<a href="javascript:void(0)">'+s+"<\/a>"),r.attr("title",s),r.click(function(n){n.preventDefault();u.options.queryPanel.showEntitiesMenu({anchor:r,selectedIds:null,itemSelectedCallback:function(n,r){var f=r.menuItem.data("id"),o=u.getModel().getAttributeById(f);return t.id=f,i&&i(o,e),u.refresh(),u._fireConditionChange({type:"change",what:"attribute"}),!1},itemFilterCallback:function(n){return EQ.core.areCompatibleDataTypes(t.dataType,n.dataType)}})})),f.addClass("eqjs-qp-condelement eqjs-qp-attrelement"),r.appendTo(f),f},_getOperatorCaption:function(n){var t=EQ.core.getText("Operators",n.id,"caption");return t||(t=n.caption),t},_operatorChanged:function(n){var t=this;t._updateValueExpressions(n);t.refresh();t._fireConditionChange({type:"change",what:"operator"})},_areCompatibleTypes:function(n,t){return typeof n.dataType=="undefined"?!0:n.dataType==t.dataType&&n.kind==t.kind},_areCompatibleEditors:function(n,t){return!n||!t?n==t?!0:!1:n==t?!0:n.type==t.type&&(n.type=="EDIT"||n.type=="DATETIME"||n.type=="CUSTOMLIST"&&n.name==t.name||n.id==t.id)?!0:!1},_updateValueExpressions:function(t,i){var r=this,e=this.getModel(),d=r._condition.expressions[0].id,o=e.getAttributeById(d),p,s,h,f,a,v,u,w,c,l,y,b,k;if(o&&(p=r._condition.operatorID,s=e.getOperatorById(p),s)){for(h=r._condition.expressions.length,t&&(a=e.getOperatorById(t)),u=1;u<s.paramCount;)f=e.getOperand(o,s,u),a&&(v=e.getOperand(o,a,u)),f.dataType&&f.dataType!="Unknown"||(f.dataType=o.dataType),u>=h?(w=r._createValueExpression(f),r._condition.expressions.push(w)):(c=n.extend({},r._condition.expressions[u]),l=r._createValueExpression(f),v&&(y=r._createValueExpression(v).value),r._condition.expressions[u]=l,b=r._getExprEditor(c,u,t,i),k=r._getExprEditor(l,u),(!y||y!=c.value)&&r._areCompatibleEditors(b,k)&&r._tryToAssignExprValue(l,c)),u++;h>u&&r._condition.expressions.splice(u,h-u)}},_tryToAssignExprValue:function(n,t){t.value&&t.value!=""&&this._areCompatibleTypes(t,n)&&(n.value=t.value)},_createValueExpression:function(n){var f=this,t,i,r,u;return n.kind==="Query"?t={typeName:"QUERY",dataType:n.dataType,kind:n.kind,value:EQ.core.getEmptyQueryObject(),text:""}:n.kind==="Attribute"?(i=f.getModel().getFirstAttributeByFilter(function(t){return t.uic==!0&&(!n.dataType||t.dataType==n.dataType)}),r=i?i.id:null,t={typeName:"ENTATTR",dataType:n.dataType,kind:n.kind,id:r,value:r,text:""}):(u=n.defValue&&n.defValue!=""?n.defValue:n.editor&&n.editor.defValue?n.editor.defValue:"",t={typeName:"CONST",dataType:n.dataType,kind:n.kind,value:u,text:""}),t},_createOperatorsMenu:function(t){var i=this,o,u,r,c,f,l,s,e,h;if(i._condition&&i.getModel()){if(o=[],u=i.getModel().getAttributeById(i._condition.expressions[0].id),u)for(r=null,c=u.operators.length,f=0;f<c;f++)r=i.getModel().findOperatorById(u.operators[f]),!r||i.options.queryPanel.options.isSubQuery&&r.kind==="Query"||(l=i._getOperatorCaption(r),o.push({id:r.id,text:l}));return s=n("<div><\/div>").appendTo(t.parent()).hide(),e=i.element.attr("id"),e&&(e+="-OperatorsMenu"),h={items:o,id:e,domWriteItemsId:i.options.queryPanel.options.domWriteItemsId,onMenuItemSelected:function(n,r){t.text(r.menuItem.text);var u=i._condition.operatorID;return i._condition.operatorID=r.menuItem.id,i._operatorChanged(u,i._condition.operatorID),!1}},n.extend(h,i.options.queryPanel.options.menuOptions),s.PopupMenu(h),s}},_getExprEditor:function(t,i,r,u){var s=this.getModel(),c=u||this._condition.expressions[0].id,o=s.getAttributeById(c),h,e,f;return r=r||this._condition.operatorID,h=s.getOperatorById(r),e=s.getOperand(o,h,i),e&&e.editor&&e.editor.type!=="Unknown"?f=n.extend({},e.editor):o&&o.defaultEditor&&(f=n.extend({},o.defaultEditor)),t&&t.kind==="Query"&&(f.type="SUBQUERY"),f.type&&f.type!="Unknown"||(f.type="EDIT"),f},_createValueEditor:function(n,t,i){var r=this,u=r._getExprEditor(t,i);if(u){var f="element.ValueEditor_"+u.type+"({parentWidget:self, editor: editorObj, onChange:exprChangedCallback}); element.ValueEditor_"+u.type+"('init', expr);",e=new Function("self, element, expr, editorObj, exprChangedCallback",f),o=function(){var u=r.getModel(),f=u.getOperatorById(r._condition.operatorID),n,i;f.isRange&&(n=r._condition.expressions[1],i=r._condition.expressions[2],r._compareExpressions(n,i)>0&&(n==t?r._copyExpr(n,i):r._copyExpr(i,n),r.refresh()));r._fireConditionChange({type:"change",what:"value"})};e(this,n,t,u,o)}},_compareExpressions:function(n,t){var r,u,i=n.dataType,f=this.getModel();return i==="Date"||i==="DateTime"?(r=f.getDateOrMacroDateValue(n.value),u=f.getDateOrMacroDateValue(t.value),r>=u?1:-1):i==="Time"?(r=f.getTimeOrMacroTimeValue(n.value),u=f.getTimeOrMacroTimeValue(t.value),r>=u?1:-1):i==="Int"||i==="Int32"||i==="Int64"||i==="Byte"||i==="Word"?(r=n.value!==""?parseInt(n.value):0,u=t.value!==""?parseInt(t.value):0,r-u):i==="Float"||i==="Currency"?(r=n.value!==""?parseFloat(n.value):0,u=t.value!==""?parseFloat(t.value):0,r-u):0},_copyExpr:function(n,t){t.value=n.value;t.text=n.text},_showButtons:function(){var n=this.options.queryPanel;!n.options.showCheckboxes&&this._enableButton&&this._enableButton.parent().show();this._deleteButton&&this._deleteButton.parent().show();this._menuButton&&this._menuButton.parent().show()},_adjustButtonsVisibility:function(){(this.options.queryPanel.options.alwaysShowButtonsInConditions||this.options.queryPanel.options.accentActiveCondition&&this._active)&&this._showButtons()},_leaveButtonBlock:function(){this.options.queryPanel.options.alwaysShowButtonsInConditions==!0||this._active&&this.options.queryPanel.options.accentActiveCondition==!0||this._hideButtons()},_getConditionMenuOptions:function(){var n=this,t=[];return n._isDisabled()||t.push("enable"),n._isParameterized()&&t.push("param"),n._isInJoin()&&t.push("inJoin"),{menu:n.options.queryPanel.options.conditionMenu,selectedItems:t}}})}(jQuery),function(n){n.widget("eqjs.ConditionRow_PDCT",n.eqjs.ConditionRow,{_predicateRowBlock:null,_getButtonsContainer:function(){return this._predicateRowBlock},_parsePredicateText:function(t,i){var r=this,o=function(){r.refresh();r._fireConditionChange({type:"change",what:"link"})},e=EQ.core.getText(i),u=e.indexOf("{lt}"),s,f,h;u<0?(t.text(EQ.core.getText("ErrIncorrectPredicateTitleFormat")),t.addClass("eqjs-qp-error")):(u>0&&(s=n("<span><\/span>").addClass("eqjs-qp-predelement").text(e.substring(0,u)).appendTo(t)),f=n("<div><\/div>"),f.PredicateLinkType({queryPanel:r.options.queryPanel,parentWidget:r,onChange:o}),f.PredicateLinkType("init",r._condition),f.appendTo(t),h=n("<span><\/span>").addClass("eqjs-qp-predelement").text(e.substring(u+4)).appendTo(t))},_refreshPredicateRow:function(){var n=this;n._predicateRowBlock&&(n._predicateRowBlock.html(""),n._predicateRowBlock.addClass("eqjs-qp-row eqjs-qp-row-predicate"),n._condition.enabled===!1&&n._predicateRowBlock.addClass("eqjs-qp-disabled"),n._parsePredicateText(n._predicateRowBlock,"PredicateTitle"),n.options.queryPanel.options.accentActiveCondition&&n._predicateRowBlock.click(function(){n._active||n.makeActive()}),n.adjustActiveClass(),this._renderConjunction(),this._renderLevelOffset())},_refreshByCondition:function(){var t=this,i;t.element.addClass("eqjs-qp-predicate");t._predicateRowBlock=n("<div><\/div>");t._predicateRowBlock.appendTo(t.element);t._refreshPredicateRow();t._addConditions(t.element);i=this.getQueryPanel();i&&i.options.predicateRenderedCallback&&i.options.predicateRenderedCallback(this._predicateRowBlock)},_addConditions:function(t){var i=n("<div><\/div>"),e,u,r,f,o,s;for(i.addClass("eqjs-qp-conditions"),i.appendTo(t),e=this._condition.conditions.length,u=0;u<e;u++)r=this._condition.conditions[u],f=n("<div><\/div>"),r.blockId||this.trySetBlockId(r),r.blockId&&f.attr("id",r.blockId),f.appendTo(i),o="element.ConditionRow_"+r.typeName+"({queryPanel: self.options.queryPanel, model: self.getModel()}); element.ConditionRow_"+r.typeName+"('init', self._condition.conditions[idx], self._condition, self);",s=new Function("self, element, idx",o),s(this,f,u);return i.children().length?i.show():i.hide(),i},_checkAllDisabled:function(){var t,i,n;if(this._parentPredicate){for(t=!0,i=this._condition.conditions.length,n=0;n<i;n++)if(this._condition.conditions[n].enabled){t=!1;break}t&&this._setConditionEnable(!1,!0)}},_moveDraggedItem:function(){},isPredicate:function(){return!0},_containsActiveCondition:function(n){var i=this,r=n||i._condition,t=i.options.queryPanel._activeConditionWidget;return t&&(t=t.getCondition()),i.options.queryPanel.predicateContainsCondition(r,t)},removeCondition:function(t){var i=this,r=n.inArray(t,i._condition.conditions);r>=0&&(i._condition.conditions.length==1&&i._parentPredicate?i.remove():(t==i.options.queryPanel.options.activeCondition&&i.makeActive(),i._condition.conditions.splice(r,1),i.refresh(),i._fireConditionChange({type:"delete",condition:t})))},addCondition:function(t,i){var r,u;t&&(!n.isArray(t)||t.length!=0)&&(r=this,typeof i=="number"?r._condition.conditions.push.apply(r._condition.conditions,[i,0].concat(t)):r._condition.conditions.push.apply(r._condition.conditions,[].concat(t)),u=[].concat(t),n.each(u,function(n,t){r.trySetBlockId(t)}),t.initAsActive=!0,r.refresh(),r._fireConditionChange({type:"add",condition:t}))},trySetBlockId:function(n){var t=this.getQueryPanel(),i=n.typeName=="PDCT"?t.getNewPredId():t.getNewCondId();i&&(n.blockId=i)},addNewCondition:function(t,i,r){var y=this,u,f,h,o,c=this.getQuery(),e=c.getModel(),l=function(n){var t;return n&&!n.uic&&(n.lookupAttr?(t=n.lookupAttr,n=e.getAttributeById(t),n&&n.uic||(n=null)):n=null),n},a=function(n,t){return{justAdded:!0,typeName:"SMPL",enabled:!0,operatorID:t,expressions:[{kind:"Attribute",typeName:c.attrClassName,id:n.id}]}},v,s;if(n.isArray(t))for(f=[],v=t.length,s=0;s<v;s++)(u=e.getAttributeById(t[s]),u=l(u),u)&&(o=i?i:e.getDefaultOperatorIdForAttr(u),h=a(u,o),h&&f.push(h));else{if(u=e.getAttributeById(t),u=l(u),!u)return;o=i?i:e.getDefaultOperatorIdForAttr(u);f=a(u,o)}return y.addCondition(f,r),f},addNewPredicate:function(){var t=this,n=t.getModel().getFirstUICAttr(),r=n?n.id:-1,u=n?n.operators[0]:-1,f=this.getQuery(),e={blockId:t.getQueryPanel().getNewCondId(),justAdded:!0,typeName:"SMPL",enabled:!0,operatorID:u,expressions:[{typeName:f.attrClassName,id:r,kind:"Attribute"}]},o=t._condition.linkType==="All"?"Any":"All",i={typeName:"PDCT",linkType:o,conditions:[]};i.conditions.push(e);this.addCondition(i)},_showButtons:function(){this._condition.enabled!=!1&&(this._addConditionButton&&this._addConditionButton.parent().show(),this._addPredicateButton&&this._addPredicateButton.parent().show());!this.options.queryPanel.options.showCheckboxes&&this._enableButton&&this._enableButton.parent().show();this._deleteButton&&this._deleteButton.parent().show();this._menuButton&&this._menuButton.parent().show()},_adjustButtonsVisibility:function(){(this.options.queryPanel.options.alwaysShowButtonsInPredicates||this.options.queryPanel.options.accentActiveCondition&&this._active)&&this._showButtons()},_leaveButtonBlock:function(){this.options.queryPanel.options.alwaysShowButtonsInPredicates==!0||this._active&&this.options.queryPanel.options.accentActiveCondition==!0||this._hideButtons()},internalActivate:function(){this._active=!0;this.adjustActiveClass();this._hideButtons();this._adjustButtonsVisibility()},internalDeactivate:function(){this._active=!1;this.adjustActiveClass();this._hideButtons();this._adjustButtonsVisibility()},adjustActiveClass:function(){this._active&&this.options.queryPanel.options.accentActiveCondition?this._predicateRowBlock.addClass("active"):this._predicateRowBlock.removeClass("active")},_getConditionMenuOptions:function(){var n=this,t=[];return n._isDisabled()||t.push("enable"),{menu:n.options.queryPanel.options.predicateMenu,selectedItems:t}}})}(jQuery),function(n){n.widget("eqjs.RootPredicate",n.eqjs.ConditionRow_PDCT,{_showButtons:function(){this._addConditionButton&&this._addConditionButton.parent().show();this._addPredicateButton&&this._addPredicateButton.parent().show();this._menuButton&&this._menuButton.parent().show()},_initCheckbox:function(){},_renderConjunction:function(){},_refreshPredicateRow:function(){var n=this;n._predicateRowBlock&&(n._predicateRowBlock.html(""),n._predicateRowBlock.addClass("eqjs-qp-row eqjs-qp-row-predicate eqjs-qp-row-predicate-root"),n._parsePredicateText(n._predicateRowBlock,"RootPredicateTitle"),n.options.queryPanel.options.accentActiveCondition&&n._predicateRowBlock.click(function(){n._active||n.makeActive()}),n.adjustActiveClass())},_refreshByCondition:function(){var t=this,i,r,u,f;t.element.addClass("eqjs-qp-predicate eqjs-qp-predicate-root");i=0;t.options.queryPanel&&t.options.queryPanel.options.showRootRow&&(t._predicateRowBlock=n("<div><\/div>"),t._predicateRowBlock.appendTo(t.element),t._refreshPredicateRow(),i+=t._predicateRowBlock.outerHeight());r=t._addConditions(t.element);t.options.queryPanel.options.showAddRow&&(u=t.options.queryPanel.addRowHeight,i+=u+9);f=t.options.queryPanel.element.innerHeight();r&&r.css({"max-height":f-i+"px"})},_getConditionMenuOptions:function(){var n=this;return{menu:n.options.queryPanel.options.rootPredicateMenu,selectedItems:[]}}})}(jQuery),function(n){n.widget("eqjs.QueryPanel",{_activeConditionWidget:null,_rootPredicateWidget:null,_query:null,_globalCondCounter:0,_globalPredCounter:0,_defaultMenuOptions:{showSearchBoxAfter:30,searchBoxAutoFocus:!0,activateOnMouseOver:!0},options:{isSubQuery:!1,activeCondition:null,listRequestHandler:null,entitiesPopupHandler:null,entitiesListFilter:null,menuContainer:document.body,showRootRow:!0,showAddRow:!0,showCheckboxes:!1,allowParameterization:!1,allowInJoinConditions:!1,showPoweredBy:!0,buttons:{condition:null,predicate:null},alwaysShowButtonsInPredicates:!1,alwaysShowButtonsInConditions:!1,showConjunctions:!0,accentActiveCondition:!0,activateRootOnStart:!0,dateFormatValue:"",dateFormatDisplay:"d MM, yy",yearRange:"c-10:c+10",attrElementFormat:"{entity} {attr}",menuOptions:{showSearchBoxAfter:30,searchBoxAutoFocus:!0,activateOnMouseOver:!0,itemRenderedCallback:null},allowDragDrop:!0,attrPlacement:0,sortEntities:!1,subQueryDialogWidth:600,subQueryDialogHeight:300,dialogZIndex:1e5,numberDecimalSeparatorDisplay:".",numberListSeparators:[",",";"],autoEditNewCondition:!1,conditionRenderedCallback:null,predicateRenderedCallback:null,defaultQuery:{root:{linkType:"All",enabled:!0,conditions:[]},columns:[],justsorted:[]}},addRowHeight:0,getSelf:function(){return this},getQuery:function(){return this._query},setQuery:function(n){if(n&&n.getObject)this._setQueryObserver(!0),this._query=n,this._setQueryObserver(),this.refresh();else if(n){var t=this.getQuery();t.setObject(n)}else this._setQueryObserver(!0),this._query=null},isQueryNullOrEmpty:function(){var n=this.getQuery();return!n||n.isEmptyConditions()},getModel:function(){var n=this.getQuery();return n?n.getModel():null},isModelNullOrEmpty:function(){var n=this.getModel();return!n||n.isEmpty()},_updateLists:function(){var n=EQ.core.constLists;for(var t in n)n.hasOwnProperty(t)&&this._updateList(n[t]);this._updateList(EQ.core.predicateLinkTypeList)},_updateList:function(n){var i,t;if(n)for(i=n.length,t=0;t<i;t++)n[t].text=EQ.core.getText(n[t].key),n[t].text||(n[t].text=n[t].key)},_create:function(){var n=this;typeof poweredByOption=="undefined"&&(poweredByOption={})},_render:function(){var t=this,e=this.getModel(),h=this.options.showPoweredBy,u,i,f,o,r,s;t._clear();t._updateLists();t.element.addClass("eqjs-qp-panel");t.isModelNullOrEmpty()||(t.options.entitiesList=t.getEntitiesList({addUIC:!0,addUIR:!1,addUIS:!1,attrPlacement:t.options.attrPlacement,sortEntities:t.options.sortEntities}),t.options.entitiesMenu=t._createEntitiesMenu(),t.options.rootPredicateMenu=t._createPredicateMenu(!0),t.options.predicateMenu=t._createPredicateMenu(),t.options.conditionMenu=t._createConditionMenu(),u=n("<div><\/div>"),t.element.attr("id")&&u.attr("id",t.element.attr("id")+"-pred-root"),u.appendTo(t.element),t.options.showAddRow&&(i=n('<div class="eqjs-addrow eqjs-qp-addrow"><\/div>'),i.appendTo(t.element),t.options.showRootRow||t.isQueryNullOrEmpty()||i.addClass("eqjs-addrow-empty"),f=n('<a href="javascript:void(0)">'+EQ.core.getText("CmdClickToAddCondition")+"<\/a>"),f.appendTo(i),f.click(function(n){n.preventDefault();t.showEntitiesMenu({anchor:f,selectedIds:null,itemSelectedCallback:function(n,i){var r=i.menuItem.data("id");return t.addNewCondition(r),!1}})}),t.addRowHeight=i.outerHeight()),t._refreshByQuery(u));o=h;t.options.allowDragDrop&&t.element.droppable({hoverClass:"eqjs-drophover",scope:"entityAttr",drop:function(n,i){t.addNewCondition(i.draggable.data("id"))},over:function(n,t){t.helper.addClass("eqjs-qc-column-drag");var i=t.draggable.data("id");e.checkAttrProperty(i,"uic")||t.helper.addClass("eqjs-qc-column-drag-forbidden")},out:function(n,t){t.helper.removeClass("eqjs-qc-column-drag");t.helper.removeClass("eqjs-qc-column-drag-forbidden")}});(o||!e.rgdlce())&&(r=n("<a><\/a>",{text:"Powered by EasyQuery",href:"https://korzh.com/easyquery",target:"_blank",css:{color:"#4676AE",font:"11px Calibri","text-decoration":"underline"}}).appendTo(t.element),s=function(){r.css({position:"absolute",bottom:"-15px",right:"0px"});r.parents("div[class*=ui-dialog]").length!=0&&r.parents("div[class*=ui-dialog]").find(r).hide()},s())},_checkActivateRootPredicate:function(){this.options.activateRootOnStart&&this._activateRootPredicate()},_activateRootPredicate:function(){this.options.showRootRow&&this._rootPredicateWidget&&this.setActiveConditionWidget(this._rootPredicateWidget)},_setOption:function(t,i){return arguments.length==2?(t=="model"?(this.clearQuery(!1),this.options[t]=i,this._render(),this._checkActivateRootPredicate()):t=="query"?this.setQuery(i):t=="menuOptions"?this.options.menuOptions=n.extend({},this._defaultMenuOptions,i):t=="searchBoxAfter"?(this.options[t]=i,this.options.menuOptions.showSearchBoxAfter=i):(this.options[t]=i,this._render()),this):this.options[t]},_setQueryObserver:function(n){var t=this,i=this.getQuery(),r=function(n){n&&(n.source!==t&&n.changeType&&n.changeType.indexOf("column")<0&&t.refresh(),t.options.autoEditNewCondition&&(n.changeType=="condition.add"||n.changeType=="condition.change"&&(n.what=="attribute"||n.what=="operator"))&&t.editConditionValue(n.condition))};i&&(n?i.removeChangedCallback(r):i.addChangedCallback(r))},_clear:function(){this.setActiveConditionWidget(null);this.element.html("")},_refreshByQuery:function(n){return n.RootPredicate({queryPanel:this,model:this.getModel()}),n.RootPredicate("init",this.getQuery().getRootPredicate(),null,null),this._rootPredicateWidget=n.data("RootPredicate"),this._rootPredicateWidget||(this._rootPredicateWidget=n.data("eqjs-RootPredicate")),n},clearConditions:function(n){var t=this.getQuery();t.clearConditions();n!==!1&&this.refresh()},clearQuery:function(n){var t=this.getQuery();t.clear();n!==!1&&this.refresh()},_fireQueryChange:function(n){var t=this,i=this.getQuery();i.fireChangedEvent({source:t,changeType:"query."+n},!0)},_fireEntitiesPopup:function(n){var t=this;return this.options.entitiesPopupHandler?this.options.entitiesPopupHandler({query:t.getQuery(),items:n.items}):!1},showEntitiesMenu:function(n){var t=this,i=t.options.entitiesMenu.PopupMenu("option","items"),r=t._fireEntitiesPopup({items:i});r&&t.options.entitiesMenu.PopupMenu("refreshItems",i);t.options.entitiesMenu.PopupMenu("showMenu",n)},getEntitiesList:function(n){var i=this.getModel(),t=i.getEntitiesTree(n);return this.options.entitiesListFilter&&this.options.entitiesListFilter(t,n),t},editConditionValue:function(t){var f,i,r,u,e;if((t||this.isQueryNullOrEmpty()||(t=this.getQuery().getRootPredicate().conditions[0]),t)&&(f=this.element.find("[class*=eqjs-qp-row-condition]").filter(function(){return this.condition==t}),i=f.find("[class*=eqjs-qp-valueelement]").first(),i.length!=0)){r=n(i).data();for(u in r)u.indexOf("ValueEditor_")>=0&&(e=r[u],e.showEditor())}},_createMenu:function(t,i,r){if(this.isModelNullOrEmpty())return null;var u=this,e=n("<div><\/div>").hide().appendTo(u.element),f={items:i,id:t,domWriteItemsId:u.options.domWriteItemsId};return n.extend(f,u.options.menuOptions),n.extend(f,r),u.options.isSubQuery&&(f.zIndex=u.options.dialogZIndex+1e3,f.isSubQuery=!0),e.PopupMenu(f),e},_createEntitiesMenu:function(){var n=this.element.attr("id")||"eq-querypanel";return n+="-EntitiesMenu",this._createMenu(n,this.options.entitiesList)},_createPredicateMenu:function(n){var i=this.element.attr("id")||"eq-querypanel",t;return n&&(i+="-Root"),i+="-PredicateMenu",t=[{id:"addCondition",text:EQ.core.getText("ButtonAddCondition")},{id:"addPredicate",text:EQ.core.getText("ButtonAddPredicate")}],n||(t.push({id:"enable",text:EQ.core.getText("MenuEnable")}),t.push({id:"delete",text:EQ.core.getText("ButtonDelete")})),this._createMenu(i,t,{showSearchBoxAfter:100})},_createConditionMenu:function(){var t=this.element.attr("id")||"eq-querypanel",n;return t+="-ConditionMenu",n=[{id:"enable",text:EQ.core.getText("MenuEnable")},{id:"delete",text:EQ.core.getText("ButtonDelete")}],(this.options.allowParameterization||this.options.allowInJoinConditions)&&n.push({id:"delimiter",text:"---"}),this.options.allowParameterization&&n.push({id:"param",text:EQ.core.getText("MenuParameterization")}),this.options.allowInJoinConditions&&n.push({id:"inJoin",text:EQ.core.getText("MenuJoinCond")}),this._createMenu(t,n,{showSearchBoxAfter:100})},addNewCondition:function(n,t){var i=this;return i._rootPredicateWidget?i._rootPredicateWidget.addNewCondition(n,t):null},addNewConditionIntoActivePredicate:function(n,t){var r=this,i;return this._activeConditionWidget?(i=this._activeConditionWidget.isPredicate()?this._activeConditionWidget:this._activeConditionWidget._parentPredicateWidget,i.addNewCondition(n,t)):this.addNewCondition(n,t)},refresh:function(){this._render();this._checkActivateRootPredicate()},resize:function(){this.refresh()},setActiveConditionWidget:function(n){this._activeConditionWidget&&(this._activeConditionWidget.internalDeactivate(),this.options.activeCondition=null);this._activeConditionWidget=n;this._activeConditionWidget&&(this._activeConditionWidget.internalActivate(),this.options.activeCondition=this._activeConditionWidget.getCondition())},predicateContainsCondition:function(n,t){var u=this,r,i;if(!n||!t)return!1;if(n.conditions)for(r=n.conditions.length,i=0;i<r;i++)if(n.conditions[i]==t||u.predicateContainsCondition(n.conditions[i],t))return!0;return!1},getNewPredId:function(){if(this.element.attr("id"))return this.element.attr("id")+"-pred-"+ ++this._globalPredCounter},getNewCondId:function(){if(this.element.attr("id"))return this.element.attr("id")+"-cond-"+ ++this._globalCondCounter}})}(jQuery),function(n,t){n.widget("eqjs.ValueEditor",{_expr:{value:"",text:""},_linkElement:null,options:{model:null,parentWidget:null,editor:null,onChange:null,emptyText:null},getModel:function(){return this.options.parentWidget?this.options.parentWidget.getModel():null},getQuery:function(){return this.options.parentWidget?this.options.parentWidget.getQuery():null},getCondition:function(){return this.options.parentWidget&&this.options.parentWidget.getCondition?this.options.parentWidget.getCondition():null},getQueryPanel:function(){return this.options.parentWidget&&this.options.parentWidget.getQueryPanel?this.options.parentWidget.getQueryPanel():null},init:function(n){this._expr=n;this._adjustValueExpr();this._adjustExprText();this.refresh()},getResText:function(){return EQ.core.getText?EQ.core.getText.apply(this.getQueryPanel(),arguments):t},_getEmptyText:function(){return this.options.emptyText||this.getResText("MsgEmptyScalarValue")},_render:function(){var n,t;this.clear();this.getModel()&&this._expr&&(this._renderCommonPart(),this._renderEditor(),n=this.getQueryPanel(),n&&n.options&&n.options.spreadValueElement&&(this._linkElement.css("width","100%"),this._linkElement.css("max-width","100%")),t=this._getDisplayText(),this._linkElement.text(t),this._linkElement.attr("title",t))},_getClassesToAdd:function(){return"eqjs-qp-condelement eqjs-qp-valueelement"},_renderCommonPart:function(){var t=this,i;t.element.addClass(t._getClassesToAdd());i=this.getCondition();i&&(i.enabled===!1||i.readOnly)?t._linkElement=n("<span><\/span>",{text:"-"}).appendTo(t.element):(t._linkElement=n("<a><\/a>",{href:"javascript:void(0)",text:"-"}).appendTo(t.element),t._linkElement.click(function(){return t.showEditor(),!1}))},showEditor:function(){this._beforeShowEditor()&&(this._showEditor(),this.options.parentWidget&&this.options.parentWidget.makeActive())},_renderEditor:function(){},refresh:function(){this._render()},_beforeShowEditor:function(){return!0},_showEditor:function(){},_setOption:function(n,t){return arguments.length==2?(this.options[n]=t,this._render(),this):this.options[n]},clear:function(){this._linkElement&&this._linkElement.unbind();this.element.removeClass();this.element.empty()},_setValueSilent:function(n){var u=this._getValue(),t=this._adjustNewValue(n),i=t!=u?this._validate(t):{result:!0},r;return i&&i.result?(this._expr.value=t,this._expr.text=n,this._adjustExprText(),r=this._getDisplayText(),this._linkElement.text(r),this._linkElement.html(this._linkElement.html().replace(/ /g,"&nbsp")),this._linkElement.attr("title",r),!0):(this._validationError(i),!1)},_setValue:function(n){var t=this._setValueSilent(n);if(t&&this.options.onChange)this.options.onChange(this._expr.value);return t},_validate:function(){return{result:!0,message:""}},_validationError:function(n){EQ.core.throwError({type:"validation",message:n.message})},_getValue:function(){return this._expr.value},_getText:function(){return this._expr.text},_isEmptyValue:function(){var n=this._getValue();return typeof n=="undefined"||n===null||!n},_adjustValueExpr:function(){this._expr.value&&(this._expr.value=this._adjustNewValue(this._expr.value));this._expr.typeName=="ENTATTR"&&(this._expr.kind="Attribute",this._expr.value=this._expr.id)},_adjustExprText:function(){var n=this._expr.value;this._expr.text=n&&!EQ.core.isObject(n)&&n!=""?n:""},_adjustNewValue:function(n){return n},_getDisplayText:function(){return this._adjustExprText(),this._expr.text&&this._expr.text!=""?this._expr.text:this._expr.value&&this._expr.value!=""?this._expr.value:this._getEmptyText()}})}(jQuery),function(n){n.widget("eqjs.ValueEditor_EDIT",n.eqjs.ValueEditor,{_numberDecimalSeparatorValue:".",_numberListSeparatorValue:",",_numberDecimalSeparatorDisplay:".",_numberListSeparators:[",",";"],_editBox:null,_editBoxClass:"eqjs-qp-ve-editbox",_create:function(){var n=this.getQueryPanel();n&&(n.options.numberDecimalSeparatorDisplay&&(this._numberDecimalSeparatorDisplay=n.options.numberDecimalSeparatorDisplay),n.options.numberListSeparators&&(this._numberListSeparators=n.options.numberListSeparators))},_adjustNewValue:function(n){var t;if(n.length>0&&this._expr.kind=="List"){var r=new RegExp("\\s*["+this._numberListSeparators.join("")+"]\\s*","i"),i=n.split(r),u=i.length;for(t=0;t<u;t++)i[t]=this._adjustScalarValue(i[t]);return i.join(this._numberListSeparatorValue)}return this._adjustScalarValue(n)},_adjustScalarValue:function(n){return n.split(this._numberDecimalSeparatorDisplay).join(this._numberDecimalSeparatorValue)},_renderEditor:function(){var t=this;t.dontProcessBlur=!1;t._editBox=n("<input />",{type:"text","class":t._editBoxClass,blur:function(n){if(t._editBox.is(":visible")&&!t.dontProcessBlur)return t._setValue(t._editBox.val())?(t._editBox.hide(),t._linkElement.show()):(t.dontProcessBlur=!0,t._editBox.focus(),setTimeout(function(){t.dontProcessBlur=!1},200)),n.stopPropagation(),!1},keydown:function(n){return n.keyCode==13&&t._editBox.is(":visible")?(t.dontProcessBlur=!0,t._setValue(t._editBox.val())?(t._editBox.hide(),t._linkElement.show(),t.dontProcessBlur=!1):(t._editBox.focus(),setTimeout(function(){t.dontProcessBlur=!1},200)),n.stopPropagation(),!1):n.keyCode==27?(t._editBox.hide(),t._linkElement.show(),n.stopPropagation(),!1):void 0}}).appendTo(this.element).hide()},_checkScalarValue:function(t){var i=+t;return isNaN(i)||EQ.core.isNumericType(this._expr.dataType)&&n.trim(t)!=t?{result:!1,message:'"'+t+'"'+this.getResText("ErrNotNumber")}:EQ.core.isIntType(this._expr.dataType)&&i!=parseInt(t,10)?{result:!1,message:t+" - "+this.getResText("ErrIncorrectInteger")}:{result:!0,message:""}},_validate:function(n){var i,r,u,t;if(EQ.core.isNumericType(this._expr.dataType)){if(n.length>0&&this._expr.kind=="List"){for(r=n.split(/\s*,\s*/),u=r.length,t=0;t<u;t++)if(i=this._checkScalarValue(r[t]),!i||!i.result)return{result:!1,message:this.getResText("ErrIncorrectNumberList")};return{result:!0}}return this._checkScalarValue(n)}return{result:!0}},_getZIndex:function(){var n=this.getQueryPanel();return n&&n.options.isSubQuery?n.options.dialogZIndex+1e3:1e5},_showEditor:function(){var n=this,t=n.element.width();n._linkElement.hide();n._editBox.val(n._getText()).css("min-width",t).show().focus()}})}(jQuery),function(n){n.widget("eqjs.ValueEditor_DATETIME",n.eqjs.ValueEditor_EDIT,{_dateFormatInternal:"yy-mm-dd",_dateFormatValue:"mm/dd/yy",_dateFormatDisplay:"d mm, yy",_dateValue:"",_timeFormatInternal:"HH:mm",_timeFormatValue:"HH:mm",_timeFormatDisplay:"HH:mm",_yearRange:"c-10:c+10",_create:function(){var i=this.getQueryPanel(),t=i?i.options:{};this._dateFormatValue=this.options.dateFormatValue||t.dateFormatValue||this._dateFormatValue;this._dateFormatDisplay=this.options.dateFormatDisplay||t.dateFormatDisplay||this._dateFormatDisplay;this._timeFormatValue=this.options.timeFormatValue||t.timeFormatValue||this._timeFormatValue;this._timeFormatDisplay=this.options.timeFormatDisplay||t.timeFormatDisplay||this._timeFormatDisplay;this._yearRange=this.options.yearRange||t.yearRange||this._yearRange;n.datepicker.setDefaults(n.datepicker.regional[EQ.client.locale]);n.timepicker.setDefaults(n.timepicker.regional[EQ.client.locale])},_renderEditor:function(){var t=this,i;t._editBox=n("<input />",{type:"text","class":"eqjs-qp-ve-editbox"}).appendTo(t.element).hide();t._editBox.on("keydown",function(n){n.keyCode==27&&t._editBox.val(t.lastValue)});t._expr.dataType=="Time"?(t._editBox.timepicker({onClose:function(i){if(i!=""){var u=t.getModel(),r=t._convertTime(n(this).datepicker("getDate"),t._timeFormatInternal);i!=t.lastValue&&t._setValue(r);t._editBox.hide()}else t._editBox.hide(),t._editBox.timepicker("hide")}}),t._timeFormatValue?t._editBox.timepicker("option","timeFormat",t._timeFormatValue):t._timeFormatValue=t._editBox.datepicker("option","timeFormat")):t._expr.dataType=="Date"?(i=this.getModel(),t._editBox.datepicker({changeMonth:!0,changeYear:!0,beforeShow:function(){t._editBox.show()},onClose:function(i){if(i!=""){var u=t.getModel(),r=t._convertDate(n(this).datepicker("getDate"),t._dateFormatInternal);i!=t.lastValue&&t._setValue(r);t._editBox.hide()}else t._editBox.hide(),t._editBox.datepicker("hide")}}),t._dateFormatValue?t._editBox.datepicker("option","dateFormat",t._dateFormatValue):t._dateFormatValue=t._editBox.datepicker("option","dateFormat"),t._yearRange?t._editBox.datepicker("option","yearRange",t._yearRange):t._yearRange=t._editBox.datepicker("option","yearRange")):t._expr.dataType=="DateTime"&&(t._editBox.datetimepicker({changeMonth:!0,changeYear:!0,beforeShow:function(){t._editBox.show()},onClose:function(i){if(i!=""){var l=t.getModel(),r=t.lastValue.split(" "),e="",o="";e=r[0];r.length>1&&(o=r[1]);var s=t._convertDate(n(this).datepicker("getDate"),t._dateFormatInternal),h=t._convertTime(n(this).datepicker("getDate"),t._timeFormatInternal),c="",u="",f=t._expr.value.split(" ");c=s!=t._convertDateString(e,t._dateFormatValue,t._dateFormatInternal)?s:f[0];h!=t._convertTimeString(o,t._timeFormatValue,t._timeFormatInternal)?u=h:f.length>1&&(u=f[1]);i!=t.lastValue&&t._setValue(n.trim(c+" "+u));t._editBox.hide()}else t._editBox.hide(),t._editBox.datepicker("hide")}}),t._dateFormatValue?t._editBox.datepicker("option","dateFormat",t._dateFormatValue):t._dateFormatValue=t._editBox.datepicker("option","dateFormat"),t._yearRange?t._editBox.datepicker("option","yearRange",t._yearRange):t._yearRange=t._editBox.datepicker("option","yearRange"),t._timeFormatValue?t._editBox.timepicker("option","timeFormat",t._timeFormatValue):t._timeFormatValue=t._editBox.datepicker("option","timeFormat"))},_showEditor:function(){var n=this,f=this.getModel(),t,i,u,r;if(n._expr.dataType=="Time")t=this._expr.value,r=f.getMacroTimeValue(t),r&&(t=this._convertTime(r,this._timeFormatInternal)),n._editBox.val(this._convertTimeString(t,this._timeFormatInternal,this._timeFormatValue));else if(n._expr.dataType=="Date")i=this._expr.value,u=f.getMacroDateValue(i),u&&(i=this._convertDate(u,this._dateFormatInternal)),n._editBox.val(this._convertDateString(i,this._dateFormatInternal,this._dateFormatValue));else if(n._expr.dataType=="DateTime"){var e=this._expr.value.split(" "),l=this._expr.value,i="",t="";i=e[0];e.length>1&&(t=e[1]);u=f.getMacroDateValue(i);u&&(i=this._convertDate(u,this._dateFormatInternal));r=f.getMacroTimeValue(t);r&&(t=this._convertTime(r,this._timeFormatInternal));n._editBox.val(this._convertDateString(i,this._dateFormatInternal,this._dateFormatValue)+" "+this._convertTimeString(t,this._timeFormatInternal,this._timeFormatValue))}n.lastValue=n._editBox.val();var o=this.getQueryPanel(),s=o&&o.options.isSubQuery?o.options.dialogZIndex+1e3:1e5,h=n._linkElement.position().left,c=n._linkElement.position().top;n._editBox.css({left:h,top:c,width:n._expr.dataType=="DateTime"?"150px":"115px","min-width":n._linkElement.width(),position:"absolute",zIndex:s}).show().focus()},_adjustNewValue:function(t){var i=this.getModel();if(this._expr.dataType=="Date")return i&&n.inArray(t,i.dateMacroList)>=0?t:this._convertDateValueString(t,this._dateFormatInternal,this._dateFormatInternal);if(this._expr.dataType=="DateTime"){var f=t.split(" "),r="",u="";return r=f[0],f.length>1&&(u=f[1]),i&&n.inArray(r,i.dateMacroList)<0&&(r=this._convertDateValueString(r,this._dateFormatInternal,this._dateFormatInternal)),u==""?n.trim(r):(i&&n.inArray(u,i.timeMacroList)<0&&(u=this._convertTimeValueString(u,this._timeFormatInternal,this._timeFormatInternal)),n.trim(r+" "+u))}if(this._expr.dataType=="Time")return i&&n.inArray(t,i.timeMacroList)>=0?t:this._convertTimeValueString(t,this._timeFormatInternal,this._timeFormatInternal)},_adjustExprText:function(){try{if(this._expr.value&&this._expr.value!="")if(this._expr.dataType=="Date")this._expr.text=this._convertDateValueString(this._expr.value,this._dateFormatInternal,this._dateFormatDisplay);else if(this._expr.dataType=="DateTime"){var i=this._expr.value.split(" "),n=this._expr.value,t="";i.length>1&&(n=i[0],t=i[1]);try{n=this._convertDateValueString(n,this._dateFormatInternal,this._dateFormatDisplay)}catch(r){n=""}try{t=this._convertTimeValueString(t,this._timeFormatInternal,this._timeFormatDisplay)}catch(r){t=""}this._expr.text=n==""||t==""?n+t:n+" "+t}else this._expr.dataType=="Time"&&(this._expr.text=this._convertTimeValueString(this._expr.value,this._timeFormatInternal,this._timeFormatDisplay));else this._expr.text=""}catch(r){this._expr.text=""}},_validate:function(){return{result:!0,message:""}},_convertDateValueString:function(t,i,r){var f=this.getModel(),e="${Today}",o,u;return f&&n.inArray(t,f.dateMacroList)>=0?(o=t.substring(2,t.length-1),u=this.getResText(o),u?u:e):(u=this._convertDateString(t,i,r),u?u:e)},_convertDateString:function(t,i,r){try{var u=n.datepicker.parseDate(i,t);return this._convertDate(u,r)}catch(f){return""}},_convertDate:function(t,i){return n.datepicker.formatDate(i,t)},_convertTime:function(t,i){var r={hour:t.getHours(),minute:t.getMinutes(),second:t.getSeconds(),millisec:t.getMilliseconds(),microsec:t.getMicroseconds(),timezone:t.getTimezoneOffset()*-1};return n.datepicker.formatTime(i,r)},_convertTimeValueString:function(t,i,r){var f=this.getModel(),e,u;return f&&n.inArray(t,f.timeMacroList)>=0?(e=t.substring(2,t.length-1),u=this.getResText(e),u?u:""):(u=this._convertTimeString(t,i,r),u?u:"")},_convertTimeString:function(t,i,r){try{var u=n.datepicker.parseTime(i,t);return u?n.datepicker.formatTime(r,u):""}catch(f){return""}}})}(jQuery),function(n){n.widget("eqjs.ValueEditor_LIST",n.eqjs.ValueEditor,{_menuBlock:null,_menuItemsList:null,_emptyListText:"<empty list>",_showWhenReady:!1,_getEmptyText:function(){return this._menuItemsList&&this._menuItemsList.length>0?this.options.emptyText||this.getResText("MsgEmptyListValue"):this.options.emptyText||this._emptyListText},_getListName:function(){return this.options.editor.name},_renderEditor:function(){var n=this;n._fillMenuItemsList();n._renderMenuBlock()},_renderMenuBlock:function(){var r=this,u=!1,t,i,f;this._expr&&(u=this._expr.kind=="List");t=this.getQueryPanel();i={items:r._menuItemsList,multiselect:u,container:t?t.options.menuContainer:null,onMenuItemSelected:function(n,t){var f,e,i;if(u){if(t.selectedItems){for(f=[],e=t.selectedItems.length,i=0;i<e;i++)f.push(t.selectedItems[i].id);r._setValue(f)}}else r._setValue(t.menuItem.id);return!1}};t&&n.extend(i,t.options.menuOptions);t&&t.options.isSubQuery&&(i.zIndex=t.options.dialogZIndex+1e3);f=r.options.parentWidget.element.attr("id");f&&(i.id=f+"-EditorMenu");t&&(i.domWriteItemsId=t.options.domWriteItemsId);i.buttons={submit:EQ.core.getText("ButtonApply"),cancel:EQ.core.getText("ButtonCancel")};r._menuBlock=n("<div><\/div>").hide().appendTo(r.element).PopupMenu(i)},_beforeShowEditor:function(){var n=this._getListName();return n&&n.match(/{{.+?}}/)?(this._showWhenReady=!0,this._renderEditor(),!1):!0},_showEditor:function(){var n=this;n._menuBlock?this._menuBlock.PopupMenu("showMenu",{anchor:n._linkElement,selectedIds:n._getValueAsArray()}):this._showWhenReady=!0},_getValueAsArray:function(){var t=this,i;return t._expr.kind!="List"?[t._expr.value]:(i=t._expr.value.match(/"[^"\\]*(?:\\.[^"\\]*)*"|[^,]+/g),i?n.map(i,function(n){return n.charAt(0)=='"'&&n.charAt(n.length-1)=='"'?(n=n.substring(1,n.length-1),n.replace(/\"/g,'"')):n}):[])},_adjustNewValue:function(t){if(n.isArray(t)){var i=n.map(t,function(n){return n.indexOf(",")>=0?(n=n.replace(/"/g,'"'),'"'+n+'"'):n});return i.join(",")}return t},_adjustExprText:function(){var t=this,i,u=[],f,e,r;t._expr.value&&t._menuItemsList?(i=t._getValueAsArray(),t._expr.text="",e=i.length,r=function(t){for(var e,o=0;o<t.length;o++)e=t[o],e.items?r(e.items):(f=n.grep(i,function(n){return e.id==n}),f.length>0&&u.push(e.text))},r(t._menuItemsList),t._expr.text=u.join(",")):t._expr.text=""},_takeFirstItemInList:function(){this._menuItemsList&&this._menuItemsList.length>0&&this._setValueSilent(this._menuItemsList[0].id)},_takeDefaultValue:function(){var i,n,t;if(this._menuItemsList)for(i=this._menuItemsList.length,n=0;n<i;n++)if(t=this._menuItemsList[n],t.isDefault){this._setValueSilent(t.id);break}},_fillMenuItemsList:function(){this._menuItemsList=this.options.editor.values}})}(jQuery),function(n){n.widget("eqjs.ValueEditor_CUSTOMLIST",n.eqjs.ValueEditor_LIST,{_loaderElement:null,_renderEditor:function(){var t=this;(this._linkElement.hide(),this._loaderElement||(this._loaderElement=n("<div><\/div>",{"class":"eqjs-qp-ve-loader"}).appendTo(t.element)),this._loaderElement.show(),this._loading)||(this._loading=!0,this._fillMenuItemsList(function(){t._loading=!1;var n=t._getDisplayText();t._linkElement.text(n);t._linkElement.attr("title",n);t._loaderElement.hide();t._linkElement.show();t._renderMenuBlock();t._isEmptyValue()&&t._takeDefaultValue();t._showWhenReady&&(t._showWhenReady=!1,t._showEditor())}))},_fillMenuItemsList:function(n){var i=this,t=this._getListName(),r=this.getQuery().getListRequestHandler(),u=this.getQueryPanel();EQ.core.constLists[t]?(i._menuItemsList=EQ.core.constLists[t],n&&n()):t==="EntityTree"?(i._menuItemsList=u.options.entitiesList,n&&n()):r&&r({listName:t},function(t){i._menuItemsList=t;n&&n()})}})}(jQuery),function(n){n.widget("eqjs.ValueEditor_SQLLIST",n.eqjs.ValueEditor_CUSTOMLIST,{_fillMenuItemsList:function(n){var r=this,u=this.getQuery(),f=this.options.editor,t=u.getListRequestHandler(),i;t&&(i={listName:"SQL",editorId:f.id},t(i,function(t){r._menuItemsList=t;n&&n()}))}})}(jQuery),function(n){n.widget("eqjs.ValueEditor_SUBQUERY",n.eqjs.ValueEditor,{_dialogBlock:null,_queryPanelBlock:null,_columnElement:null,_colEntitiesList:null,_getEmptyText:function(){return this.getResText("MsgSubQueryValue")},_renderEditor:function(){var t=this,u,r,e,l,f;this._dialogBlock=n("<div><\/div>",{"class":"eqjs-qp-ve-subquery"}).hide().appendTo(t.element);var i=this.getQueryPanel(),s=this.getModel(),h=this._expr.dataType;this._colEntitiesList=s.getEntitiesTreeWithFilter(function(n){return n.attributes&&n.uic?!0:n.uic&&(!n.dataType||n.dataType==h)});u=n("<div><\/div>").hide().appendTo(t._dialogBlock);r=t.options.parentWidget.element.attr("id");r&&(r+="-SubColumnMenu");e=n.extend({id:r,items:t._colEntitiesList,zIndex:i.options.dialogZIndex+1e3,domWriteItemsId:i.options.domWriteItemsId,isSubQuery:!0},i.options.menuOptions);u.PopupMenu(e);var o=n("<div><\/div>").addClass("eqjs-qp-ve-subquery-column").appendTo(t._dialogBlock),a=n("<div><\/div>").addClass("eqjs-qp-ve-subquery-column-title").text(t.getResText("SubQueryColumnTitle")).appendTo(o),c=n("<div><\/div>").addClass("eqjs-qp-ve-subquery-column-element").appendTo(o);t._columnElement=n("<a><\/a>").attr("href","javascript:void(0)").appendTo(c);t._columnElement.click(function(){u.PopupMenu("showMenu",{anchor:t._columnElement,selectedIds:null,itemSelectedCallback:function(n,i){return t._columnElementMenuClick(n,i)}})});l=n("<div><\/div>").addClass("eqjs-qp-ve-subquery-qp-caption").text(t.getResText("SubQueryQueryPanelCaption")).appendTo(t._dialogBlock);t._queryPanelBlock=n('<div class="eqjs-qp-ve-subquery-qp"><\/div>').appendTo(t._dialogBlock);f=t.options.parentWidget.element.attr("id");f&&t._queryPanelBlock.attr("id",f+"-SubQueryPanel");t._dialogBlock.dialog({autoOpen:!1,draggable:!1,resizable:!1,title:t.getResText("SubQueryDialogTitle"),dialogClass:"eq-js-dialog",closeText:"X",modal:!0,width:i.options.subQueryDialogWidth,minHeight:i.options.subQueryDialogHeight,zIndex:i.options.dialogZIndex,buttons:[{name:"eqjs-subquery-button-ok",text:t.getResText("ButtonOK"),click:function(){var r=t.getSubQuery(),i;t._expr.value=r.getObject();n(this).dialog("close");i=t.getQuery();i.fireChangedEvent({source:t.getQueryPanel(),changeType:"condition.changed",condition:t.getCondition(),what:"value"},!0)}},{name:"eqjs-subquery-button-cancel",text:t.getResText("ButtonCancel"),click:function(){n(this).dialog("close")}}],open:function(){n(".ui-widget-overlay").addClass("eq-js-dialog-overlay");n("body").css("overflow","hidden")},beforeClose:function(){n(".ui-widget-overlay").removeClass("eq-js-dialog-overlay");n("body").css("overflow","auto")},close:function(){t._queryPanelBlock.QueryPanel("destroy")}})},_columnElementMenuClick:function(n,t){var r=this,i=t.menuItem.data("id");return this._setResultAttributeId(i),!1},_setResultAttributeId:function(n){var i=this.getModel().getAttributeById(n),u,r,t,f,e;i&&(u=this.getSubQuery(),r=u.getColumns(),r.length>0?(t=r[0],t.expr.id=n,t.expr.dataType=i.dataType):(t={caption:"",sorting:"None",sortIndex:-1,expr:{typeName:"ENTATTR",id:n,kind:"Attribute",dataType:i.dataType}},r.push(t)),f=this.getQuery(),e=this.getQueryPanel(),f.fireChangedEvent({source:e,changeType:"subQuery.column.change",column:t},!0),this._columnElement.text(this._getAttributeText(i)),this._okButtonEnable(!0))},_getAttributeText:function(n){var r=this,t,u,i,f,e;return n?(t=EQ.core.getText("Attributes",n.id),t||(t=n.caption),u=this.getQueryPanel(),i=u.options.attrElementFormat,!i)?t:(f=i.replace(new RegExp("{attr}","g"),t),e=r.getModel().getFullEntityPathByAttr(n.id,"."),f.replace(new RegExp("{entity}","g"),e)):r.getResText("SubQueryEmptyColumn")},_showEditor:function(){var r=this,o=this.getQuery(),f=this.getQueryPanel(),c,i,t,u,s,h,e;r._queryPanelBlock.empty();c=jQuery.extend(!0,{},r._getValue());i=new EQ.core.Query(this.getModel(),c);i.clientListRequestHandler=o.clientListRequestHandler;i.serverListRequestHandler=o.serverListRequestHandler;i.addChangedCallback(function(t){var i=n.extend({},t);i.source=f;i.changeType="subQuery."+i.changeType;o.fireChangedEvent(i)});t=n.extend({},f.options);t.isSubQuery=!0;t.showAddRow=!0;t.menuContainer=document.body;t.menuOptions.isSubQuery=!0;t.entitiesListFilter=function(n,t){if(f.options.entitiesListFilter){var i=t||{};i.isSubQuery=!0;f.options.entitiesListFilter(n,i)}};r._queryPanelBlock.QueryPanel(t);r._queryPanelBlock.QueryPanel("setQuery",i);u=null;s=i.getColumns();s.length==0?(h=this.getCondition(),h.expressions.length>0&&(e=h.expressions[0],u=e.typeName=="ENTATTR"||e.kind=="Attribute"?e.id:null)):u=s[0].expr.id;u?this._setResultAttributeId(u):this._columnElement.text(this.getResText("SubQueryEmptyColumn"));r._dialogBlock.dialog("open")},getSubQuery:function(){return this._queryPanelBlock.QueryPanel("getQuery")},_okButtonEnable:function(n){var t=this._dialogBlock.next(".ui-dialog-buttonpane").find("[name='eqjs-subquery-button-ok']");t&&(n?t.button("enable"):t.button("disable"))},_getDisplayText:function(){return this._getEmptyText()}})}(jQuery),function(n){n.widget("eqjs.PredicateLinkType",n.eqjs.ValueEditor_LIST,{_predicate:null,options:{queryPanel:null},getCondition:function(){return this._predicate},init:function(n){this._predicate=n;this.refresh()},_render:function(){this.clear();this._predicate&&(this._renderCommonPart(),this._predicate.enabled!==!1&&this._renderEditor(),this._linkElement.text(this._getDisplayText()))},_showEditor:function(){var n=this;n._menuBlock.PopupMenu("showMenu",{anchor:n._linkElement})},_fillMenuItemsList:function(){this._menuItemsList=EQ.core.predicateLinkTypeList},_setValue:function(n){if(this._predicate.linkType=n,this._linkElement.text(this._getDisplayText()),this.options.onChange)this.options.onChange(n);return!0},_beforeShowEditor:function(){return!0},_getClassesToAdd:function(){return"eqjs-qp-predelement eqjs-qp-predvalueelement"},_getDisplayText:function(){var t=this,i=this._getEmptyText();return t._predicate.linkType&&t._predicate.linkType!=""&&n.each(EQ.core.predicateLinkTypeList,function(){this.id===t._predicate.linkType&&(i=this.text)}),i}})}(jQuery),function(n){n.widget("eqjs.ColumnRow",{_column:null,_baseExprBlock:null,_captionEditorBlock:null,_buttonsBlock:null,_columnTypeButton:null,_deleteButton:null,_keepShowingButtons:!1,_isMouseOverBlock:!1,_sortingButton:null,_panelCssPrefix:"eqjs-qc",_classesToAdd:"",_active:!1,options:{columnsPanel:null},getColumnsPanel:function(){return this.options.columnsPanel},getQuery:function(){return this.options.columnsPanel?this.options.columnsPanel.getQuery():null},getModel:function(){var n=this.getQuery();return n?n.getModel():null},getColumn:function(){return this._column},isModelNullOrEmpty:function(){var n=this.getModel();return!n||n.isEmpty()},_initCssPrefixes:function(){},init:function(n){var t=this;this._initCssPrefixes();t._column=n;t.element.get(0).column=n;t.refresh()},_render:function(){this._clear();!this.isModelNullOrEmpty()&&this._column&&(this._refreshByColumn(),this._initButtons(),this.options.columnsPanel.options.activeColumn==this._column&&this.makeActive())},_fireColumnChange:function(n,t){var i=this,r;t=t||i._column;r=this.getQuery();r.fireChangedEvent({source:i.options.columnsPanel,changeType:"column."+n,column:t},!0)},refresh:function(){this._render()},_setOption:function(n,t){return arguments.length==2?(this.options[n]=t,n==="disabled"&&(this._column.enabled=!t),this._render(),this):n==="disabled"?this._column.enabled===!1:this.options[n]},_clear:function(){this.element.unbind();this.element.html("");this.element.removeClass()},_refreshByColumn:function(){},remove:function(){var n=this;n.options.columnsPanel&&n.options.columnsPanel.removeColumn(n._column)},_getButtonsContainer:function(){return this.element},_getUIS:function(){return this.getModel().checkAttrProperty(this._column.expr.id,"uis")},_initButtons:function(){var t=this,e=this.getQuery(),o=this.getColumnsPanel(),r=n("<div><\/div>").addClass("eqjs-button-placeholder").addClass(t._panelCssPrefix+"-button-placeholder").addClass(t._panelCssPrefix+"-colelement").prependTo(t.element),u,i,f;(t._sortingButton=n("<div><\/div>").addClass("eqjs-column-sortbutton").appendTo(r),u=t._getButtonsContainer(),u&&!t._column.readOnly)&&(t._buttonsBlock=n("<div><\/div>").addClass("eqjs-column-buttonsBlock").appendTo(u),r=n("<div><\/div>").addClass("eqjs-button-placeholder").addClass(t._panelCssPrefix+"-button-placeholder").appendTo(t._buttonsBlock),t._columnTypeButton=n("<div><\/div>").addClass("eqjs-button").addClass("eqjs-column-button").addClass("eqjs-column-button-type").attr("title",EQ.core.getText("ButtonToAggr")).appendTo(r),r=n("<div><\/div>").addClass("eqjs-button-placeholder").addClass(t._panelCssPrefix+"-button-placeholder").appendTo(t._buttonsBlock),t._deleteButton=n("<div><\/div>").addClass("eqjs-button").addClass("eqjs-column-button").addClass("eqjs-column-button-delete").attr("title",EQ.core.getText("ButtonDelete")).appendTo(r).click(function(){t.remove()}),t._sortingButton.attr("title",EQ.core.getText("ButtonSorting")).click(function(){t._keepShowingButtons=!0;var n=t._getUIS()?t.options.columnsPanel.options.sortMenu:t.options.columnsPanel.options.moveMenu;n.PopupMenu("showMenu",{anchor:t._sortingButton,selectedIds:null,itemSelectedCallback:function(n,i){i.menuItem.id=="None"||i.menuItem.id=="Ascending"||i.menuItem.id=="Descending"?(t._column.sorting=i.menuItem.id,t._column.sortIndex=e.getColumnSortIndex(t._column),o.refresh(),t._fireColumnChange("change")):t.options.columnsPanel.moveColumn(t._column,i.menuItem.id)},menuClosedCallback:function(){t._keepShowingButtons=!1;t._isMouseOverBlock||t._sortingButton.trigger("mouseleave")}})}),i="eqjs-column-sortbutton",t._sortingButton.addClass("eqjs-button"),t._column.sorting==="None"&&t._sortingButton.addClass(i+"-none"),t._sortingButton.hover(function(){n(this).addClass(i+"-active")},function(){n(this).removeClass(i+"-active")}),t._column.sorting==="Ascending"?t._sortingButton.addClass(i+"-asc").attr("title",EQ.core.getText("ButtonSorting")):t._column.sorting==="Descending"&&t._sortingButton.addClass(i+"-desc").attr("title",EQ.core.getText("ButtonSorting")),f=this._panelCssPrefix+"-button",u.find("[class*="+f+"]").hover(function(){n(this).addClass(f+"-active")},function(){n(this).removeClass(f+"-active")}),u.bind("mouseenter",function(n){return t._isMouseOverBlock=!0,t._enterButtonBlock(),n.stopPropagation(),!1}).bind("mouseleave",function(n){return t._isMouseOverBlock=!1,t._keepShowingButtons||t._leaveButtonBlock(),n.stopPropagation(),!1}),t._setupButtonListeners(),t._hideButtons(),t._adjustButtonsVisibility())},_setupButtonListeners:function(){},_adjustButtonsVisibility:function(){},_enterButtonBlock:function(){this._showButtons()},_leaveButtonBlock:function(){this.options.columnsPanel.options.alwaysShowButtons==!0||this._active&&this.options.columnsPanel.options.accentActiveColumn==!0||this._hideButtons()},_showButtons:function(){},_hideButtons:function(){this._columnTypeButton.hide();this._deleteButton.hide();this._column.sorting==="None"&&this._sortingButton.hide()},internalActivate:function(){this._active=!0;this.adjustActiveClass();this._hideButtons();this._adjustButtonsVisibility()},internalDeactivate:function(){this._active=!1;this.adjustActiveClass();this._hideButtons();this._adjustButtonsVisibility()},adjustActiveClass:function(){this._active&&this.options.columnsPanel.options.accentActiveColumn?this.element.addClass("active"):this.element.removeClass("active")},getColumnsPanel:function(){return this.options.columnsPanel},isActive:function(){return this._active},makeActive:function(){var n=this.getColumnsPanel();n&&n.setActiveColumnWidget(this)}})}(jQuery),function(n){n.widget("eqjs.ColumnRow_ENTATTR",n.eqjs.ColumnRow,{_baseAttr:null,_menuFunctionsBlock:null,_paramsBlock:null,_initCssPrefixes:function(){this._panelCssPrefix=this.options.columnsPanel._getCssPrefix();this._classesToAdd=this._panelCssPrefix+"-row "+this._panelCssPrefix+"-row-column-entattr"},_baseExprMenuClick:function(n,t){var i=this,r=t.menuItem.data("id"),u=i.getModel().getAttributeById(r);return i._column.expr.id=r,i._column.caption="",i.refresh(),i._fireColumnChange("change"),!1},_getBaseExpr:function(){var t=this,i=null;return i=t._column.enabled===!1||t._column.readOnly?n("<span><\/span>").text(t._getAttributeText(t._baseAttr)).attr("title",t._getAttributeText(t._baseAttr)):n("<a><\/a>").attr("href","javascript:void(0)").text(t._getAttributeText(t._baseAttr)).attr("title",t._getAttributeText(t._baseAttr)).click(function(n){n.preventDefault();t.options.columnsPanel.options.entitiesMenu.PopupMenu("showMenu",{anchor:i,selectedIds:null,itemSelectedCallback:function(n,i){return t._baseExprMenuClick(n,i)}})})},_fillBaseBlock:function(t){var i=this,r;t.addClass(this._panelCssPrefix+"-expr-block");i._baseExprBlock=n("<div><\/div>").addClass(this._panelCssPrefix+"-colelement").addClass(this._panelCssPrefix+"-attrelement").appendTo(t);r=i._getBaseExpr();r.appendTo(i._baseExprBlock);i._column.params&&i._column.params.length>0&&(i._paramsBlock=n("<div><\/div>").addClass(this._panelCssPrefix+"-params-block").appendTo(t),i._fillParamsBlock(i._paramsBlock));i._column.readOnly||i._createFunctionMenu()},_fillParamsBlock:function(t){var i=this;n("<span>(<\/span>").addClass("eqjs-qc-colelement").addClass("eqjs-qp-valueelement").appendTo(t);i._column.params.forEach(function(r,u,f){var e=n("<div><\/div>");e.appendTo(t);i._createParamEditor(e,r);u<f.length-1&&n("<span>,&nbsp<\/span>").addClass("eqjs-qc-colelement").addClass("eqjs-qp-valueelement").appendTo(t)});n("<span>)<\/span>").addClass("eqjs-qc-colelement").addClass("eqjs-qp-valueelement").appendTo(t)},_getParamEditor:function(t){var r=this,u=r.getModel(),f=r._getAttribute(),i={};return t&&t.editor&&t.editor.type!=="Unknown"?i=n.extend({},t.editor):i.type=t&&(t.dataType=="Date"||t.dataType=="DateTime"||t.dataType=="Time")?"DATETIME":"EDIT",i},_createParamEditor:function(n,t){var r=this,i=r._getParamEditor(t);if(t.kind="Scalar",i){var u="element.ValueEditor_"+i.type+"({parentWidget:self, editor: editorObj, onChange:paramChangedCallback, emptyText: emptyTxt}); element.ValueEditor_"+i.type+"('init', expr);",f=new Function("self, element, expr, editorObj, paramChangedCallback, emptyTxt",u),e=function(){r._fireColumnChange("change",r._column)};f(this,n,t,i,e,"<"+t.caption+">")}},_refreshByColumn:function(){var t,i,r,u;this._column&&!this.isModelNullOrEmpty()&&(t=this,t._baseAttr=t._getAttribute(),t.element.addClass(t._classesToAdd),t._column.readOnly&&this.element.addClass("eqjs-qp-readonly"),i=n("<div><\/div>").appendTo(t.element),t._fillBaseBlock(i),t.options.columnsPanel.options.accentActiveColumn&&t.element.click(function(){t._active||t.makeActive()}),t._column.caption&&t._column.caption!=""||(t._column.caption=t._getDefaultCaption()),t.options.columnsPanel.options.showColumnCaptions&&(t._column.readOnly?u=n("<span><\/span>").addClass(this._panelCssPrefix+"-colelement").addClass(this._panelCssPrefix+"-captionelement").text(t._column.caption).attr("title",t._column.caption).appendTo(this.element):(this._captionEditorBlock=n("<div><\/div>"),this._captionEditorBlock.appendTo(this.element),r=function(){t._column.captionChanged=!0;t._fireColumnChange("change")},this._captionEditorBlock.ColumnRow_CaptionEditor({parentWidget:t,cssClassPrefix:this._panelCssPrefix}),this._captionEditorBlock.ColumnRow_CaptionEditor("init",t._column,t._column.caption,r))),t.adjustActiveClass())},_getDefaultTitleText:function(n){var t=this.options.columnsPanel,i=t.options.titleElementFormat||t.options.attrElementFormat,r=this.getModel();return r.getAttributeText(n,i)},_getDefaultCaption:function(){return this._getDefaultTitleText(this._baseAttr)},_getAttribute:function(){return this.getModel().getAttributeById(this._column.expr.id)},_getAttributeText:function(n){var r=this,t,i;return n?(t=this.getModel(),i=r.options.columnsPanel.options.attrElementFormat,t.getAttributeText(n,i)):""},_adjustButtonsVisibility:function(){var n=this;n._columnTypeButton.removeClass("aggregated").attr("title",EQ.core.getText("ButtonToAggr"));(this.options.columnsPanel.options.alwaysShowButtons||this.options.columnsPanel.options.accentActiveColumn&&this._active)&&this._showButtons()},_changeTypeToAggr:function(n){var t=this,i,r,u;n||(n=t._menuFunctionsBlock.PopupMenu("option","items")[0].id);i=t._column.expr.id;t._column.caption="";t._column.expr={func:n,distinct:!1,typeName:"AGGRFUNC",argument:{typeName:"ENTATTR",id:i}};r=t._column;u=t._active;t.destroy();t._clear();t.element.ColumnRow_AGGRFUNC({columnsPanel:t.options.columnsPanel});t.element.ColumnRow_AGGRFUNC("init",r);t._fireColumnChange("change");u&&(t.options.columnsPanel._activeColumn=null,t.element.ColumnRow_AGGRFUNC("makeActive"))},_changeTypeToCustomSql:function(){var n=this,r=n._column.expr.id,t,i,u,f;n._column.caption="";t="";i=n.getModel();i&&(t=i.getAttributeById(r).sqlExpr);n._column.expr={sql:t,baseAttrId:r,typeName:"CUSTOMSQL"};u=n._column;f=n._active;n.destroy();n._clear();n.element.ColumnRow_CUSTOMSQL({columnsPanel:n.options.columnsPanel});n.element.ColumnRow_CUSTOMSQL("init",u);n._fireColumnChange("change");f&&(n.options.columnsPanel._activeColumn=null,n.element.ColumnRow_CUSTOMSQL("makeActive"));n.element.ColumnRow_CUSTOMSQL("showSqlEditor")},_createFunctionMenu:function(){for(var a,s,h,t=this,f=[],r=t.getModel().getAggrFunctions(),e=!0,c=!0,u=null,l=t._getAttribute(),o,v=r.length,i=0;i<v;i++)r[i]&&(e=!0,r[i].id==="SUM"||r[i].id==="AVG"?e=n.inArray(l.dataType,["Autoinc","Byte","Currency","Float","Int","Int64","Word"])>=0:(r[i].id==="MIN"||r[i].id==="MAX")&&(e=n.inArray(l.dataType,["Autoinc","BCD","Byte","Currency","Date","DateTime","Float","Int","Int64","Time","Word"])>=0),t._column.expr.func!==r[i].id||e||(c=!1),e&&(o=t.getModel().getAggrFunctionCaption(r[i].id),u={id:r[i].id,text:o},f.push(u)));return c||(t._column.expr.func=f[0].id),a=t.options.columnsPanel,a.areCustomExpressionsAllowed()&&(u={id:"CustomSqlDivider",text:"---"},f.push(u),o=EQ.core.getText("CustomExpression"),u={id:"CUSTOMSQL",text:o},f.push(u)),t._menuFunctionsBlock=n("<div><\/div>").hide().appendTo(t.element),s=t.element.attr("id"),s&&(s+="-FunctionsMenu"),h={items:f,id:s,domWriteItemsId:t.options.columnsPanel.options.domWriteItemsId},n.extend(h,t.options.columnsPanel.options.menuOptions),t._menuFunctionsBlock.PopupMenu(h),t._menuFunctionsBlock},_showButtons:function(){this.options.columnsPanel.options.allowAggrColumns!=!1?this._columnTypeButton.show():this._columnTypeButton.attr("title","");this._deleteButton.show();this._sortingButton.show()},_setupButtonListeners:function(){var n=this;n._columnTypeButton&&n._columnTypeButton.click(function(){n.options.columnsPanel.options.allowAggrColumns!==!1&&n._column.enabled!==!1&&(n._keepShowingButtons=!0,n._menuFunctionsBlock.PopupMenu("showMenu",{anchor:n._columnTypeButton,selectedIds:null,itemSelectedCallback:function(t,i){return i.menuItem.id=="CUSTOMSQL"?n._changeTypeToCustomSql():n._changeTypeToAggr(i.menuItem.id),!1},menuClosedCallback:function(){n._keepShowingButtons=!1;n._isMouseOverBlock||n._columnTypeButton.trigger("mouseleave")}}))})}})}(jQuery),function(n){n.widget("eqjs.ColumnRow_AGGRFUNC",n.eqjs.ColumnRow_ENTATTR,{_displayFormatParser:{formatStr:"",pos:0,token:"text",tokenText:"",start:function(n){this.formatStr=n;this.pos=0;this.tokenText=""},skipSpaces:function(){while(this.pos<this.formatStr.length&&this.formatStr.charAt(this.pos)===" ")this.pos++},next:function(){var t,i,r;if(this.skipSpaces(),this.pos>=this.formatStr.length)return!1;if(t=0,this.formatStr.charAt(this.pos)==="{"){if(t=this.formatStr.indexOf("}",this.pos),t<0)return!1;this.tokenText=this.formatStr.substring(this.pos,t+1);(this.tokenText.indexOf("{expr")===0||this.tokenText.indexOf("{attr")===0)&&(this.token="expression");this.pos=t+1}else this.formatStr.charAt(this.pos)==="["&&this.pos<this.formatStr.length-1&&this.formatStr.charAt(this.pos+1)==="["?(this.pos+=2,t=this.formatStr.indexOf("]]",this.pos),this.token="function",this.tokenText=this.formatStr.substring(this.pos,t),this.pos=t+2):(this.token="text",i=this.formatStr.indexOf("{",this.pos),i<0&&(i=this.formatStr.length),r=this.formatStr.indexOf("[[",this.pos),r<0&&(r=this.formatStr.length),t=Math.min(i,r),this.tokenText=n.trim(this.formatStr.substring(this.pos,t)),this.pos=t);return!0}},_initCssPrefixes:function(){this._panelCssPrefix=this.options.columnsPanel._getCssPrefix();this._classesToAdd=this._panelCssPrefix+"-row "+this._panelCssPrefix+"-row-column-aggr"},_parseDisplayFormat:function(n){if(!n)return[];var i=[],t=this._displayFormatParser;for(t.start(n);t.next();)t.token==="function"?i.push({type:1,text:t.tokenText}):t.token==="expression"?i.push({type:2}):t.token==="text"&&i.push({type:3,text:t.tokenText});return i},_baseExprMenuClick:function(n,t){var i=this,r=t.menuItem.data("id"),u=i.getModel().getAttributeById(r);return i._column.expr.argument.id=r,i._column.caption="",i.refresh(),i._fireColumnChange("change"),!1},_fillBaseBlock:function(t){var i=this,h,u,f,e,o,r,c,s,l;if((t.addClass(this._panelCssPrefix+"-expr-block "+this._panelCssPrefix+"-expr-block-aggr"),f=n("<div><\/div>").addClass(this._panelCssPrefix+"-colelement").addClass(this._panelCssPrefix+"-aggrfuncelement"),i._column.enabled===!1||i._column.readOnly?u=n("<span><\/span>").appendTo(f):(u=n("<a><\/a>",{href:"javascript:void(0)"}).appendTo(f),i._createFunctionMenu()),e=i.getModel().getAggrFunctionFormat(i._column.expr.func),e&&e!=="")&&(o=i._parseDisplayFormat(e),o.length!==0))for(r=null,c=o.length,s=0;s<c;s++)r=o[s],r.type===1?(u.text(r.text),f.appendTo(t),i._column.enabled!==!1&&u.click(function(){i._menuFunctionsBlock.PopupMenu("showMenu",{anchor:u,selectedIds:null,itemSelectedCallback:function(n,t){return i._column.expr.func=t.menuItem.id,i._column.caption="",i.refresh(),i._fireColumnChange("change"),!1}})})):r.type===2?(i._baseAttr=i._getAttribute(),h=this._getBaseExpr(),i._baseExprBlock=n("<div><\/div>").addClass(this._panelCssPrefix+"-colelement").addClass(this._panelCssPrefix+"-attrelement").appendTo(t),h.appendTo(i._baseExprBlock)):r.type===3&&(l=n("<span><\/span>").addClass(this._panelCssPrefix+"-colelement").text(r.text).attr("title",r.text).appendTo(t))},_getDefaultCaption:function(){return this._getDefaultTitleText(this._baseAttr)+" "+this.getModel().getAggrFunctionCaption(this._column.expr.func)},_getAttribute:function(){return this.getModel().getAttributeById(this._column.expr.argument.id)},_setupButtonListeners:function(){var n=this;n._columnTypeButton.click(function(){if(n._column.enabled!==!1)return n._changeTypeToSimple(),!1})},_adjustButtonsVisibility:function(){var n=this;n._columnTypeButton.addClass("aggregated").attr("title",EQ.core.getText("ButtonToSimple"));(this.options.columnsPanel.options.alwaysShowButtons||this.options.columnsPanel.options.accentActiveColumn&&this._active)&&this._showButtons()},_changeTypeToSimple:function(){var n=this,r=n._column.expr.argument.id,t,i;n._column.caption="";n._column.expr={typeName:"ENTATTR",id:r};t=n._column;i=n._active;n.destroy();n._clear();n.element.ColumnRow_ENTATTR({columnsPanel:n.options.columnsPanel});n.element.ColumnRow_ENTATTR("init",t);n._fireColumnChange("change");i&&(n.options.columnsPanel._activeColumn=null,n.element.ColumnRow_ENTATTR("makeActive"))},_getUIS:function(){return this.getModel().checkAttrProperty(this._column.expr.argument.id,"uis")}})}(jQuery),function(n){n.widget("eqjs.ColumnRow_CUSTOMSQL",n.eqjs.ColumnRow_ENTATTR,{_fillBaseBlock:function(t){var i=this,r;t.addClass(this._panelCssPrefix+"-expr-block");i._baseExprBlock=n("<div><\/div>").addClass(this._panelCssPrefix+"-colelement").addClass(this._panelCssPrefix+"-attrelement").appendTo(t);r=function(){i._fireColumnChange("change")};i._column.captionChanged=!1;i._baseExprBlock.ColumnRow_CustomSqlExprEditor({parentWidget:i,cssClassPrefix:this._panelCssPrefix});i._baseExprBlock.ColumnRow_CustomSqlExprEditor("init",i._column,i._getDefaultValue(),r)},showSqlEditor:function(){this._baseExprBlock.ColumnRow_CustomSqlExprEditor("showEditor")},_getDefaultValue:function(){return this._column.expr.sql},_getDefaultCaption:function(){return"Custom SQL Column"},_adjustButtonsVisibility:function(){var n=this;n._columnTypeButton.addClass("aggregated").attr("title",EQ.core.getText("ButtonToSimple"));(this.options.columnsPanel.options.alwaysShowButtons||this.options.columnsPanel.options.accentActiveColumn&&this._active)&&this._showButtons()},_setupButtonListeners:function(){var n=this;n._columnTypeButton.click(function(){if(n._column.enabled!==!1)return n._changeTypeToSimple(),!1})},_changeTypeToSimple:function(){var n=this,r=n._column.expr.baseAttrId,t,i;n._column.caption="";n._column.expr={typeName:"ENTATTR",id:r};t=n._column;i=n._active;n.destroy();n._clear();n.element.ColumnRow_ENTATTR({columnsPanel:n.options.columnsPanel});n.element.ColumnRow_ENTATTR("init",t);n._fireColumnChange("change");i&&(n.options.columnsPanel._activeColumn=null,n.element.ColumnRow_ENTATTR("makeActive"))}})}(jQuery),function(n){n.widget("eqjs.ColumnRow_CaptionEditor",n.eqjs.ValueEditor_EDIT,{_column:null,_defaultValue:"",_editBoxClass:"eqjs-qc-ce-editbox",_onChange:null,options:{cssClassPrefix:"eqjs-qc"},init:function(n,t,i){this._editBoxClass=this.options.cssClassPrefix+"-ce-editbox";this._expr.value=n.caption;this._expr.text=n.caption;this._column=n;this._defaultValue=t;this._onChange=i;this.refresh()},_render:function(){this.clear();this._column&&(this._renderCommonPart(),this._renderEditor(),this._linkElement.text(this._getDisplayText()),this._linkElement.attr("title",this._getDisplayText()))},_renderCommonPart:function(){var t=this;t.element.addClass(t._getClassesToAdd());t._linkElement=n("<a><\/a>",{href:"javascript:void(0)",text:"-"}).appendTo(t.element);t._linkElement.click(function(){return t._showEditor(),!1})},_getClassesToAdd:function(){return this.options.cssClassPrefix+"-colelement "+this.options.cssClassPrefix+"-captionelement"},_setValue:function(n){return this._column.caption=n&&n!=""?n:this._defaultValue,this.updateLink(),this._onChange&&this._onChange(n),!0},updateLink:function(){this._linkElement.text(this._column.caption);this._linkElement.attr("title",this._column.caption)},_getValue:function(){return this._column.caption},_getText:function(){return this._column.caption},_getDisplayText:function(){return this._column.caption},_getZIndex:function(){return 1e5}})}(jQuery),function(n){n.widget("eqjs.ColumnRow_CustomSqlExprEditor",n.eqjs.ValueEditor_EDIT,{_column:null,_defaultValue:"",_editBoxClass:"eqjs-qc-ce-editbox",_onChange:null,options:{cssClassPrefix:"eqjs-qc",parentWidget:null},getColumnsPanel:function(){return this.options.parentWidget!=null?this.options.parentWidget.getColumnsPanel():null},init:function(n,t,i){this._editBoxClass=this.options.cssClassPrefix+"-ce-editbox";this._expr.value=n.expr.sql;this._expr.text=n.expr.sql;this._column=n;this._defaultValue=t;this._onChange=i;this.refresh()},_render:function(){this.clear();this._column&&(this._renderCommonPart(),this._renderEditor(),this._linkElement.text(this._getDisplayText()),this._linkElement.attr("title",this._getDisplayText()))},_renderCommonPart:function(){var t=this;t.element.addClass(t._getClassesToAdd());t._linkElement=n("<a><\/a>",{href:"javascript:void(0)",text:"-"}).appendTo(t.element);t._linkElement.click(function(){return t._showEditor(),!1})},_getClassesToAdd:function(){return this.options.cssClassPrefix+"-colelement "+this.options.cssClassPrefix+"-attrelement"},_setValue:function(n){return this._column.expr.sql=n&&n!=""?n:this._defaultValue,this._linkElement.text(this._getDisplayText()),this._linkElement.attr("title",this._column.expr.sql),this._onChange&&this._onChange(n),!0},_getValue:function(){return this._column.expr.sql},_getText:function(){return this._column.expr.sql},_getDisplayText:function(){var n=this.getColumnsPanel(),t=n!=null?n.options.customExpressionText:0;return t==1?EQ.core.getText("MsgCustomSql"):t==2?this._column.caption:this._column.expr.sql!=""?this._column.expr.sql:EQ.core.getText("MsgEmptyCustomSql")},_getZIndex:function(){return 1e5}})}(jQuery),function(n){n.widget("eqjs.ColumnsContainer",{_activeColumnWidget:null,_globalColCounter:0,_defaultMenuOptions:{showSearchBoxAfter:30,searchBoxAutoFocus:!0,activateOnMouseOver:!0},_query:null,options:{isSubQuery:!1,activeColumn:null,showAddRow:!0,showHeader:!0,showColumnCaptions:!0,allowAggrColumns:!0,allowDuplicates:!0,allowCustomExpressions:!1,allowSorting:!0,attrElementFormat:"{entity} {attr}",titleElementFormat:null,alwaysShowButtons:!1,accentActiveColumn:!0,menuSearchBoxAfter:30,allowDragDrop:!0,menuOptions:{showSearchBoxAfter:30,searchBoxAutoFocus:!0,activateOnMouseOver:!0,adjustHeight:!0,itemRenderedCallback:null},attrPlacement:0,sortEntities:!1,columnRenderedCallback:null,customExpressionText:0},_create:function(){},getQuery:function(){return this._query},setQuery:function(n){this._setQueryObserver(!0);this._query=n;this._setQueryObserver();this.refresh()},getModel:function(){var n=this.getQuery();return n?n.getModel():null},getColumns:function(){var n=this.getQuery();return n?n.getColumns():null},_getCssPrefix:function(){return""},_customExpressionsPermitted:!0,areCustomExpressionsAllowed:function(){return this.options.allowCustomExpressions&&this._customExpressionsPermitted},_render:function(){var t=this,i,f,r,l,a,e,u,o;if(t._clear(),i=this.getModel(),t._updateLists(),f=this._getCssPrefix(),t.element.addClass(f+"-panel"),i&&!i.isEmpty()){t.options.entitiesList=i.getEntitiesTree({addUIC:!1,addUIR:!0,addUIS:!1,attrPlacement:t.options.attrPlacement,sortEntities:t.options.sortEntities});t.options.entitiesMenu=t._createEntitiesMenu();t.options.sortMenuList=t.options.allowSorting!=!1?[{id:"None",text:EQ.core.getText("CmdNotSorted")},{id:"Ascending",text:EQ.core.getText("CmdAscending")},{id:"Descending",text:EQ.core.getText("CmdDescending")},{id:"---",text:"---"}]:[];t.options.moveMenuList=[{id:"MoveTop",text:EQ.core.getText("CmdMoveToFirst")},{id:"MoveUp",text:EQ.core.getText("CmdMoveToPrev")},{id:"MoveDown",text:EQ.core.getText("CmdMoveToNext")},{id:"MoveBottom",text:EQ.core.getText("CmdMoveToLast")}];Array.prototype.push.apply(t.options.sortMenuList,t.options.moveMenuList);t.options.sortMenu=t._createSortMenu();t.options.moveMenu=t._createSortMenu(!0);var s=0,c=t.getColumns(),h=f+"-header";t.options.showHeader!=!1&&(r=n('<div class="'+h+'"><\/div>').appendTo(this.element),l=n('<div class="'+h+'-expression"><\/div>').text(EQ.core.getText("HeaderExpression")).appendTo(r),t.options.showColumnCaptions&&(a=n('<div class="'+h+'-title"><\/div>').text(EQ.core.getText("HeaderTitle")).appendTo(r)),s+=r.outerHeight()+5,this._headerBlock=r);this._updateHeaderBlock();e=t._refreshByQuery(!0);t.options.showAddRow&&(u=n('<div class="eqjs-addrow '+f+'-addrow"><\/div>'),u.appendTo(this.element),c&&c.length!==0||u.addClass("eqjs-addrow-empty"),o=n('<a href="javascript:void(0)">'+EQ.core.getText("CmdClickToAddColumn")+"<\/a>"),o.appendTo(u),o.click(function(n){n.preventDefault();t.showEntitiesMenu({anchor:o,selectedIds:null,itemSelectedCallback:function(n,r){var u=r.menuItem.id,f=i.getAttributeById(u);return t.addNewColumn(u),!1}},{})}),s+=u.outerHeight()+9);e&&(e.show(),e.css({"max-height":t.element.innerHeight()-s+5+"px"}))}},_updateHeaderBlock:function(){if(this._headerBlock){var n=this.getColumns();n&&n.length>0?this._headerBlock.show():this._headerBlock.hide()}},_updateLists:function(){},_setOption:function(t,i){if(t=="menuOptions")this.options.menuOptions=n.extend({},this._defaultMenuOptions,i);else if(t=="searchBoxAfter")this.options[t]=i,this.options.menuOptions.showSearchBoxAfter=i;else if(t=="query")this.setQuery(i);else return arguments.length==2?(this.options[t]=i,this.refresh(),this):this.options[t]},_setQueryObserver:function(n){var i=this,t=this.getQuery(),r=function(n){n&&n.source!==i&&n.changeType&&n.changeType.indexOf("condition")<0&&i._render()};t&&(n?t.removeChangedCallback(r):t.addChangedCallback(r))},_clear:function(){this.element.html("")},_addColumnElement:function(t,i,r){var f=this,u=n("<div><\/div>"),e=t.find("[class*="+f._getCssPrefix()+"-row]"),o,s;r==0?u.prependTo(t):r>0&&r<e.length?u.insertAfter(e[r-1]):u.appendTo(t);i.blockId||this.trySetBlockId(i);i.blockId&&u.attr("id",i.blockId);o="element.ColumnRow_"+i.expr.typeName+"({columnsPanel: self}); element.ColumnRow_"+i.expr.typeName+"('init', column);";s=new Function("self, element, column",o);s(f,u,i);this.options.columnRenderedCallback&&this.options.columnRenderedCallback(u)},_refreshByQuery:function(t){var i=this,c,v,e;if(this.getQuery()){var u=n("<div><\/div>"),h=n("<div><\/div>"),r=this._getCssPrefix();for(u.addClass(r+"-columns"),u.appendTo(h),h.appendTo(i.element),t&&u.hide(),c=i.getColumns(),v=c.length,e=0;e<v;e++)i._addColumnElement(u,c[e]);var l,o,s=!1,w=!1,y=null,f=!1,a=!1,p=i.getModel();return i.options.allowDragDrop&&(u.sortable({containment:h,tolerance:"pointer",axis:"y",placeholder:"ui-state-highlight eqjs-highlight",scrollSpeed:3,delay:100,distance:13,cursorAt:{top:10},forceHelperSize:!0,handle:"div, a",start:function(n,t){l=t.item.index();t.item.addClass(r+"-column-sort");f=!0},update:function(n,t){if(f=!1,!s&&!t.item.hasClass(r+"-row")){t.item.remove();return}o=t.item.index();w=!1;s?(i.addNewColumn(y,o),t.item.remove(),s=!1):l!=o&&i.getQuery().moveColumn(l,o,i)},over:function(){f=!0},out:function(){f=!1},stop:function(n,t){return f=!1,t.item.removeClass(r+"-column-sort"),!0}}),i.element.droppable({hoverClass:"eqjs-drophover",scope:"entityAttr",drop:function(n,t){a=!1;var r=t.draggable.attr("data-id");if(p.checkAttrProperty(r,"uir"))if(f)s=!0;else{
//!columns || columns.length === 0 || 
i.addNewColumn(r);i.refresh()}},over:function(n,t){a=!0;t.helper.addClass(r+"-column-drag");var i=t.draggable.attr("data-id");p.checkAttrProperty(i,"uir")||t.helper.addClass(r+"-column-drag-forbidden")},out:function(n,t){a=!1;t.helper.removeClass(r+"-column-drag");t.helper.removeClass(r+"-column-drag-forbidden")},activate:function(n,t){y=t.draggable.attr("data-id")}})),u}},clearColumns:function(n){var t=this.getQuery();t&&(t.clearColumns(),n!==!1&&this.refresh())},_createEntitiesMenu:function(){var u=this.getModel(),r;if(!u||u.isEmpty())return null;var t=this,f=n("<div><\/div>").hide().appendTo(this.element),i=t.element.attr("id");return i&&(i+="-EntitiesMenu"),r={items:this.options.entitiesList,adjustHeight:t.options.adjustEntitiesMenuHeight,id:i,domWriteItemsId:t.options.domWriteItemsId},n.extend(r,t.options.menuOptions),f.PopupMenu(r),f},showEntitiesMenu:function(n){var t=this;t.options.entitiesMenu.PopupMenu("showMenu",n)},_createSortMenu:function(t){var u=this.getModel(),o,r;if(!u||u.isEmpty())return null;var f=n("<div><\/div>").hide().appendTo(this.element),e=this,i=e.element.attr("id");return i&&(i+="-SortMenu"),o=t?this.options.moveMenuList:this.options.sortMenuList,r={items:o,id:i,domWriteItemsId:this.options.domWriteItemsId},n.extend(r,e.options.menuOptions),f.PopupMenu(r),f},_fireColumnChange:function(n,t){var i=this;t=t||i._column;this.getQuery().fireChangedEvent({source:i,changeType:"column."+n,column:t},!0)},_getDefaultColumnCaption:function(n){var t=this.options.titleElementFormat||this.options.attrElementFormat,i=this.getModel();return i.getAttributeText(n,t)},addNewColumn:function(t,i){var e=this,o=this.getModel(),s=function(t){var i=o.getAttributeById(t);if(!i)return null;if(!i.uir)if(i.lookupAttr){if(t=i.lookupAttr,i=o.getAttributeById(t),!i||!i.uir)return null}else return null;return{caption:e._getDefaultColumnCaption(i),sorting:"None",sortIndex:-1,expr:{typeName:"ENTATTR",id:t},params:n.extend([],i.params)}},r,f,h,u;if(this.getQuery()){if(n.isArray(t))for(r=[],h=t.length,u=0;u<h;u++)f=s(t[u]),f&&r.push(f);else r=s(t);return e.addColumn(r,i),r}},_checkColumn:function(n){var t,r;if(!this.options.allowDuplicates){var u=this.getQuery(),i=u.getColumns(),f=i.length,e=JSON.stringify(n.expr);for(t=0;t<f;t++)if(r=JSON.stringify(i[t].expr),r===e)return null}return n},_checkColumnsArray:function(n){for(var t=0,r=n.length,i=[];t<r;t++)this._checkColumn(n[t])&&i.push(n[t]);return i},addColumn:function(t,i){var r=this,e=this.getQuery(),f,u;if(e&&(t=n.isArray(t)?this._checkColumnsArray(t):this._checkColumn(t),t&&(!n.isArray(t)||t.length!=0)))if(e.addColumn(t,i,r),f=r.element.find("[class*="+r._getCssPrefix()+"-columns]"),f.length>0){if(t.length)for(u=0;u<t.length;++u)r._addColumnElement(f,t[u],i+u);else r._addColumnElement(f,t,i);this._updateHeaderBlock()}else r.refresh()},trySetBlockId:function(n){var t=this.getNewColId();t&&(n.blockId=t)},removeColumn:function(n){var r=this,i=this.getQuery(),t;if(i&&n)if(n.length){for(t=0;t<n.length;++t)r._removeColumnElement(n[t]);i.removeColumns(n,this)}else r._removeColumnElement(n),i.removeColumn(n,this)},_removeColumnElement:function(t){var r=this._getCssPrefix(),u=this.getQuery(),f=u.getColumns(),e=n.inArray(t,f),i;e>=0&&(i=this.element.find("[class*="+r+"-row]").filter(function(){return this.column==t}),i&&(i.detach(),i.remove()))},removeColumnByAttrId:function(t){var s=this,e,r,f;if(e=n.isArray(t)?function(n){for(var r=t.length,i=0;i<r;i++)if(t[i]==n)return!0;return!1}:function(n){return t==n},r=this.getQuery(),r){for(var o=[],i=0,u=r.getColumns(),h=u.length;i<h;)f=u[i],f.expr.typeName=="ENTATTR"&&e(f.expr.id)&&o.push(u[i]),i++;s.removeColumn(o)}},_moveColumn:function(t,i){var r=this,o=this.getQuery();if(o){var e=r.element.find("[class*="+r._getCssPrefix()+"-columns]"),u=e.find("[class*="+r._getCssPrefix()+"-row]"),f=n(u[t]);i==0?f.prependTo(e):i>0&&i<u.length-1?t<i?f.insertAfter(u[i]):f.insertAfter(u[i-1]):f.appendTo(e);o.moveColumn(t,i,r)}},moveColumn:function(t,i){var u=this,e=this.getQuery(),f=e.getColumns(),r=n.inArray(t,f);if(r>=0)switch(i){case"MoveTop":if(r==0)return;u._moveColumn(r,0);break;case"MoveUp":if(r==0)return;u._moveColumn(r,r-1);break;case"MoveDown":if(r==f.length-1)return;u._moveColumn(r,r+1);break;case"MoveBottom":if(r==f.length-1)return;u._moveColumn(r,f.length-1)}},refresh:function(){this._render()},resize:function(){this._render()},setActiveColumnWidget:function(n){this._activeColumnWidget&&(this._activeColumnWidget.internalDeactivate(),this.options.activeColumn=null);this._activeColumnWidget=n;this._activeColumnWidget&&(this._activeColumnWidget.internalActivate(),this.options.activeColumn=this._activeColumnWidget.getColumn())},getNewColId:function(){if(this.element.attr("id"))return this.element.attr("id")+"-col-"+ ++this._globalColCounter}});n.widget("eqjs.ColumnsPanel",n.eqjs.ColumnsContainer,{_getCssPrefix:function(){return"eqjs-qc"}});n.widget("eqjs.ColumnsBar",n.eqjs.ColumnsContainer,{_create:function(){this.options.allowDragDrop=!1;this.options.showHeader=!1;this.options.accentActiveColumn=!1},_getCssPrefix:function(){return"eqjs-cb"},_customExpressionsPermitted:!1});n.widget("eqjs.SortingBar",n.eqjs.ColumnsContainer,{_create:function(){this.options.allowDragDrop=!1;this.options.showHeader=!1;this.options.accentActiveColumn=!1},moveColumn:function(t,i){var f=this,e=this.getQuery(),u=e.getSortedColumns(),r=n.inArray(t,u);if(r>=0){switch(i){case"MoveTop":if(r==0)return;EQ.core.moveArrayItem(u,r,0);break;case"MoveUp":if(r==0)return;EQ.core.moveArrayItem(u,r,r-1);break;case"MoveDown":if(r==u.length-1)return;f._moveColumn(r,r+1);EQ.core.moveArrayItem(u,r,r+1);break;case"MoveBottom":if(r==u.length-1)return;EQ.core.moveArrayItem(u,r,u.length-1)}u.forEach(function(n,t){n.sortIndex=t});e.fireChangedEvent("query.column.sorting");f.refresh()}},getColumns:function(){var n=this.getQuery();return n.getSortedColumns()},_getCssPrefix:function(){return"eqjs-srtb"},_customExpressionsPermitted:!1})}(jQuery),function(n){n.widget("eqjs.EntitiesPanel",{_rootEntityBlock:null,_entityTreeBlock:null,_query:null,_progressBlock:null,options:{queryPanelId:"QueryPanel",columnsPanelId:"ColumnsPanel",showToolbar:!0,showSelectAllButton:!1,showClearSelectionButton:!0,showAddColumnButton:!0,showAddConditionButton:!0,showCheckboxes:!0,showTooltips:!0,clickableAttributes:0,draggableAttributes:!0,showAttributes:{usedInConditions:!0,usedInColumns:!0,usedInSorting:!1},showFilterBox:!1,filterBoxMode:0,showIndicatorOnLoad:!0,attrPlacement:0,sortEntities:!1,autoClearSelection:!0,syncWithColumns:!1,entityRenderedCallback:null,attributeRenderedCallback:null},getSelf:function(){return this},getModel:function(){var n=this.getQuery();return n?n.getModel():null},getQuery:function(){return this._query},setQuery:function(n){this._setQueryObserver(!0);this._query=n;this._setQueryObserver();this.refresh()},_setQueryObserver:function(n){var t=this,i=this.getQuery(),r=function(n){t.options.syncWithColumns&&n&&n.source!==t&&n.changeType&&n.changeType.indexOf("condition")<0&&t.refreshCheckedStateByColumns()};i&&(n?i.removeChangedCallback(r):i.addChangedCallback(r))},refreshCheckedStateByColumns:function(){var n=this,t,h=n.getQuery(),f=h.getColumns(),c=f.length,i=0,r,e,o,u,s;for(n._deselectAll();i<c;i++)r=f[i],r.expr.typeName=="ENTATTR"&&(t=n._rootEntityBlock.find('.eqjs-ep-entity-attr[data-id="'+r.expr.id+'"]'),e=t.find("input"),e.prop("checked",!0),u=t.parent(),u.show(),o=u.prev(),s=o.find("input"),s.prop("checked",!0))},_create:function(){var n=this},_renderProgressBlock:function(){this._progressBlock=n('<div class="eqjs-progress-win8"><div class="wBall" id="wBall_1"><div class="wInnerBall"><\/div><\/div><div class="wBall" id="wBall_2"><div class="wInnerBall"><\/div><\/div><div class="wBall" id="wBall_3"><div class="wInnerBall"><\/div><\/div><div class="wBall" id="wBall_4"><div class="wInnerBall"><\/div><\/div><div class="wBall" id="wBall_5"><div class="wInnerBall"><\/div><\/div><\/div>')},_render:function(){var t=this,i,r;this._clear();i=this.getModel();this.element.addClass("eqjs-ep-panel");i==null||i.isEmpty()||(this._rootEntityBlock=n("<div><\/div>"),r=i.getEntitiesTree({addUIC:t.options.showAttributes.usedInConditions,addUIR:t.options.showAttributes.usedInColumns,addUIS:t.options.showAttributes.usedInSorting,attrPlacement:t.options.attrPlacement,sortEntities:t.options.sortEntities,includeRootData:!0}),this._entityTreeBlock=this.element.append(this._renderEntity(r,this._rootEntityBlock,0)));this.options.showFilterBox?this._createFilterBox():this._rootEntityBlock.css("top","0");this.options.showToolbar&&!this.options.syncWithColumns?this._createToolPanel():this._rootEntityBlock.css("bottom","0");this._renderProgressBlock()},_renderEntity:function(t,i,r){var u=this,f="eqjs-ep-entity",s,l=n("<div><\/div>",{"class":f+"-node"}),e=n("<div><\/div>",{"class":f+"-children"}),p=n("<label><\/label>",{"class":f+"-node-label"}),a=n("<input />",{type:"checkbox"}),k=n("<a><\/a>",{href:"javascript:void(0)","class":f+"-node-button"}),h,v,w,nt=n("<div><\/div>"),y=r,d=function(n,t){var i=t.find("."+f+'-attr[data-id="'+n+'"]');return i.length>0},g,c,o,b;if(i?(s=i,s.html("").addClass(f)):s=n("<div><\/div>",{"class":f}),t.id&&t.id!=""){for(p.text(t.text).appendTo(l),u.options.showCheckboxes&&p.prepend(a),k.prependTo(l),u.options.showTooltips&&t.description&&p.attr("title",t.description),c=0;c<y;c++)l.prepend(n("<div><\/div>",{"class":f+"-offset"}));s.append(l);e.hide();y++}for(g=t.items?t.items.length:0,c=0;c<g;c++)if(o=t.items[c],o.isEntity)e.append(u._renderEntity(o,null,y));else if(!o.lookupAttr||!(d(o.lookupAttr,e)||d(o.lookupAttr,this._rootEntityBlock))){for(v=n("<label><\/label>",{text:o.text,"class":f+"-attr-label"}),u.options.showCheckboxes&&(w=n("<input />",{type:"checkbox"}),v.prepend(w),w.change(function(){if(u.options.syncWithColumns){var t=n("#"+u.options.columnsPanelId),r=n(this).prop("checked"),f=n(this).parent().parent(),i=f.data("id");r?t.ColumnsPanel("addNewColumn",i):t.ColumnsPanel("removeColumnByAttrId",i)}})),u.options.showTooltips&&o.description&&v.attr("title",o.description),b=0;b<y+1;b++)v.prepend(n("<div><\/div>",{"class":f+"-offset"}));h=n("<div><\/div>").attr("class",function(){var n=f+"-attr ";return l.html().length==0&&(n+=f+"-attr-root"),n}).html(v).attr("data-id",o.id);u.options.draggableAttributes&&(h.addClass("draggable"),h.draggable({containment:"document",cursor:"move",helper:"clone",revert:"invalid",scope:"entityAttr",distance:20,connectToSortable:".ui-sortable",cursorAt:{bottom:20,left:10},start:function(n,t){t.helper.find("input").hide();var i=t.helper.find("label");i.css("max-width","400px").css("overflow","hidden").css("text-overflow","ellipsis")},appendTo:"body"}));u.options.clickableAttributes==1?h.click(function(){var t=n("#"+u.options.queryPanelId);t.QueryPanel("addNewConditionIntoActivePredicate",n(this).data("id"))}):u.options.clickableAttributes==2&&h.click(function(){var t=n("#"+u.options.columnsPanelId);t.ColumnsPanel("addNewColumn",n(this).data("id"))});this.options.attributeRenderedCallback&&this.options.attributeRenderedCallback(h);e.append(h)}return e.html().length&&(s.append(e),k.click(function(t){e.toggle();n(this).toggleClass(f+"-node-button-open");t.preventDefault()})),e&&e.find("> .eqjs-ep-entity-attr > label > input").click(function(t){n(this).prop("checked")&&!a.prop("checked")?a.prop("checked",!0):e.find("input:checked").length==0&&a.prop("checked",!1);t.stopPropagation()}),a.click(function(t){var f=n(this).prop("checked"),i,o,r;f?e.find("label input").prop("checked",!0):e.find("label input").prop("checked",!1);u.options.syncWithColumns&&(i=[],o=e.find("div.eqjs-ep-entity-attr"),o.each(function(){i.push(n(this).data("id"))}),r=n("#"+u.options.columnsPanelId),f?r.ColumnsPanel("addNewColumn",i):r.ColumnsPanel("removeColumnByAttrId",i));t.stopPropagation()}),i!=this._rootEntityBlock&&this.options.entityRenderedCallback&&this.options.entityRenderedCallback(s),s},expandAll:function(){this._rootEntityBlock.children().find(".eqjs-ep-entity-children").show();this._rootEntityBlock.find(".eqjs-ep-entity-node-button").addClass("eqjs-ep-entity-node-button-open")},collapseAll:function(){this._rootEntityBlock.children().find(".eqjs-ep-entity-children").hide();this._rootEntityBlock.find(".eqjs-ep-entity-node-button").removeClass("eqjs-ep-entity-node-button-open")},_checkFilterText:function(n){var t=this.filterBoxInput.val();return t==""?!0:this.options.filterBoxMode==0&&n.toLowerCase().indexOf(t.toLowerCase())>=0?!0:this.options.filterBoxMode==1&&n.toLowerCase().indexOf(t.toLowerCase())==0?!0:!1},_checkFilterAttribute:function(t){var f=n(t).find("label input").prop("checked"),i,r,u;return f?!0:(i=n(t).find("label").text(),this._checkFilterText(i))?!0:(r=n(t).parent().parent().find(".eqjs-ep-entity-node"),u=r.find("label").text(),this._checkFilterText(u))?!0:!1},_createFilterBox:function(){var t=this,i="eqjs-ep-filter-box";t.filterBoxBlock=n("<div><\/div>",{"class":i});t.filterBoxInput=n("<input><\/input>",{"class":i+"-input"});t.filterBoxInput.keydown(function(n){if(n.keyCode==27)return t.filterBoxInput.val(""),t.filterBoxInput.trigger("input",null),n.stopPropagation(),!1});t.filterBoxInput.on("input",function(){var i=t.element.find(".eqjs-ep-entity-attr"),r;n.each(i,function(i,r){t._checkFilterAttribute(r)?n(r).show():n(r).hide()});r=t.element.find(">.eqjs-ep-entity").find(".eqjs-ep-entity");n.each(r,function(t,r){i=n(r).find(".eqjs-ep-entity-attr").filter(function(t,i){return n(i).css("display")!=="none"});i.length==0?n(r).hide():n(r).show()});t.filterBoxInput.val()==""?t.collapseAll():t.expandAll()});t.filterBoxBlock.append(t.filterBoxInput);t.element.prepend(t.filterBoxBlock)},_createToolPanel:function(){var t=this,i="eqjs-ep-tool-panel",h=n("<div><\/div>",{"class":i}),r=n("<div><\/div>",{"class":i+"-select-all",title:"Select all"}),u=n("<div><\/div>",{"class":i+"-deselect-all",title:"Clear selection"}),f=n("<div><\/div>",{"class":i+"-add-columns",title:"Add column"}),e=n("<div><\/div>",{"class":i+"-add-cond",title:"Add condition"}),o=n("<div><\/div>",{"class":i+"-left-side"}),s=n("<div><\/div>",{"class":i+"-right-side"}),c=t.getModel();this.options.showSelectAllButton&&(r.attr("title",EQ.core.getText("ButtonSelectAll")),o.append(r),r.click(function(){t._selectAll()}));this.options.showClearSelectionButton&&(u.attr("title",EQ.core.getText("ButtonDeselectAll")),o.append(u),u.click(function(){t._deselectAll()}));this.options.showAddColumnButton&&(f.attr("title",EQ.core.getText("ButtonAddColumns")),s.append(f),f.click(function(){var e=t.element.find(".eqjs-ep-entity-attr"),r=[],i,u=t.getQuery(),f;u.fireProcessEvent({source:t,status:"start"});n.each(e,function(t,u){u=n(u);var f=u.find("input").first();f.prop("checked")&&(i=u.data("id"),c.checkAttrProperty(i,"uir")&&r.push(i))});f=n("#"+t.options.columnsPanelId);f.ColumnsPanel("addNewColumn",r);t.options.autoClearSelection&&t._deselectAll();u.fireProcessEvent({source:t,status:"finish"})}));this.options.showAddConditionButton&&(e.attr("title",EQ.core.getText("ButtonAddConditions")),s.append(e),e.click(function(){var e=t.element.find(".eqjs-ep-entity-attr"),r=[],i,u=t.getQuery(),f;u.fireProcessEvent({source:t,status:"start"});n.each(e,function(t,u){u=n(u);var f=u.find("input").first();f.prop("checked")&&(i=u.data("id"),c.checkAttrProperty(i,"uic")&&r.push(i))});f=n("#"+t.options.queryPanelId);f.QueryPanel("addNewCondition",r);t.options.autoClearSelection&&t._deselectAll();u.fireProcessEvent({source:t,status:"finish"})}));h.append(o,s);this.element.append(h)},_selectAll:function(){this._entityTreeBlock.find("input").prop("checked",!0)},_deselectAll:function(){this._entityTreeBlock.find("input").prop("checked",!1)},_setOption:function(n,t){return arguments.length==2?(this.options[n]=t,this._render(),this):this.options[n]},_clear:function(){this.element.html("")},refresh:function(){this._render();this.options.syncWithColumns&&this.refreshCheckedStateByColumns()},resize:function(){this._render()},startLoading:function(){this.options.showIndicatorOnLoad&&this.element.append(this._progressBlock)},finishLoading:function(){this.options.showIndicatorOnLoad&&this.element.find(this._progressBlock).remove()}})}(jQuery),function(n){var f=function(n,t,i){if(t!==i){var r=n[t];n[t]=n[i];n[i]=r;delete r}},u;n.widget("eqjs.ColumnsBarOld",{_query:null,_activeColumn:null,_activeColumnIndex:null,_contentBlockClass:"eqjs-cb-inner-wrapper",_colsBlockClass:"eqjs-cb-inner",_width:0,_leftBtn:null,_rightBtn:null,_uiUpdaterId:null,options:{showAddButton:!0,addButtonSide:"left",addButtonHTML:"+",innerPaddingCompensation:{right:38,left:35},allowAggrColumns:!0,allowSorting:!0,sortByList:["None","Ascending","Descending"],placeholderHeight:22,adjustEntitiesMenuHeight:!0,attrElementFormat:"{entity} {attr}",alwaysShowButtons:!1,accentActiveColumn:!0,uiUpdateInterval:200,scrollSpeed:15,showScrollBar:!0,scrollButtonsScrollBy:500,scrollButtonsLeftHTML:"&lt; ...",scrollButtonsRightHTML:"... &gt;"},_setOption:function(n,t){if(n=="query")this.setQuery(t);else return arguments.length==2?(this.options[n]=t,this._render(),this):this.options[n]},_create:function(){this._render()},_clear:function(){this.element.html("")},getModel:function(){var n=this.getQuery();return n?n.getModel():null},getQuery:function(){return this._query},setQuery:function(n){this._query=n;this.refresh()},init:function(n){this.setQuery(n)},refresh:function(){this._render()},resize:function(){this._render()},_render:function(){if(this._clear(),this.getModel()){this.options.entitiesList=this.getModel().getEntitiesTree({addUIC:!1,addUIR:!0,addUIS:!1});this.options.entitiesMenu=this._createEntitiesMenu();this._refreshByQuery();var n="eqjs-cb-with-add-button-on-";this.element.removeClass(n+"left").removeClass(n+"right");this.options.showAddButton&&(this.element.addClass(n+this.options.addButtonSide),this._showAddButton())}},_refreshByQuery:function(){var e,c,l,s,o;if(this.getQuery()){var t=this,r=n("<div><\/div>").addClass(t._colsBlockClass),i=n("<div><\/div>").addClass(t._contentBlockClass),h=t.getQuery(),u=h?h.getColumns():null,a=function(n,t){var r=u[colIdx],i=t["ColumnsBarColumn_"+r.expr.typeName];return i.call(t,{columnsBar:n,query:n.getQuery()}),i.call(t,"init",r),{wfn:i,element:t}},v=typeof t._activeColumnIndex=="number";for(colIdx in u)e=a(t,n("<div><\/div>").appendTo(r),colIdx),v&&+colIdx===t._activeColumnIndex&&(e.wfn.call(e.element,"setActiveColumn"),e.element.click());c=r.children("div");r.appendTo(i);i.appendTo(t.element);t.options.showScrollBar?(i.css("overflow-x","auto"),t._leftBtn=null,t._rightBtn=null):(i.css("overflow-x","hidden"),t._leftBtn=t._makeScrollButton({html:t.options.scrollButtonsLeftHTML,t:"left",otherT:"right",scrollLeft:"-="+t.options.scrollButtonsScrollBy}),t._rightBtn=t._makeScrollButton({html:t.options.scrollButtonsRightHTML,t:"right",otherT:"left",scrollLeft:"+="+t.options.scrollButtonsScrollBy}),t.element.prepend(t._leftBtn.hide()),t.element.prepend(t._rightBtn.hide()));t._uiUpdaterId&&clearInterval(t._uiUpdaterId);t._uiUpdaterId=window.setInterval(function(){var r=2,i=r;c.each(function(){i+=n(this).outerWidth(!0)});i>r&&i!==t._width&&(t._width=i,t.element.find("."+t._colsBlockClass).css({width:i}));t._leftBtn&&t._rightBtn&&(t._updateScrollButtonVisibility(t._leftBtn,"left"),t._updateScrollButtonVisibility(t._rightBtn,"right"))},t.options.uiUpdateInterval);o=!1;r.sortable({cursor:"move",tolerance:"pointer",cancel:".eqjs-cb-column-buttonsBlock, .eqjs-cb-colelement, .eqjs-cb-sortbutton, .eqjs-ce-editbox",placeholder:"eqjs-cb-column-placeholder",forcePlaceholderSize:!0,scroll:!0,scrollSpeed:this.options.scrollSpeed,delay:100,distance:13,forceHelperSize:!0,start:function(n,i){l=i.item.index();i.item.addClass("eqjs-cb-column-sort");i.placeholder.height(t.options.placeholderHeight)},update:function(n,i){s=i.item.index();o?(o=!1,u.splice(s,0,u.pop()),t.refresh()):f(u,l,s)},stop:function(n,i){i.item.removeClass("eqjs-cb-column-sort");i.item.click();t._fireQueryChange("change")}});t.element.droppable({tolerance:"touch",hoverClass:"eqjs-drophover",scope:"entityAttr",drop:function(n,i){t.addNewColumn(i.draggable.attr("data-id"));o=!0},over:function(n,t){t.helper.addClass("eqjs-cb-column-drag")},out:function(n,t){t.helper.removeClass("eqjs-cb-column-drag")}});r.children().length?i.show():i.hide()}},_makeScrollButton:function(t){var r=this,u=t.t,e=t.otherT,f=function(n){return"eqjs-cb-button-"+n},i=n("<span><\/span>").addClass(f(u)).html(t.html);return i.click(function(){n(this).parent().find("."+r._contentBlockClass).animate({scrollLeft:t.scrollLeft})}),i},_updateScrollButtonVisibility:function(n,t){var f=n.parent().find("."+this._contentBlockClass),i=f.scrollLeft(),r=f.innerWidth(),u=this._width,e;if(this.options.showAddButton&&(u+=this.options.innerPaddingCompensation[this.options.addButtonSide]),r>=u||!r||i===null)return n.hide();e={left:function(){return i},right:function(){return u-(r+i)}}[t]();e<=0?n.hide():n.show()},_showAddButton:function(){var r=this.options.addButtonSide,u=n('<div class="eqjs-cb-add-button"><\/div>'),i,t;u.prependTo(this.element).css(r,this.element.css("padding-"+r));i=n('<a href="javascript:void(0)"><\/a>').html(this.options.addButtonHTML).appendTo(u);t=this;i.click(function(){t.showEntitiesMenu({anchor:i,selectedIds:null,itemSelectedCallback:function(n,i){var r=i.menuItem.id,u=t.getModel().getAttributeById(r);return t.addNewColumn(r),!1}})})},showEntitiesMenu:function(n){var t=this;t.options.entitiesMenu.PopupMenu("showMenu",n)},clearColumns:function(n){this.getQuery().clearColumns();n!==!1&&this.refresh()},_createEntitiesMenu:function(){if(!this.getModel())return null;var t=n("<div><\/div>").hide().appendTo(this.element);return t.PopupMenu({items:this.options.entitiesList,adjustHeight:this.options.adjustEntitiesMenuHeight}),t},_fireQueryChange:function(n){var t=this;this.getQuery().fireChangedEvent({source:t,changeType:"query."+n},!0)},_fireColumnChange:function(n,t){var i=this;t=t||i._column;this.getQuery().fireChangedEvent({source:i,changeType:"column."+n,column:t},!0)},addNewColumn:function(t,i){var u=this,o=function(n){var t=u.getModel().getAttributeById(n);if(!t)return null;if(!t.uir)if(t.lookupAttr){if(n=t.lookupAttr,t=u.getModel().getAttributeById(n),!t||!t.uir)return null}else return null;return{caption:"",sorting:"None",sortIndex:-1,expr:{typeName:"ENTATTR",id:n}}},r,e,f;if(u.getQuery()){if(n.isArray(t))for(r=[],f=0;f<t.length;f++)e=o(t[f]),e&&r.push(e);else r=o(t);return u.addColumn(r,i),r}},addColumn:function(t,i){var u=this,f=this.getQuery(),r;f&&(r=f.getColumns(),t&&(!n.isArray(t)||t.length!=0))&&(typeof i=="number"?r.splice.apply(r,[i,0].concat(t)):r.push.apply(r,[].concat(t)),u._width+=u._initialWidth*4,u.refresh(),u._fireColumnChange("add",t))},removeColumn:function(t){var i=this,f=this.getQuery(),u,r;f&&(u=f.getColumns(),r=n.inArray(t,u),r>=0&&(r===i._activeColumnIndex&&(i._activeColumnIndex=null),u.splice(r,1),i.refresh(),i._fireColumnChange("remove",t)))},removeColumnByAttrId:function(n){var u=this,f=this.getQuery(),i;if(f){for(var r=f.getColumns(),t=0,e=r.length;t<e;){if(i=r[t],i.expr.typeName=="ENTATTR"&&i.expr.id==n)break;t++}t<e&&(r.splice(t,1),u._fireColumnChange("remove",i),u.refresh())}},setActiveColumn:function(n){this._activeColumn&&this._activeColumn.deactivate();this._activeColumn=n;this._activeColumn&&this._activeColumn.activate()},getActiveColumn:function(){return this._activeColumn},setActiveColumnIndex:function(n){this._activeColumnIndex=n}});var t=function(n,t,i){var e=n.self.options.columnsBar._query.getColumns(),r,u;if(e.length&&(f(e,t,i),r=n.self.options.columnsBar.getActiveColumn(),r&&r._active&&r.element.length)){if(u=r.element.index(),u===t)return i;if(u===i)return t}},i=function(n,t){var i=t.parent().parent().parent();typeof n!="undefined"&&i.ColumnsBar("setActiveColumnIndex",n);i.ColumnsBar("refresh")},r=[{id:"|<-",text:EQ.core.getText("CmdMoveToStart"),fn:function(n){i(t(n,0,n.self.element.index()),n.self.element)}},{id:"->",text:EQ.core.getText("CmdMoveRight"),fn:function(n){var r=n.self.element,u=r.next();u.length&&i(t(n,u.index(),r.index()),r)}},{id:"<-",text:EQ.core.getText("CmdMoveLeft"),fn:function(n){var r=n.self.element,u=r.prev();u.length&&i(t(n,u.index(),r.index()),r)}},{id:"->|",text:EQ.core.getText("CmdMoveToEnd"),fn:function(n){var r=n.self.element,u=r.parent().children().last();u.length&&i(t(n,u.index(),r.index()),r)}}],e=function(n,t){var i=n.indexOf(t)+1;return i==n.length?n[0]:n[i]};n.widget("eqjs.ColumnsBarColumn",{_column:null,_sortingButton:null,_buttonsBlock:null,_menuButton:null,_menuButtonMenu:null,_deleteButton:null,_keepShowingButtons:!1,_isMouseOverBlock:!1,_classesToAdd:"",_active:!1,options:{columnsBar:null,query:null},getQuery:function(){return this.options.columnsBar.getQuery()},getModel:function(){var n=this.getQuery();return n?n.getModel():null},init:function(n){this._column=n;this.refresh()},_render:function(){this._clear();this.getModel()&&this._column&&(this._refreshByColumn(),this._initButtons())},_fireColumnChange:function(n,t){var r=this,i;(t=t||r._column,i=this.qetQuery(),i)&&i.fire({query:r.options.columnsBar.options.query,changeType:"column."+n,condition:t})},refresh:function(){this._render()},_setOption:function(n,t){return arguments.length==2?(this.options[n]=t,n==="disabled"&&(this._column.enabled=!t),this._render(),this):n==="disabled"?this._column.enabled===!1:this.options[n]},_clear:function(){this.element.unbind();this.element.html("");this.element.removeClass()},_refreshByColumn:function(){},remove:function(){var n=this;n.options.columnsBar&&(n.options.columnsBar.removeColumn(n._column),n._fireColumnChange("delete"))},_initMenu:function(){var i=this._getMenuButtonMenuItems(),r=function(n,t,i){for(var u,o,f=0,e=n.length;f<e;f++)if(u=n[f],u.items){if(o=r(u.items,t,i),o)return!0}else if(t==u.id)return u.fn&&u.fn(i),!0;return!1},t;this._menuButtonMenu=n("<div><\/div>").hide().appendTo(this.element);this._menuButtonMenu.PopupMenu({items:i});t=this;t._menuButton.click(function(){t._menuButtonMenu.PopupMenu("showMenu",{anchor:t._menuButton,selectedIds:null,itemSelectedCallback:function(n,u){return r(i,u.menuItem.id,{self:t,evt:n,data:u}),!1},menuClosedCallback:function(){t._isMouseOverBlock||t._menuButtonMenu.trigger("mouseleave")}})})},_initButtons:function(){var t=this,i=t.element;i&&(t._buttonsBlock=n("<span><\/span>").addClass("eqjs-cb-column-buttonsBlock").appendTo(i),t._menuButton=n("<span><\/span>").addClass("eqjs-cb-column-button-menu").attr("title",EQ.core.getText("ButtonMenu")).appendTo(t._buttonsBlock),t._initMenu(),t._deleteButton=n("<span><\/span>").addClass("eqjs-cb-column-button-delete").attr("title",EQ.core.getText("ButtonDelete")).appendTo(t._buttonsBlock).click(function(){t.remove()}),t._sortingButton=n("<span><\/span>").addClass("eqjs-colelement eqjs-cb-button-sort").prependTo(t.element),t.options.columnsBar.options.allowSorting!=!1&&(t._sortingButton.attr("title",EQ.core.getText("ButtonSorting")).click(function(){t._column.sorting=e(t.options.columnsBar.options.sortByList,t._column.sorting);t.refresh();t._fireColumnChange("change")}),t._column.sorting==="None"&&t._sortingButton.addClass("eqjs-cb-column-button-sort-none"),t._sortingButton.hover(function(){n(this).addClass("eqjs-cb-column-button-sort-active")},function(){n(this).removeClass("eqjs-cb-column-button-sort-active")})),t._column.sorting==="Ascending"?t._sortingButton.addClass("eqjs-cb-column-button-sort-asc").attr("title",EQ.core.getText("ButtonSorting")):t._column.sorting==="Descending"&&t._sortingButton.addClass("eqjs-cb-column-button-sort-desc").attr("title",EQ.core.getText("ButtonSorting")),i.find("[class*=eqjs-column-button]").hover(function(){n(this).addClass("eqjs-cb-column-button-sort-active")},function(){n(this).removeClass("eqjs-cb-column-button-sort-active")}),i.bind("mouseenter",function(n){return t._isMouseOverBlock=!0,t._enterButtonBlock(),n.stopPropagation(),!1}).bind("mouseleave",function(n){return t._isMouseOverBlock=!1,t._keepShowingButtons||t._leaveButtonBlock(),n.stopPropagation(),!1}),t._hideButtons(),t._adjustButtonsVisibility())},_adjustButtonsVisibility:function(){(this.options.columnsBar.options.alwaysShowButtons||this.options.columnsBar.options.accentActiveColumn&&this._active)&&this._showButtons()},_enterButtonBlock:function(){this._showButtons()},_leaveButtonBlock:function(){this.options.columnsBar.options.alwaysShowButtons==!0||this._active&&this.options.columnsBar.options.accentActiveColumn==!0||this._hideButtons()},_showButtons:function(){var n=function(n){n.css("visibility","visible")};n(this._deleteButton);n(this._menuButton);this.options.columnsBar.options.allowSorting!=!1&&n(this._sortingButton)},_hideButtons:function(){var n=function(n){n.css("visibility","hidden")};n(this._deleteButton);n(this._menuButton);this._column.sorting==="None"&&n(this._sortingButton)},activate:function(){this._active=!0;this.adjustActiveClass();this._hideButtons();this._adjustButtonsVisibility()},deactivate:function(){this._active=!1;this.adjustActiveClass();this._hideButtons();this._adjustButtonsVisibility()},adjustActiveClass:function(){this._active?this.element.addClass("active"):this.element.removeClass("active")},isActive:function(){return this._active},setActiveColumn:function(){this.options.columnsBar.setActiveColumn(this)}});u=function(n){return[{id:"sep",text:"-------"}].concat(n)};n.widget("eqjs.ColumnsBarColumn_ENTATTR",n.eqjs.ColumnsBarColumn,{_classesToAdd:"eqjs-cb-column eqjs-cb-column-entattr",_baseAttr:null,_menuFunctionsBlock:null,_getMenuButtonMenuItems:function(){if(!this.options.columnsBar.options.allowAggrColumns)return r;var t=this._createFunctionMenuItems(function(n){n.self._changeTypeToAggr(n.data.menuItem.id)}),n=r;return t&&(n=u(n)),t.concat(n)},_fillBaseBlock:function(n){n.addClass("eqjs-expr-block");this._baseAttr=this._getAttribute();this._column.caption||(this._column.caption=this._getDefaultCaption())},_refreshByColumn:function(){var t,r,i,u;this._column&&this.getModel()&&(t=this,t.element.addClass(t._classesToAdd),r=n("<span><\/span>").appendTo(t.element),t._fillBaseBlock(r),t.options.columnsBar.options.accentActiveColumn&&t.element.click(function(){t._active||t.setActiveColumn()}),t._column.caption&&t._column.caption!=""||(t._column.caption=t._getDefaultCaption()),i=n("<span><\/span>"),i.appendTo(this.element),u=function(){t._fireColumnChange("change")},i.ColumnsBarColumn_CaptionEditor(),i.ColumnsBarColumn_CaptionEditor("init",t._column,t._getDefaultCaption(),u),t.adjustActiveClass())},_getDefaultCaption:function(){return this._getAttributeText(this._baseAttr)},_getAttribute:function(){return this.getModel().getAttributeById(this._column.expr.id)},_getAttributeText:function(n){var i=this,t,r,u,f;return n?(t=EQ.core.getText("Attributes",n.id),t||(t=n.caption),!i.options.columnsBar)?t:(r=i.options.columnsBar.options.attrElementFormat,!r)?t:(u=r.replace(new RegExp("{attr}","g"),t),f=i.getModel().getFullEntityPathByAttr(n.id,"."),u.replace(new RegExp("{entity}","g"),f)):""},_changeTypeToAggr:function(n){var t=this,i,r,u;n||(n=t._menuFunctionsBlock.PopupMenu("option","items")[0].id);i=t._column.expr.id;t._column.expr={func:n,distinct:!1,typeName:"AGGRFUNC",argument:{typeName:"ENTATTR",id:i}};r=t._column;u=t._active;t.destroy();t._clear();t.element.ColumnsBarColumn_AGGRFUNC({columnsBar:t.options.columnsBar,model:t.getModel()});t.element.ColumnsBarColumn_AGGRFUNC("init",r);t._fireColumnChange("change");u&&(t.options.columnsBar._activeColumn=null,t.element.ColumnsBarColumn_AGGRFUNC("setActiveColumn"))},_createFunctionMenuItems:function(t){var u=this,e=[],i=u.getModel().aggrFunctions,f=!0,s=!0,o=null,h=u._getAttribute(),c;for(var r in i)i[r]&&(f=!0,i[r].id==="SUM"||i[r].id==="AVG"?f=n.inArray(h.dataType,["Autoinc","Byte","Currency","Float","Int","Int64","Word"])>=0:(i[r].id==="MIN"||i[r].id==="MAX")&&(f=n.inArray(h.dataType,["Autoinc","BCD","Byte","Currency","Date","DateTime","Float","Int","Int64","Time","Word"])>=0),u._column.expr.func!==i[r].id||f||(s=!1),f&&(c=u.getModel().getAggrFunctionCaption(i[r].id),o={id:i[r].id,text:c,fn:t},u._column.expr.func!==o.id&&e.push(o)));return e&&!s&&(u._column.expr.func=e[0].id),e}});n.widget("eqjs.ColumnsBarColumn_AGGRFUNC",n.eqjs.ColumnsBarColumn_ENTATTR,{_classesToAdd:"eqjs-cb-column eqjs-cb-column-aggr",_getMenuButtonMenuItems:function(){return[{id:"to-simple",text:EQ.core.getText("CmdToSimple"),fn:function(n){n.self._changeTypeToSimple()}}].concat(this._createFunctionMenuItems(function(n){n.self._changeTypeToSimple();n.self._changeTypeToAggr(n.data.menuItem.id);n.self.refresh();n.self._fireColumnChange("change")})).concat(u(r))},_displayFormatParser:{formatStr:"",pos:0,token:"text",tokenText:"",start:function(n){this.formatStr=n;this.pos=0;this.tokenText=""},skipSpaces:function(){while(this.pos<this.formatStr.length&&this.formatStr.charAt(this.pos)===" ")this.pos++},next:function(){var t,i,r;if(this.skipSpaces(),this.pos>=this.formatStr.length)return!1;if(t=0,this.formatStr.charAt(this.pos)==="{"){if(t=this.formatStr.indexOf("}",this.pos),t<0)return!1;this.tokenText=this.formatStr.substring(this.pos,t+1);this.tokenText.indexOf("{attr")===0&&(this.token="attribute");this.pos=t+1}else this.formatStr.charAt(this.pos)==="["&&this.pos<this.formatStr.length-1&&this.formatStr.charAt(this.pos+1)==="["?(this.pos+=2,t=this.formatStr.indexOf("]]",this.pos),this.token="function",this.tokenText=this.formatStr.substring(this.pos,t),this.pos=t+2):(this.token="text",i=this.formatStr.indexOf("{",this.pos),i<0&&(i=this.formatStr.length),r=this.formatStr.indexOf("[[",this.pos),r<0&&(r=this.formatStr.length),t=Math.min(i,r),this.tokenText=n.trim(this.formatStr.substring(this.pos,t)),this.pos=t);return!0}},_parseDisplayFormat:function(n){if(!n)return[];var i=[],t=this._displayFormatParser;for(t.start(n);t.next();)t.token==="function"?i.push({type:"function",text:t.tokenText}):t.token==="attribute"?i.push({type:"attribute"}):t.token==="text"&&i.push({type:"text",text:t.tokenText});return i},_fillBaseBlock:function(n){var t=this,i,r,u,o,f,e,s;if((n.addClass("eqjs-expr-block eqjs-expr-block-aggr"),i=t.getModel().getAggrFunctionFormat(t._column.expr.func),i&&i!=="")&&(r=t._parseDisplayFormat(i),r.length!==0)){for(u=[],e=0,s=r.length;e<s;e++)o=r[e],f=o.type,f==="function"||f==="text"?u.push(o.text):f==="attribute"&&(t._baseAttr=t._getAttribute(),u.push(t._getAttributeText(t._baseAttr)));this._column.caption=u.join(" ")}},_getDefaultCaption:function(){return this._getAttributeText(this._baseAttr)+" "+this.getModel().getAggrFunctionCaption(this._column.expr.func)},_getAttribute:function(){return this.getModel().getAttributeById(this._column.expr.argument.id)},_changeTypeToSimple:function(){var n=this,r=n._column.expr.argument.id,t,i;n._column.caption="";n._column.expr={typeName:"ENTATTR",id:r};t=n._column;i=n._active;n.destroy();n._clear();n.element.ColumnsBarColumn_ENTATTR({columnsBar:n.options.columnsBar,model:n.getModel()});n.element.ColumnsBarColumn_ENTATTR("init",t);n._fireColumnChange("change");i&&(n.options.columnsBar._activeColumn=null,n.element.ColumnsBarColumn_ENTATTR("setActiveColumn"))}});n.widget("eqjs.ColumnsBarColumn_CaptionEditor",n.eqjs.ValueEditor_EDIT,{_column:null,_defaultValue:"",_editBoxClass:"eqjs-ce-editbox",_onChange:null,init:function(n,t,i){this._expr.value=n.caption;this._expr.text=n.caption;this._column=n;this._defaultValue=t;this._onChange=i;this.refresh()},_render:function(){this.clear();this._column&&(this._renderCommonPart(),this._renderEditor(),this._linkElement.text(this._getDisplayText()))},_renderCommonPart:function(){var t=this;t.element.addClass(t._getClassesToAdd());t._linkElement=n("<span><\/span>",{text:"-"}).appendTo(t.element);t._linkElement.dblclick(function(){return t._showEditor(),!1})},_getClassesToAdd:function(){return"eqjs-colelement eqjs-captionelement"},_setValue:function(n){return this._column.caption=n&&n!=""?n:this._defaultValue,this._linkElement.text(this._column.caption),this._onChange&&this._onChange(n),!0},_getValue:function(){return this._column.caption},_getText:function(){return this._column.caption},_getDisplayText:function(){return this._column.caption},_getZIndex:function(){return 1e5}})}(jQuery),function(n){n.widget("eqjs.FilterBar",{_queryPanelWidget:null,_query:null,_queryIsChanged:!1,_headerElement:null,_headerIconElement:null,_headerTextBlock:null,_headerTextElement:null,_headerLinkElement:null,_headerArrowBlock:null,_headerArrowElement:null,_qpBlock:null,_qpElement:null,_buttonsBlock:null,_btnApply:null,_btnClear:null,options:{applyOnClose:!0,showApplyButton:!0,showClearButton:!0,useBootstrapIcons:!0,applyFilterCallback:null,queryPanel:{showAddRow:!0,showCheckboxes:!0,alwaysShowButtonsInPredicates:!0}},getQuery:function(){return this._query},setQuery:function(t){this._query&&this._query.removeChangedCallback(n.proxy(this._queryChangedHandler,this));this._query=t;this._query.addChangedCallback(n.proxy(this._queryChangedHandler,this));this._queryIsChanged=!0;this._qpElement.QueryPanel("setQuery",this._query);this._updateHeader()},_showQueryPanel:function(n){var t=this;t._qpBlock.slideDown(400,function(){t._updateHeader();n&&n()})},_hideQueryPanel:function(){var n=this;n._qpBlock.slideUp(400,function(){n._qpBlock.hide();n._updateHeader();n.options.applyOnClose&&n.applyFilter()})},applyFilter:function(n){(this._queryIsChanged||n==!0)&&this.options.applyFilterCallback&&(this.options.applyFilterCallback(),this._queryIsChanged=!1)},clearFilter:function(){this._query&&this._query.clearConditions()},_queryChangedHandler:function(n){this._updateHeader();this._queryIsChanged=!0;n&&n.changeType=="condition.add"&&this._queryPanelWidget.editConditionValue(n.condition)},_headerClickHandler:function(){var n=this;n._qpBlock.is(":visible")?n._hideQueryPanel():n._showQueryPanel()},_create:function(){var t=this;this.element.addClass("eqjs-fb-container");this._headerElement=n("<div><\/div>").addClass("eqjs-fb-header");this.element.append(this._headerElement);this._headerIconElement=n("<div><\/div>").addClass("eqjs-fb-header-icon");this._headerElement.append(this._headerIconElement);this._headerTextBlock=n("<div><\/div>").addClass("eqjs-fb-header-textblock");this._headerElement.append(this._headerTextBlock);this._headerTextElement=n("<span><\/span>").addClass("eqjs-fb-header-text");this._headerTextBlock.append(this._headerTextElement);this._headerLinkElement=n('<a href="javascript:void(0)">'+EQ.core.getText("StrNoFilterClickToAdd")+"<\/a>").addClass("eqjs-fb-header-link").hide().click(function(){t._queryPanelWidget.showEntitiesMenu({anchor:t._headerLinkElement,selectedIds:null,itemSelectedCallback:function(n,i){var r=i.menuItem.data("id");t._showQueryPanel(function(){t._queryPanelWidget.addNewCondition(r)})}})});this._headerTextBlock.append(this._headerLinkElement);this._headerArrowBlock=n("<div><\/div>").addClass("eqjs-fb-header-arrowblock");this._headerElement.append(this._headerArrowBlock);this._headerArrowElement=n("<div><\/div>").addClass("eqjs-fb-header-arrow");this._headerArrowBlock.append(this._headerArrowElement);this._qpBlock=n("<div><\/div>").hide();this._qpBlock.addClass("eqjs-fb-querypanelblock");this.element.append(this._qpBlock);this._qpElement=n("<div><\/div>");this._qpElement.addClass("query-panel eqjs-fb-querypanel");this._qpElement.QueryPanel(this.options.queryPanel);this._qpElement.QueryPanel("setQuery",this._query);this._qpBlock.append(this._qpElement);this._queryPanelWidget=this._qpElement.data("QueryPanel");this._queryPanelWidget||(this._queryPanelWidget=this._qpElement.data("eqjs-QueryPanel"));(this.options.showApplyButton||this.options.showClearButton)&&(this._buttonsBlock=n("<div><\/div>").addClass("eqjs-fb-buttonsblock"),this._qpBlock.append(this._buttonsBlock));this.options.showApplyButton&&(this._btnApply=n('<a href="javascript:void(0)"><\/a>').addClass("eqjs-fb-button eqjs-fb-button-apply").text(EQ.core.getText("ButtonApply")).on("click",n.proxy(this.applyFilter,this)),this._buttonsBlock.append(this._btnApply));this.options.showClearButton&&(this._btnClear=n('<a href="javascript:void(0)"><\/a>').addClass("eqjs-fb-button eqjs-fb-button-clear").text(EQ.core.getText("ButtonClear")).on("click",n.proxy(this.clearFilter,this)),this._buttonsBlock.append(this._btnClear));n(window).resize(function(){t.textResize(t)});setTimeout(function(){t.textResize(t)},500);this._render()},textResize:function(n){n||(n=this);n._headerTextBlock.css("width",n.element.width()-n._headerIconElement.outerWidth(!0)-(n._headerArrowBlock.is(":visible")?n._headerArrowBlock.outerWidth(!0):0)+"px")},_render:function(){var t=this;this._headerIconElement.empty();this.options.useBootstrapIcons&&this._headerIconElement.append(n("<span><\/span>").addClass("glyphicon glyphicon-filter"));this._updateHeader();this._qpElement.QueryPanel("refresh");this.textResize(t)},refresh:function(){this._render()},_updateHeader:function(){var t=this._query?this._query.getConditionsText():"";t==""&&(t=EQ.core.getText("StrNoFilterDefined"));this._headerTextElement.text(t).attr("title",t);!this._query||this._query.isEmptyConditions()?(this._headerTextElement.hide(),this._headerLinkElement.show(),this._qpBlock.is(":visible")||(this._headerArrowBlock.hide(),this._headerElement.off("click.FilterBar").css("cursor",""))):(this._headerElement.off("click.FilterBar").on("click.FilterBar",n.proxy(this._headerClickHandler,this)).css("cursor","pointer"),this._headerTextElement.show(),this._headerLinkElement.hide(),this._headerArrowBlock.show());this._qpBlock.is(":visible")?this._headerArrowElement.addClass("eqjs-fb-header-arrowUp"):this._headerArrowElement.removeClass("eqjs-fb-header-arrowUp");this.textResize(this)}})}(jQuery),function(n,t){var i=t.EQ=t.EQ||{};i.view={EqDataTable:function(n){this.table=typeof n=="string"?JSON.parse(n):n},beforeTableRendering:null,formatColumnHeader:null,formatGridCell:null,useEasyChart:!1,applyCommonOptions:function(n){n.beforeTableRendering&&(this.beforeTableRendering=n.beforeTableRendering);n.formatColumnHeader&&(this.formatColumnHeader=n.formatColumnHeader);n.formatGridCell&&(this.formatGridCell=n.formatGridCell);typeof n.useEasyChart!="undefined"&&(this.useEasyChart=n.useEasyChart)},isChartJSDefined:function(){return typeof Chart!="undefined"},isGoogleVisualizationDefined:function(){return typeof google!="undefined"&&typeof google.visualization!="undefined"},isGoogleChartDefined:function(){return this.isGoogleVisualizationDefined()&&typeof google.visualization.PieChart!="undefined"},getDataTableClass:function(){var n=this.EqDataTable;return this.isGoogleVisualizationDefined()&&typeof google.visualization.DataTable!="undefined"&&(n=google.visualization.DataTable),n},renderGridByDataTable:function(t){var r,o,i,f,h,s,u,e,c;for(this.beforeTableRendering&&this.beforeTableRendering(t),r=n("<table><\/table>").css("width","100%"),o=t.getNumberOfColumns(),i=0;i<o;i++)f=t.getColumnLabel(i),this.formatColumnHeader&&(f=this.formatColumnHeader(t,i,f)),r.append("<th>"+f+"<\/th>");for(r.wrapInner('<tr class="result-grid-header"><\/tr>'),h=t.getNumberOfRows(),i=0;i<h;i++){for(s="",u=0;u<o;u++)e=t.getFormattedValue(i,u),this.formatGridCell&&(e=this.formatGridCell(t,i,u,e)),c="<td>"+e+"<\/td>",s+=c;r.append("<tr>"+s+"<\/tr>")}return r},renderGridOldStyle:function(t){for(var f,e,u,r=n("<table />").css("width","100%"),i=0;i<t.cols.length;i++)r.append("<th>"+t.cols[i]+"<\/th>");for(r.wrapInner('<tr class="result-grid-header"><\/tr>'),i=0;i<t.rows.length;i++){for(f="",e=t.rows[i],u=0;u<e.length;u++)f+="<td>"+e[u]+"<\/td>";r.append("<tr>"+f+"<\/tr>")}return r},renderPageNavigator:function(t){var l=t.pageIndex||1,h=t.pageCount||1,c=function(){var i=n(this).data("page");t.pageSelectedCallback&&t.pageSelectedCallback(i)},a=t.maxButtonCount||10,v=l-1,s=v-v%a+1,e=s+a-1,f,u,r,o;if(e>h&&(e=h),f=n("<ul><\/ul>"),i.client.useBootstrap?f.addClass("pagination"):f.addClass("eqview-pagination"),t.cssClass&&f.addClass(t.cssClass),u=n("<li><\/li>"),i.client.useBootstrap&&u.addClass("page-item"),r=n("<span aria-hidden='true'>&laquo;<\/span>"),i.client.useBootstrap&&r.addClass("page-link"),s==1)u.addClass("disabled");else{i.client.useBootstrap?(r=n("<a href='javascript:void(0)' data-page='"+(s-1)+"'>&laquo;<\/a>"),r.addClass("page-link")):r=n("<a href='javascript:void(0)' data-page='"+(s-1)+"'><\/a>").append(r);r.on("click",c)}for(u.append(r),f.append(u),o=s;o<=e;o++){u=n("<li><\/li>");i.client.useBootstrap&&u.addClass("page-item");o==l&&u.addClass("active");r=n("<a href='javascript:void(0)' class='page-link' data-page='"+o+"'>"+o+"<\/a>");i.client.useBootstrap&&r.addClass("page-link");r.on("click",c);u.append(r);f.append(u)}if(u=n("<li><\/li>"),i.client.useBootstrap&&u.addClass("page-item"),r=n("<span aria-hidden='true'>&raquo;<\/span>"),i.client.useBootstrap&&r.addClass("page-link"),e==h)u.addClass("disabled");else{i.client.useBootstrap?(r=n("<a href='javascript:void(0)' data-page='"+(e+1)+"'>&raquo;<\/a>"),r.addClass("page-link")):r=n("<a href='javascript:void(0)' data-page='"+(e+1)+"'><\/a>").append(r);r.on("click",c)}return u.append(r),f.append(u),f},_prepareForChart:function(n){if(!this.isGoogleChartDefined()&&!this.isChartJSDefined()||n.getNumberOfColumns()<2)return!1;var t=n.getColumnType(0);return t!="string"?!1:n.getColumnType(1)!="number"?!1:!0},drawChart:function(n,t,i){this.useEasyChart?this.drawEasyChart(n,t,i):this.drawSimpleChart(n,t,i)},drawSimpleChart:function(n,t,i){if(this._prepareForChart(n)&&this.isGoogleChartDefined()){i=i||{width:300};var r=new google.visualization.PieChart(t);r.draw(n,i)}},drawEasyChart:function(t,i,r){var f,u;this._prepareForChart(t)&&(f=this,r=r||{width:300},u=n(i),u.EasyChart(r),u.EasyChart("draw",t,this.chartState,function(n){f.chartState=n}))}};i.view.EqDataTable.prototype={getNumberOfColumns:function(){return this.table.cols.length},getColumnObject:function(n){return n<this.table.cols.length?this.table.cols[n]:null},getColumnId:function(n){var t=this.getColumnObject(n);return t?t.id:null},getColumnLabel:function(n){var t=this.getColumnObject(n);return t?t.label:null},getColumnType:function(n){var t=this.getColumnObject(n);return t?t.type:null},getColumnProperties:function(n){var t=this.getColumnObject(n);return t?t.p:null},getNumberOfRows:function(){return this.table.rows.length},getFormattedValue:function(n,t){var e=n<this.table.rows.length?this.table.rows[n]:null,u,i,r,f;return e&&(u=t<this.table.cols.length?e.c[t]:null,u)?typeof u.f!="undefined"?u.f:(i=u.v,typeof i!="undefined"&&i!==null&&(f=this.getColumnType(t),f=="date"||f=="datetime"?(r=eval("new "+i),i=f=="date"?r.toLocaleDateString():r.toLocaleString()):f=="timeofday"&&(r=new Date,r.setHours(i[0],i[1],i[2],i[3]),i=r.toLocaleTimeString())),i):null}}}(jQuery,window);