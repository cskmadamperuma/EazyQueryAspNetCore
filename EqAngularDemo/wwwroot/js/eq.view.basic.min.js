(function(n,t){var i=t.EQ=t.EQ||{};i.view=i.view||{};i.view.basic={_resultPanel:null,_sqlPanel:null,_clearQueryButton:null,_loadQueryButton:null,_saveQueryButton:null,_executeQueryButton:null,_exportButtons:null,_chartOptions:null,_funcs:{},_findControlById:function(t){var i=n("#"+t);return i.length==0&&(i=null),i},_syncActionAvailable:!0,init:function(n){var u,f,e,o,s,h,c,l,r,a;if(n=n||t.easyQueryViewSettings||{},i.view.applyCommonOptions(n),u=n.resultPanelId||"ResultPanel",this._resultPanel=this._findControlById(u),f=n.sqlPanelId||"SqlPanel",this._sqlPanel=this._findControlById(f),e=n.clearQueryButtonId||"ClearQueryButton",this._clearQueryButton=this._findControlById(e),o=n.loadQueryButtonId||"LoadQueryButton",this._loadQueryButton=this._findControlById(o),s=n.saveQueryButtonId||"SaveQueryButton",this._saveQueryButton=this._findControlById(s),h=n.executeQueryButtonId||"ExecuteQueryButton",this._executeQueryButton=this._findControlById(h),c=n.resultCountSpanId||"ResultCount",this._resultCountSpan=this._findControlById(c),l=n.exportButtonsId||"ResultExportButtons",this._exportButtons=this._findControlById(l),typeof n.rebuildOnQueryChange=="undefined"&&(n.rebuildOnQueryChange=!0),typeof n.syncQueryOnChange=="undefined"&&(n.syncQueryOnChange=!0),this.showChart=typeof n.showChart!="undefined"?n.showChart:!0,this.pagingOptions=n.paging,this._chartOptions=n.defaultChartType?{chartType:n.defaultChartType}:null,n.errorCallback&&(this.errorCallback=n.errorCallback),r=this,i.client.init(),this._funcs.clearButtonClick||(this._funcs.clearButtonClick=function(){r._clearErrors();r._exportButtons&&r._exportButtons.hide();r._resultCountSpan&&r._resultCountSpan.hide();r._clearSqlPanel();i.client.clearQuery()}),this._clearQueryButton){this._clearQueryButton.off("click",this._funcs.clearButtonClick);this._clearQueryButton.on("click",this._funcs.clearButtonClick)}if(this._funcs.loadQueryButtonClick||(this._funcs.loadQueryButtonClick=function(){i.client.loadQuery({id:"LastQuery",success:function(){r._clearErrors();r._clearResultPanel()},error:r._errorHandler})}),this._loadQueryButton){this._loadQueryButton.off("click",this._funcs.loadQueryButtonClick);this._loadQueryButton.on("click",this._funcs.loadQueryButtonClick)}if(this._funcs.saveQueryButtonClick||(this._funcs.saveQueryButtonClick=function(){var n=i.client.getQuery();n.setId("LastQuery");i.client.saveQuery({query:n,success:function(){t.alert("Query saved!")},error:r._errorHandler})}),this._saveQueryButton){this._saveQueryButton.off("click",this._funcs.saveQueryButtonClick);this._saveQueryButton.on("click",this._funcs.saveQueryButtonClick)}if(this._funcs.executeQueryButtonClick||(this._funcs.executeQueryButtonClick=function(){r.buildAndExecute()}),this._executeQueryButton){this._executeQueryButton.off("click",this._funcs.executeQueryButtonClick);this._executeQueryButton.on("click",this._funcs.executeQueryButtonClick)}this._funcs.queryChangedHandler||(this._funcs.queryChangedHandler=function(){r._clearSqlPanel();r._clearResultPanel();n.syncQueryOnChange&&n.rebuildOnQueryChange&&(r._syncActionAvailable?r.syncQuery():r.buildQuery())});a=i.client.getQuery();a.addChangedCallback(this._funcs.queryChangedHandler)},_clearErrorsInPanel:function(n){n&&(n.hasClass("error")&&n.removeClass("error"),n.empty())},_clearErrors:function(){this._clearErrorsInPanel(this._resultPanel);this._clearErrorsInPanel(this._sqlPanel)},_clearSqlPanel:function(){this._sqlPanel&&this._sqlPanel.empty()},_clearResultPanel:function(){this._resultPanel&&this._resultPanel.empty();this._exportButtons&&this._exportButtons.hide();this._resultCountSpan&&this._resultCountSpan.hide()},syncQuery:function(){var t=this,r=n("<div><\/div>",{"class":"result-panel loader"}),u=t._sqlPanel;i.client.syncQuery({beforeSend:function(){u&&(u.animate({opacity:"0.5"},200),u.append(r))},success:function(n){var i=n.statement||"";t.renderSqlStatement(i);r.remove()},error:function(n){r.remove();n==404&&(t.buildQuery(),t._syncActionAvailable=!1)}})},buildQuery:function(){var u=this,f=i.client.getQuery(),r=n("<div><\/div>",{"class":"result-panel loader"}),t=u._sqlPanel;i.client.buildQuery({query:f,beforeSend:function(){t&&(t.animate({opacity:"0.5"},200),t.append(r))},success:function(n){var t=n.statement||"";u.renderSqlStatement(t);r.remove()},error:function(n,i,u){r.remove();t&&(t.empty(),t.animate({opacity:1},200),t.addClass("error").append("<div>Error during "+u+" request:  <div>"+i+"<\/div><\/div>"))}})},renderSqlStatement:function(n){var t=this._sqlPanel,i;t&&(this._clearErrorsInPanel(t),t.animate({opacity:1},200),t.prop("tagName")!=="TEXTAREA"&&(t.html('<div class="sql-panel-result"><\/div>'),t=t.find("div")),t.text(n?n:""),i=t.html().replace(/\r\n/g,"<br />").replace(/  /g,"&nbsp;&nbsp;"),t.html(i))},buildAndExecute:function(t){var r=this;t=t||{page:1};var e=i.client.getQuery(),f=n("<div><\/div>",{"class":"result-panel loader"}),u=r._resultPanel;i.client.buildAndExecute({query:e,options:{page:t.page,resultFormat:1},beforeSend:function(){u&&(u.animate({opacity:"0.5"},200),u.html(f))},success:function(t){var o,c,s,l,h,e,a;try{t.statement&&r.renderSqlStatement(t.statement);u&&(u.empty(),t.resultSet&&t.resultSet.cols.length>0&&(t.resultSet.table?o=i.view.renderGridOldStyle(t.resultSet.table):(c=i.view.getDataTableClass(),s=new c(t.resultSet),r.showChart&&(l=n("<div />").addClass("chart-panel").appendTo(u),i.view.drawChart(s,l.get(0),r._chartOptions)),o=i.view.renderGridByDataTable(s)),h=n("<div />").addClass("grid-panel").appendTo(u),h.append(o),r._exportButtons&&r._exportButtons.show(),e=t.paging,e&&e.enabled&&e.pageCount>1&&(a=i.view.renderPageNavigator({pageIndex:e.pageIndex,pageCount:e.pageCount,pageSelectedCallback:function(n){r.buildAndExecute({page:n})},maxButtonCount:r.pagingOptions?r.pagingOptions.maxButtonCount:null,cssClass:r.pagingOptions?r.pagingOptions.cssClass:null}),h.css("height",u.innerHeight()-30),a.appendTo(u)),u.animate({opacity:1},200)));t.resultCount&&(r._resultCountSpan.text(t.resultCount),r._resultCountSpan.show())}finally{f.remove()}},error:function(n,t,i){f.remove();var e=!1;r.errorCallback&&(e=r.errorCallback(n,t,i));e||u&&(u.empty(),u.append("<div><\/div>").addClass("error").append("<div>Error during "+i+" request:  <div>"+t+"<\/div><\/div>"))}})}};i.view.init=i.view.basic.init;n(function(){i.view.basic.init()})})(jQuery,window);